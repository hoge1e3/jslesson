<html>
    <script src="../runtime/lib/jquery-1.12.1.js"></script>
    <div id="status"></div>
   
<script>
    const wait=(t)=>new Promise(s=>setTimeout(s,t));
    (async function () {
let f=await ($.get("files.json"));
let res={};
for (var k of f) {
    //document.writeln(k);
    document.querySelector("#status").innerText=k;
    if (k.match(/mugen/)) continue;
    await wait(0);
    frm=$("<iframe>").attr({src:"index.html?file="+k}).appendTo("body");
    let i=0;
    frm[0].contentWindow.onerror=(...e)=>{
        console.log("ERA-",e);
        i=100;
    };
    for (i=0;i< 5;i++) {//>
         await wait(100);
         res[k]=frm[0].contentWindow.document.querySelector("#output").innerText.replace(/\s*$/,"");
         if (res[k].replace(/\s/g,"").length) break;
    }
    frm.remove();
}

res=await ( $.post("send.php", {content:JSON.stringify(res)}) );
document.querySelector("#status").innerHTML=res;


    })();

</script>


</html>
