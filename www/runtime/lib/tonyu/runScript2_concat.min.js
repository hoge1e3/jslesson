!function(){var t,e,n;!function(i){var r,o,s,a,u={},l={},c={},f={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;function g(t,e){return h.call(t,e)}function m(t,e){var n,i,r,o,s,a,u,l,f,h,p,g=e&&e.split("/"),m=c.map,y=m&&m["*"]||{};if(t){for(s=(t=t.split("/")).length-1,c.nodeIdCompat&&d.test(t[s])&&(t[s]=t[s].replace(d,"")),"."===t[0].charAt(0)&&g&&(t=g.slice(0,g.length-1).concat(t)),f=0;f<t.length;f++)if("."===(p=t[f]))t.splice(f,1),f-=1;else if(".."===p){if(0===f||1===f&&".."===t[2]||".."===t[f-1])continue;f>0&&(t.splice(f-1,2),f-=2)}t=t.join("/")}if((g||y)&&m){for(f=(n=t.split("/")).length;f>0;f-=1){if(i=n.slice(0,f).join("/"),g)for(h=g.length;h>0;h-=1)if((r=m[g.slice(0,h).join("/")])&&(r=r[i])){o=r,a=f;break}if(o)break;!u&&y&&y[i]&&(u=y[i],l=f)}!o&&u&&(o=u,a=l),o&&(n.splice(0,a,o),t=n.join("/"))}return t}function y(t,e){return function(){var n=p.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),o.apply(i,n.concat([t,e]))}}function v(t){return function(e){u[t]=e}}function b(t){if(g(l,t)){var e=l[t];delete l[t],f[t]=!0,r.apply(i,e)}if(!g(u,t)&&!g(f,t))throw new Error("No "+t);return u[t]}function w(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function S(t){return t?w(t):[]}s=function(t,e){var n,i,r=w(t),o=r[0],s=e[1];return t=r[1],o&&(n=b(o=m(o,s))),o?t=n&&n.normalize?n.normalize(t,(i=s,function(t){return m(t,i)})):m(t,s):(o=(r=w(t=m(t,s)))[0],t=r[1],o&&(n=b(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},a={require:function(t){return y(t)},exports:function(t){var e=u[t];return void 0!==e?e:u[t]={}},module:function(t){return{id:t,uri:"",exports:u[t],config:function(t){return function(){return c&&c.config&&c.config[t]||{}}}(t)}}},r=function(t,e,n,r){var o,c,h,p,d,m,w,A=[],T=typeof n;if(m=S(r=r||t),"undefined"===T||"function"===T){for(e=!e.length&&n.length?["require","exports","module"]:e,d=0;d<e.length;d+=1)if("require"===(c=(p=s(e[d],m)).f))A[d]=a.require(t);else if("exports"===c)A[d]=a.exports(t),w=!0;else if("module"===c)o=A[d]=a.module(t);else if(g(u,c)||g(l,c)||g(f,c))A[d]=b(c);else{if(!p.p)throw new Error(t+" missing "+c);p.p.load(p.n,y(r,!0),v(c),{}),A[d]=u[c]}h=n?n.apply(u[t],A):void 0,t&&(o&&o.exports!==i&&o.exports!==u[t]?u[t]=o.exports:h===i&&w||(u[t]=h))}else t&&(u[t]=n)},t=e=o=function(t,e,n,u,l){if("string"==typeof t)return a[t]?a[t](e):b(s(t,S(e)).f);if(!t.splice){if((c=t).deps&&o(c.deps,c.callback),!e)return;e.splice?(t=e,e=n,n=null):t=i}return e=e||function(){},"function"==typeof n&&(n=u,u=l),u?r(i,t,e,n):setTimeout(function(){r(i,t,e,n)},4),o},o.config=function(t){return o(t)},t._defined=u,(n=function(t,e,n){if("string"!=typeof t)throw new Error("See almond README: incorrect module build, no module name");e.splice||(n=e,e=[]),g(u,t)||g(l,t)||(l[t]=[t,e,n])}).amd={jQuery:!0}}(),n("js/almond",function(){}),n("FS",[],function(){var t,e,n,i={},r=0;return i.def=function(t,e,n){var r=i.getModuleInfo(t);"function"==typeof e?(n=e,e=i.reqsFromFunc(n),i.setReqs(r,e),r.func=function(){var t={exports:{}};return n(i.doLoad,t,t.exports)||t.exports}):(i.setReqs(r,e),r.func=function(){return n.apply(this,i.getObjs(e))}),i.loadIfAvailable(r)},(t=function(t,e,n){i.def(t,e,n)}).amd={},e=function(t,e){i.def("REQJS_"+r++,t,e)},i.setReqs=function(t,e){e.forEach(function(e){var n=i.getModuleInfo(e);n.loaded||(t.reqs[e]=n,n.revReqs[t.name]=t)})},i.getModuleInfo=function(t){var e=i.modules;return e[t]=e[t]||{name:t,reqs:{},revReqs:{}}},i.doLoad=function(t){var e=i.getModuleInfo(t);if(e.loaded)return e.obj;e.loaded=!0;var n=e.func();for(var r in null!=n||t.match(/^REQJS_/)||console.log("Warning: No obj for "+t),e.obj=n,e.revReqs)i.notifyLoaded(e.revReqs[r],e.name);return n},i.notifyLoaded=function(t,e){delete t.reqs[e],i.loadIfAvailable(t)},i.loadIfAvailable=function(t){for(var e in t.reqs)return;i.doLoad(t.name)},i.getObjs=function(t){var e=[];return t.forEach(function(t){var n=i.doLoad(t);e.push(n)}),e},i.reqsFromFunc=function(t){var e=[];return(t+"").replace(/require\s*\(\s*["']([^"']+)["']\s*\)/g,function(t,n){e.push(n)}),e},i.modules={},t("extend",[],function(){return function(t,e){for(var n in e)t[n]=e[n];return t}}),t("assert",[],function(){var t,e=function(t){this.failMesg=r(t||"Assertion failed: ")};e.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var e=t(arguments),n=e.shift();if(e=r(e),e=this.failMesg.concat(n).concat(e),console.log.apply(console,e),this.isDefensive())return n;if(this.isBool())return!1;throw new Error(e.join(" "))},subAssertion:function(){var n=t(arguments);return n=r(n),new e(this.failMesg.concat(n))},assert:function(t,e){return t||this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):!!this.isBool()||t},ne:function(t,e){return t===e?this.fail(t,"===",e):!!this.isBool()||t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):!!this.isBool()||t},is:function(t,e){var n=e,i=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[i]),!!this.isBool()||t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var r=0;r<n.length;r++){var o=this.subAssertion("failed at ",t,"[",r,"]: ");null==n[r]&&console.log("WOW!7",i[r],n[r]),o.is(i[r],n[r])}return!!this.isBool()||t}if(n===String||"string"==n)return this.assert("string"==typeof i,[i,"should be a string "]),!!this.isBool()||t;if(n===Number||"number"==n)return this.assert("number"==typeof i,[i,"should be a number"]),!!this.isBool()||t;if(n===Boolean||"boolean"==n)return this.assert("boolean"==typeof i,[i,"should be a boolean"]),!!this.isBool()||t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(i,String),this.assert(n.exec(i),[i,"does not match to",n]),!!this.isBool()||t;if(n===Function)return this.assert("function"==typeof i,[i,"should be a function"]),!!this.isBool()||t;if("function"==typeof n)return this.assert(i instanceof n,[i,"should be ",n]),!!this.isBool()||t;if(n&&"object"==typeof n){for(var s in n){(o=this.subAssertion("failed at ",t,".",s,":")).is(t[s],n[s])}return!!this.isBool()||t}if("string"==typeof n){var a=this._regedType[n];return a?this.is(t,a):!!this.isBool()||t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&i(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},t=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var n=new e,i=function(){try{return n.assert.apply(n,arguments)}catch(t){throw new Error(t.stack)}};function r(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e=e.concat(r(t))}),e}return[t]}return["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){i[t]=function(){try{return n[t].apply(n,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),i.fail=n.fail.bind(n),i.MODE_STRICT=n.MODE_STRICT,i.MODE_DEFENSIVE=n.MODE_DEFENSIVE,i.MODE_BOOL=n.MODE_BOOL,i.f=function(t){return{_assert_func:t}},i.opt=function(t){return i.f(function(e){return null==e||e instanceof t})},i.and=function(){var e=t(arguments);return i(e instanceof Array),i.f(function(t){for(var n=0;n<e.length;n++)this.is(t,e[n])})},i}),t("PathUtil",["assert"],function(t){function e(e,n){return t.is(arguments,[String,String]),e.substring(e.length-n.length)===n}var n,i=/^([a-zA-Z]):/,r=/^([a-z\-]+):\/\/\/?([^\/]+)\//,o=t.f(function(t){this.is(t,String),this.assert(n.isPath(t),[t," is not a path"])}),s=t.f(function(t){this.is(t,String),this.assert(n.isAbsolutePath(t),[t," is not a absolute path"])}),a=t.f(function(t){this.is(t,String),this.assert(!n.isAbsolutePath(t),[t," is not a relative path"])}),u=t.f(function(t){this.is(t,o),this.assert(n.isDir(t),[t," is not a directory path"])}),l=t.and(u,s),c=t.f(function(t){this.is(t,o),this.assert(!n.isDir(t),[t," is not a file path"])});return n={Path:o,Absolute:s,Relative:a,Dir:u,File:c,AbsDir:l,SEP:"/",endsWith:e,startsWith:function(e,n){return t.is(arguments,[String,String]),e.substring(0,n.length)===n},isChildOf:function(t,e){return this.startsWith(this.normalize(t),this.normalize(e))},normalize:function(t){return this.fixSep(t,"/").replace(/\/+$/,"/")},hasDriveLetter:function(t){return i.exec(t)},isURL:function(t){var e=r.exec(t);if(e)return{protocol:e[1],hostPort:e[2],path:"/"+t.substring(e[0].length)}},isPath:function(e){return t.is(arguments,[String]),!0},isRelativePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&!n.isAbsolutePath(e)},isAbsolutePath:function(e){return t.is(arguments,[String]),n.isPath(e)&&(n.startsWith(e,"/")||n.hasDriveLetter(e)||n.isURL(e))},isDir:function(i){return i=n.fixSep(i),t.is(arguments,[o]),e(i,"/")},hasBackslashSep:function(t){return t.indexOf("\\")>=0},fixSep:function(e,n){return n=n||"/",t.is(arguments,[String]),t.is(e.replace(/[\\\/]/g,n),o)},directorify:function(e){return n.isDir(e)?e:t.is(e+"/",u)},filify:function(e){return n.isDir(e)?t.is(e.substring(0,e.length-1),c):e},splitPath:function(e){var n;if(t.is(arguments,[o]),n=this.isURL(e)){var i=this.splitPath(n.path);return i[0]=n.protocol+"://"+n.hostPort,i}var r=(e=e.replace(/\/+/g,"/")).split("/");return""==r[r.length-1]&&(r[r.length-2]+="/",r.pop()),r},name:function(e){return t.is(arguments,[String]),n.splitPath(e).pop()},ext:function(e){t.is(arguments,[String]);var i=n.name(e),r=/\.[a-zA-Z0-9]+$/.exec(i);return r?r[0]:null},truncExt:function(e,i){t.is(e,String);var r=n.name(e);return i=i||n.ext(e),t.is(i,String),r.substring(0,r.length-i.length)},truncSEP:function(e){return t.is(arguments,[o]),n.isDir(e)?e.substring(0,e.length-1):e},endsWith:function(i,r){return t.is(arguments,[String,String]),e(n.name(i),r)},parent:function(e){return t.is(arguments,[String]),n.up(e)},rel:function(e,i){if(""==i)return e;t.is(arguments,[l,a]);var r=n.splitPath(i),o=e;o=o.replace(/\/$/,"");var s=n;return r.forEach(function(t){".."==t||"../"==t?o=s.up(o):(o=o.replace(/\/$/,""),o+="/"+("."==t||"./"==t?"":t))}),o},relPath:function(e,i){return t.is(arguments,[s,s]),e.substring(0,i.length)!=i?"../"+n.relPath(e,this.up(i)):e.substring(i.length)},up:function(t){if("/"==t)return null;var e=n.splitPath(t);return e.pop(),e.join("/")+"/"}},["directorify","filify","splitPath","name","rel","relPath","up"].forEach(function(t){var e=n[t];n[t]=function(){var t=!1,i=Array.prototype.slice.call(arguments).map(function(e){return n.hasBackslashSep(e)?(t=!0,n.fixSep(e)):e}),r=e.apply(n,i);return t?n.fixSep(r,"\\"):r}}),n.isAbsolute=n.isAbsolutePath,n.isRelative=n.isRelativePath,"object"==typeof window&&(window.PathUtil=n),n}),t("MIMETypes",[],function(){return{".png":"image/png",".gif":"image/gif",".jpeg":"image/jpeg",".jpg":"image/jpeg",".ico":"image/icon",".wav":"audio/x-wav",".mp3":"audio/mp3",".ogg":"audio/ogg",".midi":"audio/midi",".mid":"audio/midi",".mzo":"audio/mzo",".txt":"text/plain",".html":"text/html",".htm":"text/html",".css":"text/css",".js":"text/javascript",".json":"text/json",".zip":"application/zip",".swf":"application/x-shockwave-flash",".pdf":"application/pdf",".doc":"application/word",".xls":"application/excel",".ppt":"application/powerpoint",".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".docm":"application/vnd.ms-word.document.macroEnabled.12",".dotx":"application/vnd.openxmlformats-officedocument.wordprocessingml.template",".dotm":"application/vnd.ms-word.template.macroEnabled.12",".xlsx":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",".xlsm":"application/vnd.ms-excel.sheet.macroEnabled.12",".xltx":"application/vnd.openxmlformats-officedocument.spreadsheetml.template",".xltm":"application/vnd.ms-excel.template.macroEnabled.12",".xlsb":"application/vnd.ms-excel.sheet.binary.macroEnabled.12",".xlam":"application/vnd.ms-excel.addin.macroEnabled.12",".pptx":"application/vnd.openxmlformats-officedocument.presentationml.presentation",".pptm":"application/vnd.ms-powerpoint.presentation.macroEnabled.12",".potx":"application/vnd.openxmlformats-officedocument.presentationml.template",".potm":"application/vnd.ms-powerpoint.template.macroEnabled.12",".ppsx":"application/vnd.openxmlformats-officedocument.presentationml.slideshow",".ppsm":"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",".ppam":"application/vnd.ms-powerpoint.addin.macroEnabled.12",".tonyu":"text/tonyu",".c":"text/c",".dtl":"text/dolittle"}}),t("DeferredUtil",[],function(){var t,e="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:null,n=function(t){this.res=t};function i(t){return t}return(t={isNativePromise:function(t){return t&&"function"==typeof t.then&&"function"!=typeof t.promise&&"function"==typeof t.catch},isJQPromise:function(t){return t&&"function"==typeof t.then&&"function"==typeof t.promise&&"function"==typeof t.fail},isPromise:function(t){return t&&"function"==typeof t.then&&("function"==typeof t.promise||"function"==typeof t.catch)},all:function(e){return t.promise(function(n,i){var r=[],o=e.length;e.forEach(function(e,s){t.resolve(e).then(function(t){r[s]=t,0===--o&&n(r)},i)})})},resolve:function(e){return t.config.useJQ&&t.isJQPromise(e)?e:!t.config.useJQ&&t.isNativePromise(e)?e:t.promise(function(n,i){t.isPromise(e)?e.then(n,i):n(e)})},throwNowIfRejected:function(e){var n,i,r=e.then(function(t){return n||(n="resolved"),t},function(e){if(n)return t.reject(e);n="rejected",i=e});if(n||(n="notyet"),"rejected"===n)throw i;return r},assertResolved:function(t){var e,n;if(t.then(function(t){e=t,n=!0}),!n)throw new Error("Promise not resolved");return e},ensureDefer:function(e){return t.promise(function(n,r){var o;t.resolve(e).then(function(t){o?n(t):setTimeout(function(){n(t)},0)}).then(i,function(t){o?r(t):setTimeout(function(){r(t)},0)}),o=!0})},directPromise:function(e){return t.timeout(e,0)},then:function(e){return t.directPromise().then(e)},timeout:function(e,n){return t.promise(function(t){setTimeout(function(){t(n)},e||0)})},funcPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;try{e(function(t){n.resolve(t)},function(t){n.reject(t)})}catch(t){n.reject(t)}return n.promise()}if(t.external.Promise)return new t.external.Promise(function(t,n){try{e(t,n)}catch(t){n(t)}});throw new Error("promise is not found")},reject:function(e){if(t.config.useJQ){var n=new $.Deferred;return n.reject(e),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwPromise:function(e){if(t.config.useJQ){var n=new $.Deferred;return setTimeout(function(){n.reject(e)},0),n.promise()}return new t.external.Promise(function(t,n){n(e)})},throwF:function(e){return function(){try{return e.apply(this,arguments)}catch(e){return console.log(e,e.stack),t.throwPromise(e)}}},each:function(e,n){if(e instanceof Array)return t.loop(function(i){return i>=e.length?t.brk():t.resolve(n(e[i],i)).then(function(){return i+1})},0);var i=[];for(var r in e)i.push({k:r,v:e[r]});return t.each(i,function(t){return n(t.k,t.v)})},loop:function(e,r){try{for(var o;;){if(r instanceof n)return t.when1(r.res);var s=!0,a=!1,u=e(r),l=t.resolve(u).then(function(i){return s=!1,(r=i)instanceof n?r.res:a?t.loop(e,r):void 0}).then(i,function(t){s=!1,o=t});if(o)throw o;if(a=!0,s)return l}}catch(e){return t.reject(e)}},brk:function(t){return new n(t)},tryLoop:function(e,n){return t.loop(t.tr(e),n)},tryEach:function(e,n){return t.loop(e,t.tr(n))},documentReady:function(){return t.callbackToPromise(function(t){$(t)})},requirejs:function(n){if(!e.requirejs)throw new Error("requirejs is not loaded");return t.callbackToPromise(function(t){e.requirejs(n,t)})}}).NOP=function(t){return t},t.E=function(){console.log("DUE",arguments),t.errorHandler.apply(t,arguments)},t.errorHandler=function(t){console.error.apply(console,arguments),alert(t)},t.setE=function(e){t.errorHandler=e},t.begin=t.try=t.tr=t.throwF,t.promise=t.callbackToPromise=t.funcPromise,t.when1=t.resolve,t.config={},e.$&&e.$.Deferred&&(t.config.useJQ=!0),t.external={Promise:e.Promise},e.DeferredUtil||(e.DeferredUtil=t),t}),t("FSClass",["extend","PathUtil","MIMETypes","assert","DeferredUtil"],function(t,e,n,i,r){var o=function(){},s={};function a(t){throw new Error(t+" is STUB!")}return o.addFSType=function(t,e){s[t]=e},o.availFSTypes=function(){return s},t(o.prototype,{err:function(t,e){throw new Error(t+": "+e)},fstype:function(){return"Unknown"},isReadOnly:function(t,e){a("isReadOnly")},supportsSync:function(){return!0},resolveFS:function(t,e){return i(this.getRootFS()!==this),this.getRootFS().resolveFS(t)},mounted:function(t,e){this.rootFS=t,this.mountPoint=e},inMyFS:function(t){return!this.mountPoint||e.startsWith(t,this.mountPoint)},getRootFS:function(){return i(this.rootFS,"rootFS is not set")},getReturnTypes:function(t,e){a("")},getContent:function(t,e){a("getContent")},size:function(t){return this.getContent(t,{type:ArrayBuffer}).toBin().byteLength},getContentAsync:function(t,e){return this.supportsSync()||a("getContentAsync"),r.resolve(this.getContent.apply(this,arguments))},setContent:function(t,e,n){a("")},setContentAsync:function(t,e,n){var i=this;return i.supportsSync()||a("setContentAsync"),r.resolve(e).then(function(e){return r.resolve(i.setContent(t,e,n))})},appendContent:function(t,e,n){a("")},appendContentAsync:function(t,e,n){var i=this;return i.supportsSync()||a("appendContentAsync"),r.resolve(e).then(function(e){return r.resolve(i.appendContent(t,e,n))})},getMetaInfo:function(t,e){a("")},setMetaInfo:function(t,e,n){a("")},mkdir:function(t,e){a("mkdir")},touch:function(t){a("touch")},exists:function(t,e){a("exists")},opendir:function(t,e){a("opendir")},opendirAsync:function(t,e){return this.supportsSync()||a("opendirAsync"),r.resolve(this.opendir.apply(this,arguments))},cp:function(t,n,r){i.is(arguments,[e.Absolute,e.Absolute]),this.assertExist(t),r=r||{};var o=this.isDir(t),s=this.getRootFS().resolveFS(n),a=s.isDir(n);if(o||a)throw new Error("only file to file supports");if(this.supportsSync()&&s.supportsSync()){var u=this.getContent(t),l=s.setContent(n,u);return r.a&&s.setMetaInfo(n,this.getMetaInfo(t)),l}return s.setContentAsync(n,this.getContentAsync(t)).then(function(e){return r.a?s.setMetaInfo(n,this.getMetaInfo(t)):e})},mv:function(t,e,n){return this.cp(t,e,n),this.rm(t,{r:!0})},rm:function(t,e){a("")},link:function(t,e,n){throw new Error("ln "+e+" "+t+" : This FS not support link.")},getURL:function(t){a("")},onAddObserver:function(t){}}),o.delegateMethods=function(t,n){for(var r in n)!function(r){i.ne(r,"inMyFS"),t[r]=function(){var t=arguments[0];i.is(t,e.Absolute);var o=this.resolveFS(t);return o!==this?(console.log("Invoked for other fs",this.mountPoint,o.mountPoint),o[r].apply(o,arguments)):n[r].apply(this,arguments)}}(r)},o.delegateMethods(o.prototype,{assertWriteable:function(t){this.isReadOnly(t)&&this.err(t,"read only.")},getContentType:function(t,i){var r=(e.ext(t)+"").toLowerCase();return n[r]||(i||{}).def||"application/octet-stream"},getBlob:function(t,e){var n=this.getContent(t);return(e=e||{}).blobType=e.blobType||Blob,e.binType=e.binType||ArrayBuffer,n.hasPlainText()?new e.blobType([n.toPlainText()],this.getContentType(t)):new e.blobType([n.toBin(e.binType)],this.getContentType(t))},isText:function(t){var n=this.getContentType(t);return e.startsWith(n,"text")},assertExist:function(t,n){this.exists(t,n)||this.err(t,": No such "+(e.isDir(t)?"directory":"file"))},isDir:function(t,n){return e.isDir(t)},find:function(t,n){i.is(arguments,[e.Absolute]);var r=this.opendir(t,n),o=this,s=[t];return r.forEach(function(i){var r=e.rel(t,i);if(e.isDir(r)){var a=o.resolveFS(r);s=s.concat(a.find(r,n))}else s.push(r)}),s},resolveLink:function(t){i.is(t,e.Absolute);for(var n=t;n;n=e.up(n)){i(!this.mountPoint||e.startsWith(n,this.mountPoint),n+" is out of mountPoint. path="+t);var r=this.isLink(n);if(r){i(r!=n,"l==p=="+r);var o=e.rel(r,e.relPath(t,n));return i(o!=t,"np==path=="+o),i.is(this.getRootFS().resolveFS(o).resolveLink(o),e.Absolute)}if(this.exists(n))return t}return t},isLink:function(t){return null},opendirEx:function(t,n){i.is(t,e.AbsDir);var r=this,o={};return this.opendir(t).forEach(function(n){var i=e.rel(t,n);o[n]=r.getMetaInfo(i)}),o},getDirTree:function(t,n){var r=(n=n||{}).dest=n.dest||{};n.style=n.style||"flat-absolute",n.excludes=n.excludes||[],i.is(n.excludes,Array),n.base||(n.base=t),i.is(t,e.AbsDir);var o=this.opendirEx(t,n);if("no-recursive"==n.style)return o;var s=this;for(var a in o){var u=o[a],l=e.rel(t,a),c=e.relPath(l,n.base);switch(n.style){case"flat-relative":case"hierarchical":if(n.excludes.indexOf(c)>=0)continue;break;case"flat-absolute":if(n.excludes.indexOf(l)>=0)continue}if(s.isDir(l))switch(n.style){case"flat-absolute":case"flat-relative":s.getDirTree(l,n);break;case"hierarchical":n.dest={},r[a]=s.getDirTree(l,n)}else switch(n.style){case"flat-absolute":r[l]=u;break;case"flat-relative":r[c]=u;break;case"hierarchical":r[a]=u}}return r}}),o}),t("Util",[],function(){return{getQueryString:function(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==i?e:(n=i[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(t,e){return t.substring(t.length-e.length)===e},startsWith:function(t,e){return t.substring(0,e.length)===e},privatize:function(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var i=t[n];n.match(/^_/)||"function"==typeof i&&(e[n]=function(){return i.apply(t,arguments)})}(n);return e},extend:function(t,e){for(var n in e||{})t[n]=e[n];return t}}}),t("FileSaver",[],function(){var t="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:this;function e(t,e,n){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="blob",i.onload=function(){r(i.response,e,n)},i.onerror=function(){console.error("could not download file")},i.send()}function n(t){var e=new XMLHttpRequest;return e.open("HEAD",t,!1),e.send(),e.status>=200&&e.status<=299}function i(t){try{t.dispatchEvent(new MouseEvent("click"))}catch(n){var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(e)}}var r=t.saveAs||"object"!=typeof window||window!==t?function(){}:"download"in HTMLAnchorElement.prototype?function(r,o,s){var a=t.URL||t.webkitURL,u=document.createElement("a");o=o||r.name||"download",u.download=o,u.rel="noopener","string"==typeof r?(u.href=r,u.origin!==location.origin?n(u.href)?e(r,o,s):i(u,u.target="_blank"):i(u)):(u.href=a.createObjectURL(r),setTimeout(function(){a.revokeObjectURL(u.href)},4e4),setTimeout(function(){i(u)},0))}:"msSaveOrOpenBlob"in navigator?function(t,r,o){if(r=r||t.name||"download","string"==typeof t)if(n(t))e(t,r,o);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){i(s)})}else navigator.msSaveOrOpenBlob(function(t,e){return void 0===e?e={autoBom:!1}:"object"!=typeof e&&(console.warn("Depricated: Expected third argument to be a object"),e={autoBom:!e}),e.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t}(t,o),r)}:function(n,i,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof n)return e(n,i,r);var s="application/octet-stream"===n.type,a=/constructor/i.test(t.HTMLElement)||t.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||s&&a)&&"object"==typeof FileReader){var l=new FileReader;l.onloadend=function(){var t=l.result;t=u?t:t.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=t:location=t,o=null},l.readAsDataURL(n)}else{var c=t.URL||t.webkitURL,f=c.createObjectURL(n);o?o.location=f:location.href=f,o=null,setTimeout(function(){c.revokeObjectURL(f)},4e4)}};return t.saveAs=r.saveAs=r,"undefined"!=typeof module&&(module.exports=r),r}),t("Content",["assert","Util","FileSaver"],function(t,e,n){var i=function(){},r=e.extend;i.plainText=function(t,e){var n=new i;return n.contentType=e||"text/plain",n.plain=t,n},i.url=function(t){var e=new i;return e.url=t,e},i.buffer2ArrayBuffer=function(e){if(i.isBuffer(e)){var n=new Uint8Array(e),r=n.buffer;if(r instanceof ArrayBuffer)return r;var o=Array.prototype.slice.call(n);return t(new Uint8Array(o).buffer,"n2a: buf is not set")}return t(e,"n2a: a is not set")},i.arrayBuffer2Buffer=function(e){return e instanceof ArrayBuffer?new Buffer(new Uint8Array(e)):t(e,"a2n: a is not set")},i.bin=function(e,n){t(n,"contentType should be set");var r=new i;if(i.isNodeBuffer(e))r.bufType="node",r.nodeBuffer=e;else if(e instanceof ArrayBuffer)r.bufType="array2",r.arrayBuffer=e;else{if(!e||!i.isBuffer(e.buffer))throw new Error(e+" is not a bin");r.bufType="array1",r.arrayBuffer=e.buffer}return r.contentType=n,r},i.looksLikeDataURL=function(t){return t.match(/^data:/)},i.download=n;var o=i.prototype;o.toBin=function(t){if(t=t||(i.hasNodeBuffer()?Buffer:ArrayBuffer),this.nodeBuffer)return t===Buffer?this.nodeBuffer:this.arrayBuffer=i.buffer2ArrayBuffer(this.nodeBuffer);if(this.arrayBuffer)return t===ArrayBuffer?this.arrayBuffer:this.nodeBuffer=i.arrayBuffer2Buffer(this.arrayBuffer);if(this.url){var e=new a(this.url,t);return this.setBuffer(e.buffer)}if(null!=this.plain)return this.setBuffer(i.str2utf8bytes(this.plain,t));throw new Error("No data")},o.setBuffer=function(e){return t(e,"b is not set"),i.isNodeBuffer(e)?this.nodeBuffer=e:this.arrayBuffer=e},o.toArrayBuffer=function(){return this.toBin(ArrayBuffer)},o.toNodeBuffer=function(){return this.toBin(Buffer)},o.toURL=function(){if(this.url)return this.url;if(this.arrayBuffer||null==this.plain||(this.arrayBuffer=i.str2utf8bytes(this.plain,ArrayBuffer)),this.arrayBuffer||this.nodeBuffer){var t=new a(this.arrayBuffer||this.nodeBuffer,this.contentType);return this.url=t.url}throw new Error("No data")},o.toPlainText=function(){if(this.hasPlainText())return this.plain;if(this.url&&!this.hasBin()){var t=new a(this.url,ArrayBuffer);this.arrayBuffer=t.buffer}if(this.hasBin())return this.plain=i.utf8bytes2str(this.nodeBuffer||new Uint8Array(this.arrayBuffer));throw new Error("No data")},o.hasURL=function(){return this.url},o.hasPlainText=function(){return null!=this.plain},o.hasBin=function(){return this.nodeBuffer||this.arrayBuffer},o.hasNodeBuffer=function(){return this.nodeBuffer},o.hasArrayBuffer=function(){return this.arrayBuffer},o.toBlob=function(){return new Blob([this.toBin(ArrayBuffer)],{type:this.contentType})},o.download=function(t){i.download(this.toBlob(),t)},i.Base64_To_ArrayBuffer=function(t,e){var n=e||ArrayBuffer;t=t.replace(/[\n=]/g,"");var r=new Object;r[65]=0,r[66]=1,r[67]=2,r[68]=3,r[69]=4,r[70]=5,r[71]=6,r[72]=7,r[73]=8,r[74]=9,r[75]=10,r[76]=11,r[77]=12,r[78]=13,r[79]=14,r[80]=15,r[81]=16,r[82]=17,r[83]=18,r[84]=19,r[85]=20,r[86]=21,r[87]=22,r[88]=23,r[89]=24,r[90]=25,r[97]=26,r[98]=27,r[99]=28,r[100]=29,r[101]=30,r[102]=31,r[103]=32,r[104]=33,r[105]=34,r[106]=35,r[107]=36,r[108]=37,r[109]=38,r[110]=39,r[111]=40,r[112]=41,r[113]=42,r[114]=43,r[115]=44,r[116]=45,r[117]=46,r[118]=47,r[119]=48,r[120]=49,r[121]=50,r[122]=51,r[48]=52,r[49]=53,r[50]=54,r[51]=55,r[52]=56,r[53]=57,r[54]=58,r[55]=59,r[56]=60,r[57]=61,r[43]=62,r[47]=63;var o,s=t.length,a=0,u=0;if(!s)return new n(0);o=Math.floor(s/4*3),"="==t.charAt(s-1)&&(o-=1),"="==t.charAt(s-2)&&(o-=1);for(var l=new n(o),c=i.isNodeBuffer(l)?l:new Uint8Array(l),f=0,h=0;h<o&&(void 0===(u=r[t.charCodeAt(f)])&&p("Invalid letter: "+t.charCodeAt(f)),a=u<<2,f++,void 0===(u=r[t.charCodeAt(f)])&&p("Invalid letter: "+t.charCodeAt(f)),c[h]=a|u>>4&3,a=(15&u)<<4,f++,!(++h>=o))&&(void 0===(u=r[t.charCodeAt(f)])&&p("Invalid letter: "+t.charCodeAt(f)),c[h]=a|u>>2&15,a=(3&u)<<6,f++,!(++h>=o));)void 0===(u=r[t.charCodeAt(f)])&&p("Invalid letter: "+t.charCodeAt(f)),c[h]=a|u,f++,h++;function p(e){throw console.log(e),console.log(t,f),new Error(e)}return l},i.Base64_From_ArrayBuffer=function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",i=new Uint8Array(t),r=i.length,o=0,s=0,a=0;a<r&&(n+=e[(s=i[a])>>2],o=(3&s)<<4,!(++a>=r))&&(n+=e[o|(s=i[a])>>4],o=(15&s)<<2,!(++a>=r));)n+=e[o|(s=i[a])>>6],n+=e[63&s],a++;var u=r%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},i.hasNodeBuffer=function(){return"undefined"!=typeof Buffer},i.isNodeBuffer=function(t){return i.hasNodeBuffer()&&t instanceof Buffer},i.isBuffer=function(t){return t instanceof ArrayBuffer||i.isNodeBuffer(t)},i.utf8bytes2str=function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));return decodeURIComponent(e.join(""))},i.str2utf8bytes=function(t,e){for(var n=encodeURIComponent(t),i=/^%(..)/,r=[],o=0;o<n.length;o++){var s=i.exec(n.substring(o));s?(r.push(parseInt("0x"+s[1])),o+=s[0].length-1):r.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(r):new Uint8Array(r).buffer};var s=i.hasNodeBuffer()?Buffer:ArrayBuffer,a=function(e,n){"string"==typeof e?(this.url=e,this.binType=n||s,this.dataURL2bin(e)):e&&i.isBuffer(e.buffer)?(this.buffer=e.buffer,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):i.isBuffer(e)?(this.buffer=e,t.is(n,String),this.contentType=n,this.bin2dataURL(this.buffer,this.contentType)):(console.log(arguments),t.fail("Invalid args: ",arguments))};return i.DataURL=a,r(a.prototype,{bin2dataURL:function(e,n){t(i.isBuffer(e)),t.is(n,String);var r=this.dataHeader(n),o=i.Base64_From_ArrayBuffer(e);return t.is(o,String),this.url=r+o},dataURL2bin:function(e){t.is(arguments,[String]);var n=/^data:([^;]+);base64,/i.exec(e);return t(n,["malformed dataURL:",e]),this.contentType=n[1],this.buffer=i.Base64_To_ArrayBuffer(e.substring(n[0].length),this.binType),t.is(this.buffer,this.binType)},dataHeader:function(e){return t.is(arguments,[String]),"data:"+e+";base64,"},toString:function(){return t.is(this.url,String)}}),i}),t("NativeFS",["FSClass","assert","PathUtil","extend","Content"],function(t,e,n,i,r){var o,s=e;try{(o=global.require("fs")).existsSync("test.txt")}catch(t){return function(){throw new Error("This system not support native FS")}}var a=function(t){t&&(e.is(t,n.AbsDir),this.rootPoint=t)},u=n.hasDriveLetter(process.cwd());a.available=!0;var l=n.SEP,c=a.prototype=new t;function f(t){return t}return c.toNativePath=function(t){return this.rootPoint?(e.is(t,n.Absolute),e(this.inMyFS(t),t+" is not fs of "+this),n.rel(this.rootPoint,n.relPath(t,this.mountPoint||n.SEP))):t},c.arrayBuffer2Buffer=function(t){return t instanceof ArrayBuffer?new Buffer(new Uint8Array(t)):t},t.addFSType("NativeFS",function(t,e){return new a(e.r)}),a.prototype.fstype=function(){return"Native"+(this.rootPoint?"("+this.rootPoint+")":"")},a.prototype.inMyFS=function(t){return this.mountPoint?n.startsWith(t,this.mountPoint):!(!!u^!!n.hasDriveLetter(t))},t.delegateMethods(a.prototype,{getReturnTypes:function(t,e){return f(t),s.is(arguments,[String]),{getContent:ArrayBuffer,opendir:[String]}},getContent:function(t,i){i=i||{},e.is(t,n.Absolute);var s=this.toNativePath(t);return this.assertExist(t),r.bin(o.readFileSync(s),this.getContentType(t))},size:function(t){var e=this.toNativePath(t);return o.statSync(e).size},setContent:function(t,i){e.is(arguments,[n.Absolute,r]);var s=n.up(t);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(t);i.hasBin()||!i.hasPlainText()?o.writeFileSync(a,i.toNodeBuffer()):o.writeFileSync(a,i.toPlainText())},appendContent:function(t,i){e.is(arguments,[n.Absolute,r]);var s=n.up(t);s&&this.getRootFS().resolveFS(s).mkdir(s);var a=this.toNativePath(t);i.hasBin()||!i.hasPlainText()?o.appendFileSync(a,i.toNodeBuffer()):o.appendFileSync(a,i.toPlainText())},getMetaInfo:function(t,e){this.assertExist(t,e);var n=this.stat(t);return n.lastUpdate=n.mtime.getTime(),n},setMetaInfo:function(t,e,n){f(t)},isReadOnly:function(t){return f(t),!1},stat:function(t){e.is(t,n.Absolute);var i=this.toNativePath(t);return o.statSync(i)},mkdir:function(t,e){if(e=e||{},s.is(arguments,[n.Absolute]),this.exists(t)){if(this.isDir(t))return;throw new Error(this+" is a file. not a dir.")}this.assertWriteable(t);var i=n.up(t);i&&this.getRootFS().resolveFS(i).mkdir(i);var r=this.toNativePath(t);return o.mkdirSync(r),this.assertExist(r)},opendir:function(t,e){s.is(arguments,[String]),e=e||{};var i=this.toNativePath(t),r=n.truncSEP(i),a=o.readdirSync(i);e.nosep||(a=a.map(function(t){return t+(o.statSync(r+l+t).isDirectory()?l:"")}));return s.is([].concat(a),Array)},rm:function(t,e){s.is(arguments,[n.Absolute]),e=e||{},this.assertExist(t);var i=this.toNativePath(t);return this.isDir(t)?o.rmdirSync(i):o.unlinkSync(i)},exists:function(t,e){e=e||{};var n=this.toNativePath(t);return o.existsSync(n)},isDir:function(t){return this.exists(t)?this.stat(t).isDirectory():n.isDir(t)},touch:function(t){!this.exists(t)&&this.isDir(t)?this.mkdir(t):this.exists(t)&&o.utimesSync(t,Date.now()/1e3,Date.now()/1e3)},getURL:function(t){return"file:///"+t.replace(/\\/g,"/")},onAddObserver:function(t,e){var r=this,s=r.getRootFS();e=e||{};var a=this.isDir(t),u=o.watch(t,e,function(e,o){var u,l=a?n.rel(t,o):t;u=r.exists(l)?i({eventType:e},r.getMetaInfo(l)):{eventType:e},s.notifyChanged(l,u)});return{remove:function(){u.close()}}}}),a}),t("LSFS",["FSClass","PathUtil","extend","assert","Util","Content"],function(t,e,n,i,r,o){var s=function(t,e){i(t," new LSFS fail: no storage"),this.storage=t,this.options=e||{},this.options.useDirCache&&(this.dirCache={})},a=e.isDir.bind(e),u=e.up.bind(e),l=e.endsWith.bind(e),c=e.Absolute,f=e.SEP;function h(){return(new Date).getTime()}return s.ramDisk=function(t){var n={};return n[e.SEP]="{}","useDirCache"in(t=t||{})||(t.useDirCache=!0),new s(n,t)},t.addFSType("localStorage",function(t,e){return new s(localStorage,e)}),t.addFSType("ram",function(t,e){return s.ramDisk(e)}),s.now=h,(s.prototype=new t).resolveKey=function(t){return i.is(t,e.Absolute),this.mountPoint?e.SEP+e.relPath(t,this.mountPoint):t},s.prototype.getItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return this.storage[n]},s.prototype.setItem=function(t,n){i.is(t,e.Absolute);var r=this.resolveKey(t);i(r.indexOf("..")<0),i(e.startsWith(r,e.SEP)),this.storage[r]=n},s.prototype.removeItem=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);delete this.storage[n]},s.prototype.itemExists=function(t){i.is(t,e.Absolute);var n=this.resolveKey(t);return i(this.storage,"No storage"),n in this.storage},s.prototype.getDirInfo=function(t){if(i.is(arguments,[e.AbsDir]),null==t)throw new Error("getDir: Null path");if(l(t,f)||(t+=f),i(this.inMyFS(t)),this.dirCache&&this.dirCache[t])return this.dirCache[t];var n,r={};try{(n=this.getItem(t))&&(r=JSON.parse(n))}catch(e){console.log("dinfo err : ",t,n)}return this.dirCache&&(this.dirCache[t]=r),r},s.prototype.putDirInfo=function(t,n,r){if(i.is(arguments,[e.AbsDir,Object]),!a(t))throw new Error("Not a directory : "+t);i(this.inMyFS(t)),this.dirCache&&(this.dirCache[t]=n),this.setItem(t,JSON.stringify(n));var o=u(t);if(null!=o&&this.inMyFS(o)){var s=this.getDirInfo(o);this._touch(s,o,e.name(t),r)}},s.prototype._touch=function(t,r,o,s){i.is(arguments,[Object,String,String]),i(this.inMyFS(r));var a="change";t[o]||(a="create",t[o]={},s&&(t[o].trashed=!0)),s||delete t[o].trashed,t[o].lastUpdate=h();var u=n({eventType:a},t[o]);this.getRootFS().notifyChanged(e.rel(r,o),u),this.putDirInfo(r,t,s)},s.prototype.removeEntry=function(t,n,r){i.is(arguments,[Object,String,String]),t[r]&&(t[r]={lastUpdate:h(),trashed:!0},this.getRootFS().notifyChanged(e.rel(n,r),{eventType:"trash"}),this.putDirInfo(n,t,!0))},s.prototype.removeEntryWithoutTrash=function(t,n,r){i.is(arguments,[Object,String,String]),t[r]&&(delete t[r],this.getRootFS().notifyChanged(e.rel(n,r),{eventType:"delete"}),this.putDirInfo(n,t,!0))},s.prototype.isRAM=function(){return this.storage!==localStorage},s.prototype.fstype=function(){return this.isRAM()?"ramDisk":"localStorage"},s.getUsage=function(){var t=0;for(var e in localStorage)"string"==typeof localStorage[e]&&(t+=localStorage[e].length);return t},s.getCapacity=function(){var t=0,e="a",n="___checkls___",i=0,r=Math.pow(2,25);try{for(var o=0;o<10;o++)e+=e;for(var o in localStorage)o.substring(0,n.length)==n?delete localStorage[o]:"string"==typeof localStorage[o]&&(i+=localStorage[o].length);for(var s=i;a()&&e.length<r;)e+=e;for(;e.length>1024;)e=e.substring(e.length/2),a();return{using:s,max:i}}finally{for(o=0;o<t;o++)delete localStorage[n+o]}function a(){try{return localStorage[n+t]=e,t++,i+=e.length,!0}catch(e){return delete localStorage[n+t],!1}}},t.delegateMethods(s.prototype,{isReadOnly:function(){return this.options.readOnly},getReturnTypes:function(t,e){return i.is(arguments,[String]),{getContent:String,opendir:[String]}},getContent:function(t,e){i.is(arguments,[c]),this.assertExist(t);var n=this.getItem(t);return o.looksLikeDataURL(n)?o.url(n):o.plainText(n)},setContent:function(t,e,n){i.is(arguments,[c,o]),this.assertWriteable(t);var r=null;e.hasPlainText()&&(r=e.toPlainText(),o.looksLikeDataURL(r)&&(r=null)),null!=r?this.setItem(t,r):this.setItem(t,e.toURL()),this.touch(t)},getMetaInfo:function(t,n){if(this.assertExist(t,{includeTrashed:!0}),i.is(arguments,[c]),t==e.SEP)return{};var r=i(e.up(t));if(!this.inMyFS(r))return{};var o=e.name(t);i.is(r,e.AbsDir);var s=this.getDirInfo(r);return i(s[o])},setMetaInfo:function(t,n,r){i.is(arguments,[String,Object]),this.assertWriteable(t);var o=i(e.up(t));if(this.inMyFS(o)){var s=this.getDirInfo(o),a=e.name(t);s[a]=n,this.putDirInfo(o,s,s[a].trashed)}},mkdir:function(t,e){i.is(arguments,[c]),this.assertWriteable(t),this.touch(t)},opendir:function(t,e){i.is(arguments,[String]),e=e||{};var n=this.getDirInfo(t),r=[];for(var o in n)i(n[o]),n[o].trashed&&!e.includeTrashed||r.push(o);return i.is(r,Array)},rm:function(t,n){i.is(arguments,[c]),n=n||{},this.assertWriteable(t);var r=e.up(t);if(null==r||!this.inMyFS(r))throw new Error(t+": cannot remove. It is root of this FS.");(this.assertExist(t,{includeTrashed:n.noTrash}),e.isDir(t))?(this.opendir(t).length>0&&this.err(t,"Directory not empty"),n.noTrash&&this.removeItem(t)):this.removeItem(t);var o=this.getDirInfo(r);n.noTrash?this.removeEntryWithoutTrash(o,r,e.name(t)):this.removeEntry(o,r,e.name(t))},exists:function(t,n){i.is(arguments,[c]),n=n||{};var r=e.name(t),o=e.up(t);if(null==o||!this.inMyFS(o))return!0;var s=this.getDirInfo(o)[r];return s&&s.trashed&&this.itemExists(t)&&this.isDir(t),!s&&this.itemExists(t),s&&!s.trashed&&!s.link&&this.itemExists(t),s&&!n.includeTrashed&&(s=!s.trashed),!!s},link:function(t,n,r){i.is(arguments,[e.Absolute,e.Absolute]),this.assertWriteable(t),this.exists(t)&&this.err(t,"file exists"),e.isDir(t)&&!e.isDir(n)&&this.err(t," can not link to file "+n),!e.isDir(t)&&e.isDir(n)&&this.err(t," can not link to directory "+n);var o={};o.link=n,o.lastUpdate=h(),this.setMetaInfo(t,o),i(this.exists(t)),i(this.isLink(t))},isLink:function(t){return i.is(arguments,[e.Absolute]),this.exists(t)?i(this.getMetaInfo(t)).link:null},touch:function(t){i.is(arguments,[c]),this.assertWriteable(t),this.itemExists(t)||(e.isDir(t)?(this.dirCache&&(this.dirCache[t]={}),this.setItem(t,"{}")):this.setItem(t,""));var n=u(t);if(null!=n)if(this.inMyFS(n)){var r=this.getDirInfo(n);this._touch(r,n,e.name(t),!1)}else i(this.getRootFS()!==this),this.getRootFS().resolveFS(n).touch(n)},getURL:function(t){return this.getContent(t).toURL()},opendirEx:function(t,n){i.is(t,e.AbsDir),n=n||{};var r={},o=this.getDirInfo(t);if(n.includeTrashed)return o;for(var s in o)o[s].trashed||(r[s]=o[s]);return r}}),s}),"undefined"!=typeof $&&$.ajaxTransport("+binary",function(t,e,n){if(window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob)))return{send:function(e,n){var i=new XMLHttpRequest,r=t.url,o=t.type,s=t.async||!0,a=t.responseType||"blob",u=t.data||null,l=t.username||null,c=t.password||null;for(var f in i.addEventListener("load",function(){var e={};e[t.dataType]=i.response,n(i.status,i.statusText,e,i.getAllResponseHeaders())}),i.open(o,r,s,l,c),e)i.setRequestHeader(f,e[f]);i.responseType=a,i.send(u)},abort:function(){n.abort()}}}),t("jquery.binarytransport",function(){}),t("WebFS",["FSClass","jquery.binarytransport","DeferredUtil","Content","PathUtil"],function(t,e,n,i,r){var o=function(){},s=o.prototype=new t;return t.addFSType("web",function(){return new o}),s.fstype=function(){return"Web"},s.supportsSync=function(){return!1},s.inMyFS=function(t){return r.isURL(t)},t.delegateMethods(s,{exists:function(){return!0},getContentAsync:function(t){var e=this;return n.promise(function(n,r){$.get(t,function(r){var o=new FileReader;o.addEventListener("loadend",function(){n(i.bin(o.result,e.getContentType(t)))}),o.readAsArrayBuffer(r)},"binary").fail(r)})},getURL:function(t){return t}}),o}),t("Env",["assert","PathUtil"],function(t,e){var n=function(t){this.value=t};return n.prototype={expand:function(e){t.is(e,String);var n=this;return e.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(t,e){return n.get(e)})},expandPath:function(n){return t.is(n,String),n=(n=(n=this.expand(n)).replace(/\/+/g,"/")).replace(/^[a-z][a-z]+:\//,function(t){return t+"/"}),t.is(n,e.Path)},get:function(t){return this.value[t]},set:function(t,e){this.value[t]=e}},n}),t("SFile",["extend","assert","PathUtil","Util","Content","FSClass","FileSaver","DeferredUtil"],function(t,e,n,i,r,o,s,a){var u=function(t,i){e.is(i,n.Absolute),this._path=i,this.rootFS=t,this.fs=t.resolveFS(i),this.isDir()&&!n.isDir(i)&&(this._path+=n.SEP)};return u.is=function(t){return t&&"function"==typeof t.isSFile&&t.isSFile()},u.prototype={isSFile:function(){return!0},setPolicy:function(t){if(this.policy)throw new Error("policy already set");return this.policy=t,this._clone()},getPolicy:function(t){return this.policy},_clone:function(){return this._resolve(this.path())},_resolve:function(t,r){var o;if(r=r||{},u.is(t))o=t;else{var s;e.is(t,n.Absolute);var a=r.policy||this.policy;if(a&&(s=a.topDir)&&(s.path&&(s=s.path()),!n.startsWith(t,s)))throw new Error(t+": cannot access. Restricted to "+s);(o=new u(this.rootFS,t)).policy=a}return o.policy?i.privatize(o):o},contains:function(t){return e(u.is(t),t+" shoud be a SFile object."),!!this.isDir()&&n.startsWith(t.path(),this.path())},path:function(){return this._path},name:function(){return n.name(this.path())},truncExt:function(t){return n.truncExt(this.path(),t)},ext:function(){return n.ext(this.path())},relPath:function(t){var i=t.path?t.path():t;return n.relPath(this.path(),e.is(i,n.Absolute))},up:function(){var t=this.path(),e=n.up(t);return null==e?null:this._resolve(e)},rel:function(t){e.is(t,n.Relative),this.assertDir();var i=this.path();return this._resolve(n.rel(i,t))},sibling:function(t){return this.up().rel(t)},startsWith:function(t){return n.startsWith(this.name(),t)},endsWith:function(t){return n.endsWith(this.name(),t)},equals:function(t){return t&&"function"==typeof t.path&&t.path()==this.path()},toString:function(){return this.path()},touch:function(){return this.act.fs.touch(this.act.path)},isReadOnly:function(){return this.act.fs.isReadOnly(this.act.path)},isTrashed:function(){var t=this.metaInfo();return!!t&&t.trashed},metaInfo:function(){return 0==arguments.length?this.getMetaInfo.apply(this,arguments):this.setMetaInfo.apply(this,arguments)},getMetaInfo:function(t){return this.act.fs.getMetaInfo(this.act.path,t)},setMetaInfo:function(t,e){return this.act.fs.setMetaInfo(this.act.path,t,e)},getDirTree:function(t){return this.act.fs.getDirTree(this.act.path,t)},assertExists:function(){e(this.exists(),this.path()+" does not exist.")},lastUpdate:function(){return this.assertExists(),this.metaInfo().lastUpdate},exists:function(t){var e=Array.prototype.slice.call(arguments);if("function"==typeof e[0]){var n=e.shift();return a.resolve(this.exists.apply(this,e)).then(n)}t=t||{};var i=this.fs.exists(this.path(),t);return i||t.noFollowLink?i:this.act.fs.exists(this.act.path,{noFollowLink:!0})},rm:function(t){var e=this;return t=t||{},this.isLink()?a.resolve(this.fs.rm(this.path(),t)):(this.isDir()&&(t.recursive||t.r)?this.each(function(e){return e.rm(t)}):a.resolve()).then(function(){return e.act.fs.rm(e.act.path,t)})},removeWithoutTrash:function(t){(t=t||{}).noTrash=!0,this.rm(t)},isDir:function(){return this.act.fs.isDir(this.act.path)},text:function(t){return"function"==typeof t?this.getText(t):arguments.length>0?this.setText(arguments[0]):this.getText()},setText:function(t){if(e.is(t,String),this.isDir())throw new Error("Cannot write to directory: "+this.path());var n=this.contentType({def:null});return null!==n&&!n.match(/^text/)&&r.looksLikeDataURL(t)?a.throwNowIfRejected(this.setContent(r.url(t))):a.throwNowIfRejected(this.setContent(r.plainText(t)))},appendText:function(t){return e.is(t,String),this.act.fs.appendContent(this.act.path,r.plainText(t))},getContent:function(t){return"function"==typeof t?this.act.fs.getContentAsync(this.act.path).then(t):this.act.fs.getContent(this.act.path)},setContent:function(t){if(this.isDir())throw new Error("Cannot write to directory: "+this.path());return this.act.fs.setContentAsync(this.act.path,t)},getText:function(t){if("function"==typeof t){return this.getContent(e).then(t)}return e(this.act.fs.getContent(this.act.path));function e(t){try{return t.toPlainText()}catch(e){return t.toURL()}}},getDataURL:function(t){return"function"==typeof t?this.getContent(function(t){return t.toURL()}):this.getContent().toURL()},setDataURL:function(t){return this.setContent(r.url(t))},dataURL:function(t){return"string"==typeof t?this.setDataURL(t):"function"==typeof t?this.getDataURL(t):this.getDataURL()},isText:function(){return this.act.fs.isText(this.act.path)},contentType:function(t){return this.act.fs.getContentType(this.act.path,t)},bytes:function(t){return r.isBuffer(t)?this.setBytes(t):this.getBytes()},setBytes:function(t){return this.act.fs.setContent(this.act.path,r.bin(t,this.contentType()))},getBytes:function(t){return t=t||{},this.act.fs.getContent(this.act.path).toBin(t.binType)},getURL:function(){return this.act.fs.getURL(this.act.path)},lines:function(t){return t instanceof Array?this.text(t.join("\n")):"function"==typeof t?this.text(function(e){return t(e.replace(/\r/g,"").split("\n"))}):this.text().replace(/\r/g,"").split("\n")},obj:function(){if(0==arguments.length){var t=this.text();return t?JSON.parse(t):null}this.text(JSON.stringify(e.is(arguments[0],Object)))},copyFrom:function(t,e){return t.copyTo(this,e)},copyTo:function(t,n){e(t&&t.isSFile(),t+" is not a file");var i=this,r=(n=n||{},i.isDir()),o=t.isDir();if(!r&&o&&(t=t.rel(i.name()),e(!t.isDir(),t+" is a directory."),o=!1),!r||o){if(r||o)return e(r&&o,"Both src and dst should be dir"),i.each(function(e){var i,r=t.rel(e.name());return n.progress&&(i=n.progress(r,{src:e,dst:r})),a.resolve(i).then(function(){return r.copyFrom(e,n)})});n.echo&&n.echo(i+" -> "+t);var s=this.act.fs.cp(this.act.path,t.getResolvedLinkPath(),n);return s=a.resolve(s),n.a?s.then(function(){return t.setMetaInfo(i.getMetaInfo())}):s}this.err("Cannot move dir "+i.path()+" to file "+t.path())},moveFrom:function(t,e){var n=this;return n.exists(function(i){return n.copyFrom(t,e).then(function(){return t.rm({recursive:!0})},function(t){if(!i)return n.exists(function(t){if(t)return n.rm({recursive:!0})}).then(function(){throw t});throw t})})},moveTo:function(t,e){return t.moveFrom(this,e)},assertDir:function(){return e.is(this.path(),n.Dir),this},each:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e,t)})},eachrev:function(t,e){return this.assertDir().listFilesAsync(e).then(function(e){return a.each(e.reverse(),t)})},recursive:function(t,e){var n=this.assertDir();return e=n.convertOptions(e),n.each(function(n){return n.isDir()?n.recursive(t,e):t(n)},e)},_listFiles:function(t,n){e(null==t||"object"==typeof t);var i,r=this.assertDir();this.path();return t=r.convertOptions(t),i||(i=t.order),n?this.act.fs.opendirAsync(this.act.path,t).then(o):o(this.act.fs.opendir(this.act.path,t));function o(e){for(var n=[],o=0;o<e.length;o++){var s=e[o],a=r.rel(s);t.excludesF(a)||n.push(a)}return"function"==typeof i&&n.sort&&n.sort(i),n}},listFilesAsync:function(t){return this._listFiles(t,!0)},listFiles:function(t){return this._listFiles(t,!1)},ls:function(t){e(null==t||"object"==typeof t);var n=this.assertDir();return t?n.listFiles(t).map(function(t){return t.name()}):this.act.fs.opendir(this.act.path,t)},convertOptions:function(t){var r=i.extend({},t),o=(this.assertDir(),this.path()),s=r.excludes||{};if("function"==typeof s)r.excludesF=s;else if("object"==typeof s){if(s instanceof Array){var a={};s.forEach(function(t){n.startsWith(t,"/")?a[t]=1:a[o+t]=1}),s=a}r.excludesF=function(t){return s[t.path()]}}return e.is(r,{excludesF:Function})},mkdir:function(){return this.touch()},link:function(t,e){if(this.exists())throw new Error(this.path()+": exists.");return this.act.fs.link(this.act.path,t.path(),e)},resolveLink:function(){return this._resolve(this.act.path)},isLink:function(){return this.fs.isLink(this.path())},getResolvedLinkPath:function(){return this.act.path},getFS:function(){return this.act.fs},observe:function(t){return this.getFS().getRootFS().addObserver(this.path(),t)},getBlob:function(){return new Blob([this.bytes()],{type:this.contentType()})},setBlob:function(t){var e=this;return a.promise(function(n,i){var r=new FileReader;r.addEventListener("loadend",function(){a.resolve(e.setBytes(r.result)).then(n)}),r.readAsArrayBuffer(t)})},size:function(t){if(!t){if(this.isDir()){var e=0;return this.each(function(t){e+=t.size()}),e}return this.act.fs.size(this.act.path)}},download:function(){if(this.isDir())throw new Error(this+": Download dir is not support yet. Use 'zip' instead.");s(this.getBlob(),this.name())},err:function(){var t=Array.prototype.slice.call(arguments);throw console.log.apply(console,t),new Error(t.join(""))},exportAsObject:function(t){var e=this,n={};return this.recursive(function(t){n[t.relPath(e)]=t.text()},t),{base:e.path(),data:n}},importFromObject:function(t,e){"string"==typeof t&&(t=JSON.parse(t));t=t.data;for(var n in t)this.rel(n).text(t[n])},watch:function(t,e){var n=function(){};"function"==typeof t&&(n=t),"function"==typeof e&&(n=e);var i=this.getFS().getRootFS();i.addObserver(this.path(),function(t,e){n(e.eventType,i.get(t),e)})}},Object.defineProperty(u.prototype,"act",{get:function(){return this._act?this._act:(this._act={},this._act.path=this.fs.resolveLink(this._path),this._act.fs=this.rootFS.resolveFS(this._act.path),e.is(this._act,{fs:o,path:n.Absolute}),this._act)}}),u}),t("RootFS",["assert","FSClass","PathUtil","SFile"],function(t,e,n,i){var r=function(n){t.is(n,e),this.mount(null,n)},o=r.prototype,s={err:function(t,e){throw new Error(t+": "+e)},fstab:function(){return this._fstab=this._fstab||[]},unmount:function(e,i){t.is(arguments,[n.AbsDir]);var r=this.fstab();console.log(r);for(var o=0;o<r.length;o++)if(r[o].mountPoint==e)return r.splice(o,1),!0;return!1},availFSTypes:function(){return e.availFSTypes()},mount:function(n,i,r){"string"==typeof i&&(i=t(e.availFSTypes()[i],"fstype "+i+" is undefined.")(n,r||{}));t.is(i,e),i.mounted(this,n),this.fstab().unshift(i)},resolveFS:function(i,r){var o;return t.is(i,n.Absolute),this.fstab().forEach(function(t){o||t.inMyFS(i)&&(o=t)}),o||this.err(i,"Cannot resolve"),t.is(o,e)},get:function(e){return t.is(e,n.Absolute),new i(this.resolveFS(e),e)},addObserver:function(e,n,i){this.observers=this.observers||[];var r,o,s={};"string"==typeof e&&(r=e),"string"==typeof n&&(r=n),"string"==typeof i&&(r=i),"object"==typeof e&&(s=e),"object"==typeof n&&(s=n),"object"==typeof i&&(s=i),"function"==typeof e&&(o=e),"function"==typeof n&&(o=n),"function"==typeof i&&(o=i),t.is(r,String),t.is(o,Function);var a=this.resolveFS(r).onAddObserver(r,s),u=this.observers,l={path:r,handler:o,remove:function(){var t=u.indexOf(this);u.splice(t,1),a&&a.remove()}};return this.observers.push(l),l},notifyChanged:function(t,e){this.observers&&this.observers.forEach(function(i){n.isChildOf(t,i.path)&&i.handler(t,e)})},getRootFS:function(){return this}};for(var a in s)o[a]=s[a];return r}),t("zip",["SFile","FileSaver","Util","DeferredUtil"],function(t,e,n,i){var r={setJSZip:function(t){r.JSZip=t,i.external.Promise||(i.external.Promise=t.external.Promise)}};return"undefined"!=typeof JSZip&&r.setJSZip(JSZip),r.zip=function(e,n,o){t.is(n)||(o=n),o=o||{};var s=new r.JSZip;return function t(e,n){return n.each(function(n){var r=i.resolve();return o.progress&&(r=o.progress(n)),r.then(function(){return n.isDir()?t(e.folder(n.name().replace(/[\/\\]$/,"")),n):n.getContent(function(t){e.file(n.name(),t.toArrayBuffer())})})})}(s,e).then(function(){return i.resolve(s.generateAsync({type:"arraybuffer",compression:"DEFLATE"}))}).then(function(i){if(t.is(n))return n.setBytes(i);saveAs(new Blob([i],{type:"application/zip"}),e.name().replace(/[\/\\]$/,"")+".zip")})},r.unzip=function(e,n,o){var s={};o=o||{},t.is(e)&&(e=e.getContent().toArrayBuffer()),o.onCheckFile||(o.onCheckFile=function(t){return o.overwrite?t:!t.exists()&&t});var a=new r.JSZip;return i.resolve(a.loadAsync(e)).then(function(){return i.each(a.files,function(e,r){var a,u;return i.resolve(r.async("arraybuffer")).then(function(t){if(a=t,u=n.rel(r.name),o.progress)return i.resolve(o.progress(u))}).then(function(){if(console.log("Inflating",r.name),!u.isDir()){var e={file:u,status:"uploaded"};s[u.path()]=e;var n=FS.Content.bin(a,u.contentType()),i=o.onCheckFile(u,n);return!1===i&&(e.status="cancelled",u=null),t.is(i)&&(u.path()!==i.path()&&(e.redirectedTo=i),u=i),u?u.setContent(n):void 0}})})}).then(function(){return console.log("unzip done",s),s})},r}),t("promise",[],function(){setTimeout;function t(t){return Boolean(t&&void 0!==t.length)}function e(){}function n(t){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(t,this)}function i(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,n._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var i;try{i=n(t._value)}catch(t){return void o(e.promise,t)}r(e.promise,i)}else(1===t._state?r:o)(e.promise,t._value)})):t._deferreds.push(e)}function r(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var i=e.then;if(e instanceof n)return t._state=3,t._value=e,void s(t);if("function"==typeof i)return void a((r=i,u=e,function(){r.apply(u,arguments)}),t)}t._state=1,t._value=e,s(t)}catch(e){o(t,e)}var r,u}function o(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&n._immediateFn(function(){t._handled||n._unhandledRejectionFn(t._value)});for(var e=0,r=t._deferreds.length;e<r;e++)i(t,t._deferreds[e]);t._deferreds=null}function a(t,e){var n=!1;try{t(function(t){n||(n=!0,r(e,t))},function(t){n||(n=!0,o(e,t))})}catch(t){if(n)return;n=!0,o(e,t)}}return n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,n){var r=new this.constructor(e);return i(this,new function(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}(t,n,r)),r},n.prototype.finally=function(t){var e=this.constructor;return this.then(function(n){return e.resolve(t()).then(function(){return n})},function(n){return e.resolve(t()).then(function(){return e.reject(n)})})},n.all=function(e){return new n(function(n,i){if(!t(e))return i(new TypeError("Promise.all accepts an array"));var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);var o=r.length;function s(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){s(t,e)},i)}r[t]=e,0==--o&&n(r)}catch(t){i(t)}}for(var a=0;a<r.length;a++)s(a,r[a])})},n.resolve=function(t){return t&&"object"==typeof t&&t.constructor===n?t:new n(function(e){e(t)})},n.reject=function(t){return new n(function(e,n){n(t)})},n.race=function(e){return new n(function(i,r){if(!t(e))return r(new TypeError("Promise.race accepts an array"));for(var o=0,s=e.length;o<s;o++)n.resolve(e[o]).then(i,r)})},n._immediateFn=function(t){t()},n._unhandledRejectionFn=function(){"undefined"!=typeof console&&console},n}),t("FS",["FSClass","NativeFS","LSFS","WebFS","PathUtil","Env","assert","SFile","RootFS","Content","zip","DeferredUtil","promise"],function(t,e,n,i,r,o,s,a,u,l,c,f,h){var p,d={};d.assert=s,d.Content=l,d.Class=t,d.DeferredUtil=f,f.config.useJQ||(f.external.Promise=h),d.Env=o,d.LSFS=n,d.NativeFS=e,d.PathUtil=r,d.RootFS=u,d.SFile=a,d.WebFS=i,d.zip=c,"object"==typeof window&&(window.FS=d);var g=new o({});return d.addFSType=t.addFSType,d.availFSTypes=t.availFSTypes,d.setEnvProvider=function(t){g=t},d.getEnvProvider=function(){return g},d.setEnv=function(t,e){if("object"==typeof t)for(var n in t)g.set(n,t[n]);else g.set(t,e)},d.getEnv=function(t){return"string"==typeof t?g.get(t):g.value},d.init=function(t){p||(t||(e.available?t=new e:"object"==typeof localStorage?t=new n(localStorage):"function"==typeof importScripts&&(self.addEventListener("message",function(t){var e=t.data;switch("string"==typeof e&&(e=JSON.parse(e)),e.type){case"upload":d.get(e.base).importFromObject(e.data);break;case"observe":p.observe(e.path,function(t,e){self.postMessage(JSON.stringify({type:"changed",path:t,content:d.get(t).text(),meta:e}))})}}),t=n.ramDisk())),p=new u(t))},d.getRootFS=function(){return d.init(),p},d.get=function(){return d.init(),p.get.apply(p,arguments)},d.expandPath=function(){return g.expandPath.apply(g,arguments)},d.resolve=function(t,e){return d.init(),a.is(t)?t:(t=g.expandPath(t),e&&!r.isAbsolutePath(t)?(e=g.expandPath(e),d.get(e).rel(t)):d.get(t))},d.mount=function(){return d.init(),p.mount.apply(p,arguments)},d.unmount=function(){return d.init(),p.unmount.apply(p,arguments)},d.isFile=function(t){return a.is(t)},d}),e(["FS"],function(t){n=t}),"undefined"!=typeof window&&void 0===window.FS&&(window.FS=n),"undefined"!=typeof module&&(module=n),n}),n("root",[],function(){return"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()}),n("Platform",[],function(){var t={},e=window.navigator.userAgent.toLowerCase();return t.tablet=-1!=e.indexOf("windows")&&-1!=e.indexOf("touch")||-1!=e.indexOf("ipad")||-1!=e.indexOf("android")&&-1==e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("tablet")||-1!=e.indexOf("kindle")||-1!=e.indexOf("silk")||-1!=e.indexOf("playbook"),t.mobile=-1!=e.indexOf("windows")&&-1!=e.indexOf("phone")||-1!=e.indexOf("iphone")||-1!=e.indexOf("ipod")||-1!=e.indexOf("android")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("firefox")&&-1!=e.indexOf("mobile")||-1!=e.indexOf("blackberry"),t}),n("WebSite",["FS","Platform","root"],function(n,i,r){var o=n.PathUtil,s=document.location.href;const a=r.WebSite||{};r.WebSite=a,a.runType=a.runType||r.WebSite_runType;var u,l=location.protocol,c=1600998264015;switch(l.match(/^http/)||(l="https:"),a.runType){case"IDE":return Object.assign(a,{urlAliases:{},top:".",tablet:i.tablet,mobile:i.mobile}),a.builtinAssetNames={"images/Ball.png":{name:"$pat_ball",url:"images/Ball.png"},"images/base.png":{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},"images/Sample.png":{name:"$pat_sample",url:"images/Sample.png"},"images/inputPad.png":{name:"$pat_inputPad",url:"images/inputPad.png"},"images/neko.png":{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32},"images/mapchip.png":{name:"$pat_mapchip",url:"images/mapchip.png",pwidth:32,pheight:32}},a.pluginTop||(a.pluginTop=a.top+"/js/plugins"),a.sampleImg=a.top+"/images",a.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),a.mp4Disabled=a.isNW,a.tonyuHome="/Tonyu/",a.PathSep="/",a.isNW?(a.PathSep=e("path").sep,a.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),process.env.TONYU_HOME?a.tonyuHome=o.directorify(process.env.TONYU_HOME):a.tonyuHome=o.rel(a.cwd,"fs/Tonyu/"),a.logdir=process.env.TONYU_LOGDIR,a.wwwDir=o.rel(a.cwd,"www/"),a.platform=process.platform,a.ffmpeg=o.rel(a.cwd,"win32"==a.platform?"ffmpeg/bin/ffmpeg.exe":"ffmpeg/bin/ffmpeg"),a.pkgInfo=e(o.rel(a.cwd,"package.json")),process.env.TONYU_PROJECTS?a.projects=process.env.TONYU_PROJECTS.replace(/\\/g,"/").split(e("path").delimiter):a.pkgInfo&&a.pkgInfo.config&&a.pkgInfo.config.prjDirs?a.projects=a.pkgInfo.config.prjDirs.map(function(t){return t=o.directorify(t),o.isAbsolute(t)?t:o.rel(a.cwd,t)}):a.projects=[o.rel(a.cwd,"Projects/"),o.rel(a.tonyuHome,"Projects/")],a.kernelDir=o.rel(a.wwwDir,"Kernel/")):(s.match(/edit\.tonyu\.jp\/n\//)?a.wwwDir=l+"//"+location.host+"/n/":a.wwwDir=l+"//"+location.host+"/",a.projects=[o.rel(a.tonyuHome,"Projects/")]),a.kernelDir=o.rel(a.wwwDir,"Kernel/"),a.compiledKernel="Kernel/js/concat.js",s.match(/localhost\/tonyu2/)?(a.wwwDir=l+"//"+location.host+"/tonyu2/",a.kernelDir=a.wwwDir+"Kernel/",a.compiledKernel=a.kernelDir+"js/concat.js",a.uploadTmpUrl=l+"//localhost/tsite/tonyu/e/cgi-bin/uploadTmp.cgi",a.newVersionUrl=l+"//localhost/tsite/tonyu/project/newVersion.cgi",a.scriptServer="https://localhost/tonyu2/"):(a.uploadTmpUrl=l+"//edit.tonyu.jp/cgi-bin/uploadTmp.cgi",a.newVersionUrl=l+"//www.tonyu.jp/project/newVersion.cgi",a.scriptServer="https://edit.tonyu.jp/"),n.setEnvProvider(new n.Env(a)),a.sysVersion=c,a.version=2,f(a),a;case"singleHTML":if(Object.assign(a,{urlAliases:{},top:".",tablet:i.tablet,mobile:i.mobile}),"object"==typeof BuiltinAssets)for(u in BuiltinAssets)a.urlAliases[u]=BuiltinAssets[u];return a.tonyuHome="/Tonyu/",a.projects=[o.rel(a.tonyuHome,"Projects/")],s.match(/localhost\/tonyu2/)?a.scriptServer="http://localhost/tonyu2/":a.scriptServer="https://edit.tonyu.jp/",a.pluginTop=a.scriptServer+"js/plugins",a.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),a.PathSep="/",a.compiledKernel=a.scriptServer+"Kernel/js/concat.js",n.setEnvProvider(new n.Env(a)),a.sysVersion=c,f(a),a;case"multiHTML":return Object.assign(a,{urlAliases:{},top:".",tablet:i.tablet,mobile:i.mobile}),a.tonyuHome="/Tonyu/",a.pluginTop=a.top+"/js/plugins",a.isNW="object"==typeof process&&(process.__node_webkit||process.__nwjs),a.PathSep="/",a.mp4Disabled=a.isNW,a.isNW&&(a.PathSep=function(){const n=[()=>e("path"),()=>t.nodeRequire("path"),()=>global.require("path")];for(let t of n)try{const e=t();if("string"==typeof e.sep)return e.sep}catch(t){}return"/"}(),a.cwd=o.directorify(process.cwd().replace(/\\/g,"/")),a.platform=process.platform),n.setEnvProvider(new n.Env(a)),a.sysVersion=c,a;case"manual":return a;default:throw new Error("WebSite.runType is not set")}function f(t){t.defaultResource={images:[{name:"$pat_base",url:"images/base.png",pwidth:32,pheight:32},{name:"$pat_sample",url:"images/Sample.png"},{name:"$pat_neko",url:"images/neko.png",pwidth:32,pheight:32},{name:"$pat_mapchip",url:"images/mapchip.png",pwidth:32,pheight:32}],sounds:[]}}}),n("plugins",["WebSite","root"],function(t,e){var n={},i={box2d:{src:"Box2dWeb-2.1.a.3.min.js",detection:/BodyActor/,symbol:"Box2D"},timbre:{src:"timbre.js",symbol:"T"},gif:{src:"gif-concat.js",detection:/GIFWriter/,symbol:"GIF"},Mezonet:{src:"Mezonet.js",symbol:"Mezonet"},PicoAudio:{src:"PicoAudio.min.js",symbol:"PicoAudio"},JSZip:{src:"jszip.min.js",symbol:"JSZip"},jquery_ui:{src:"jquery-ui.js",detection:/\$InputBox/,symbol:"$.ui"}};function r(t){return"function"==typeof t&&(t={onload:t}),t||(t={}),t.onload||(t.onload=function(){}),t}return n.installed=i,n.detectNeeded=function(t,e){for(var n in i){var r=i[n].detection;if(r)r.exec(t)&&(e[n]=1)}return e},n.loaded=function(t){var e=i[t];if(!e)throw new Error("plugin not found: "+t);return function(t){var e=window;return t.split(".").forEach(function(t){e&&(e=e[t])}),e}(e.symbol)},n.loadAll=function(t,e){e=r(e);var o=[];for(var s in t)i[s]&&!n.loaded(s)&&o.push(s);var a=0;console.log("loading plugins",o),setTimeout(function t(){a>=o.length?e.onload():n.load(o[a++],t)},0)},n.load=function(n,o){var s=i[n];if(!s)throw new Error("plugin not found: "+n);o=r(o);var a=t.pluginTop+"/"+s.src,u=e.requirejs;if(u)a.match(/^https?:/)||(a=a.replace(/\.js$/,"")),console.log("Loading plugin via requirejs",a),u([a],function(t){!window[s.symbol]&&t&&(window[s.symbol]=t),o.onload(t)});else{console.log("Loading plugin via <script>",a);var l=document.createElement("script");l.src=a,l.onload=o.onload,document.body.appendChild(l)}},n.request=function(t){n.loaded(t)||(new Error("Plugin "+t+" required").pluginName=t)},n}),function(){return function t(n,i,r){function o(a,u){if(!i[a]){if(!n[a]){var l="function"==typeof e&&e;if(!u&&l)return l(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=i[a]={exports:{}};n[a][0].call(f.exports,function(t){return o(n[a][1][t]||t)},f,f.exports,t,n,i,r)}return i[a].exports}for(var s="function"==typeof e&&e,a=0;a<r.length;a++)o(r[a]);return o}}()({1:[function(t,e,n){const i={superClassIsUndefined:"親クラス {1}は定義されていません",classIsUndefined:"クラス {1}は定義されていません",invalidLeftValue:"'{1}'は左辺には書けません．",fieldDeclarationRequired:"{1}は宣言されていません（フィールドの場合，明示的に宣言してください）．",duplicateKeyInObjectLiteral:"オブジェクトリテラルのキー名'{1}'が重複しています",cannotUseStringLiteralAsAShorthandOfObjectValue:"オブジェクトリテラルのパラメタに単独の文字列は使えません",breakShouldBeUsedInIterationOrSwitchStatement:"break； は繰り返しまたはswitch文の中で使います.",continueShouldBeUsedInIterationStatement:"continue； は繰り返しの中で使います.",cannotUseObjectLiteralAsTheExpressionOfStatement:"オブジェクトリテラル単独の式文は書けません．",undefinedMethod:"メソッド{1}はありません．",notAWaitableMethod:"メソッド{1}は待機可能メソッドではありません",circularDependencyDetected:"次のクラス間に循環参照があります: {1}",cannotWriteReturnInTryStatement:"現実装では、tryの中にreturnは書けません",cannotWriteBreakInTryStatement:"現実装では、tryの中にbreakは書けません",cannotWriteContinueInTryStatement:"現実装では、tryの中にcontinueは書けません",cannotWriteTwoOrMoreCatch:"現実装では、catch節1個のみをサポートしています",lexicalError:"文法エラー(Token)",parseError:"文法エラー",ambiguousClassName:"曖昧なクラス名： {1}.{2}, {3}",cannotInvokeMethod:"{1}(={2})のメソッド {3}を呼び出せません",notAMethod:"{1}{2}(={3})はメソッドではありません",notAFunction:"{1}は関数ではありません",uninitialized:"{1}(={2})は初期化されていなません",newIsRequiredOnInstanciate:"クラス名{1}はnewをつけて呼び出して下さい。",bootClassIsNotFound:"{1}というクラスはありません．",infiniteLoopDetected:"無限ループをストップしました。\n   プロジェクト オプションで無限ループチェックの有無を設定できます。\n   [参考]https://edit.tonyu.jp/doc/options.html\n"},r={superClassIsUndefined:"Super Class {1} ss Undefined",classIsUndefined:"Class {1} is Undefined",invalidLeftValue:"{1} is not a valid Left Value",fieldDeclarationRequired:"'{1}' is not declared, If you have meant it is a Field, Declare Explicitly.",duplicateKeyInObjectLiteral:"Duplicate Key In Object Literal: {1}",cannotUseStringLiteralAsAShorthandOfObjectValue:"Cannot Use String Literal as a Shorthand of Object Value",breakShouldBeUsedInIterationOrSwitchStatement:"break; Should be Used In Iteration or switch Statement",continueShouldBeUsedInIterationStatement:"continue; Should be Used In Iteration Statement",cannotUseObjectLiteralAsTheExpressionOfStatement:"Cannot Use Object Literal As The Expression Of Statement",undefinedMethod:"Undefined Method: '{1}'",notAWaitableMethod:"Not A Waitable Method: '{1}'",circularDependencyDetected:"Circular Dependency Detected: {1}",cannotWriteReturnInTryStatement:"Cannot Write Return In Try Statement",cannotWriteBreakInTryStatement:"Cannot Write Break In Try Statement",cannotWriteContinueInTryStatement:"Cannot Write Continue In Try Statement",cannotWriteTwoOrMoreCatch:"Cannot Write Two Or More Catch",lexicalError:"Lexical Error",parseError:"Parse Error",ambiguousClassName:"Ambiguous Class Name: {1}.{2} vs {3}",cannotInvokeMethod:"Cannot Invoke Method {1}(={2}).{3}",notAMethod:"Not A Method: {1}{2}(={3})",notAFunction:"Not A Function: {1}",uninitialized:"Uninitialized: {1}(={2})",newIsRequiredOnInstanciate:"new is required to Instanciate {1}",bootClassIsNotFound:"Boot Class {1} Is Not Found",infiniteLoopDetected:"Infinite Loop Detected"};let o=r;function s(t,...e){let n=o[t];return n?function(){var t=Array.prototype.slice.call(arguments),e=t.shift();1===t.length&&t[0]instanceof Array&&(t=t[0]);var n="vroijvowe0r324";return e=(e=e.replace(/\{([0-9])\}/g,n+"$1"+n)).replace(new RegExp(n+"([0-9])"+n,"g"),function(e,n){return t[parseInt(n)-1]+""})}(n,...e):function(t){return t=(t=t.replace(/([A-Z])/g," $1"))[0].toUpperCase()+t.substring(1)}(t)+(e.length?": "+e.join(","):"")}s.setLocale=(t=>{"ja"===t&&(o=i),"en"===t&&(o=r)}),e.exports=s},{}],2:[function(t,e,n){const i=function(t){this.failMesg=a(t||"Assertion failed: ")};var r;i.prototype={_regedType:{},registerType:function(t,e){this._regedType[t]=e},MODE_STRICT:"strict",MODE_DEFENSIVE:"defensive",MODE_BOOL:"bool",fail:function(){var t=r(arguments),e=t.shift();if(t=a(t),t=this.failMesg.concat(e).concat(t).concat(["mode",this._mode]),console.log.apply(console,t),this.isDefensive())return e;if(this.isBool())return!1;throw new Error(t.join(" "))},subAssertion:function(){var t=r(arguments);return t=a(t),new i(this.failMesg.concat(t))},assert:function(t,e){return t||this.fail(t,e)},eq:function(t,e){return t!==e?this.fail(t,"!==",e):!!this.isBool()||t},ne:function(t,e){return t===e?this.fail(t,"===",e):!!this.isBool()||t},isset:function(t,e){return null==t?this.fail(t,(e||"")+" is null/undef"):!!this.isBool()||t},is:function(t,e){var n=e,i=t;if(null==n)return this.fail(t,"assert.is: type must be set");if(n._assert_func)return n._assert_func.apply(this,[i]),!!this.isBool()||t;if(this.assert(null!=t,[t,"should be ",n]),n instanceof Array||"object"==typeof global&&"function"==typeof global.Array&&n instanceof global.Array){if(!t||"number"!=typeof t.length)return this.fail(t,"should be array:");for(var r=0;r<n.length;r++){let e=this.subAssertion("failed at ",t,"[",r,"]: ");null==n[r]&&console.log("WOW!7",i[r],n[r]),e.is(i[r],n[r])}return!!this.isBool()||t}if(n===String||"string"==n)return this.assert("string"==typeof i,[i,"should be a string "]),!!this.isBool()||t;if(n===Number||"number"==n)return this.assert("number"==typeof i,[i,"should be a number"]),!!this.isBool()||t;if(n instanceof RegExp||"object"==typeof global&&"function"==typeof global.RegExp&&n instanceof global.RegExp)return this.is(i,String),this.assert(n.exec(i),[i,"does not match to",n]),!!this.isBool()||t;if(n===Function)return this.assert("function"==typeof i,[i,"should be a function"]),!!this.isBool()||t;if("function"==typeof n)return this.assert(i instanceof n,[i,"should be ",n]),!!this.isBool()||t;if(n&&"object"==typeof n){for(var o in n){this.subAssertion("failed at ",t,".",o,":").is(t[o],n[o])}return!!this.isBool()||t}if("string"==typeof n){var s=this._regedType[n];return s?this.is(t,s):!!this.isBool()||t}return this.fail(t,"Invaild type: ",n)},ensureError:function(t,e){try{t()}catch(n){return"string"==typeof e&&s(n+""===e,t+" thrown an error "+n+" but expected:"+e),void console.log("Error thrown successfully: ",n.message)}this.fail(t,"should throw an error",e)},setMode:function(t){this._mode=t},isDefensive:function(){return this._mode===this.MODE_DEFENSIVE},isBool:function(){return this._mode===this.MODE_BOOL},isStrict:function(){return!this.isDefensive()&&!this.isBool()}},r=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e};var o=new i,s=function(){try{return o.assert.apply(o,arguments)}catch(t){throw new Error(t.message)}};function a(t){if(t instanceof Array){var e=[];return t.forEach(function(t){e=e.concat(a(t))}),e}return[t]}["setMode","isDefensive","is","isset","ne","eq","ensureError"].forEach(function(t){s[t]=function(){try{return o[t].apply(o,arguments)}catch(t){throw console.log(t.stack),new Error(t.message)}}}),s.fail=o.fail.bind(o),s.MODE_STRICT=o.MODE_STRICT,s.MODE_DEFENSIVE=o.MODE_DEFENSIVE,s.MODE_BOOL=o.MODE_BOOL,s.f=function(t){return{_assert_func:t}},s.opt=function(t){return s.f(function(e){return null==e||e instanceof t})},s.and=function(){var t=r(arguments);return s(t instanceof Array),s.f(function(e){for(var n=0;n<t.length;n++)this.is(e,t[n])})},e.exports=s},{}],3:[function(t,e,n){e.exports="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:function(){return this}()},{}],4:[function(t,e,n){var i=t("../lib/assert"),r=t("../lib/root"),o=t("./TonyuThread"),s=t("./tonyuIterator");const a=t("../lib/R");e.exports=function(){r.performance||(r.performance={}),r.performance.now||(r.performance.now=function(){return Date.now()});var t,e,n={};function u(e){if(!t.onRuntimeError)throw r.alert&&r.alert("Error: "+e),console.log(e.stack),e;t.onRuntimeError(e)}function l(t,e){return i.is(arguments,[String,Object]),f(n.getMeta(t),e)}function c(t,e){return f(t?Object.create(t.prototype):{},e)}function f(t,e){if(e&&"object"==typeof e)for(var n in e)t[n]=e[n];return t}n.addMeta=l,n.removeMeta=function(t){delete d[t]},n.removeMetaAll=function(t){t+=".";for(let e in d)e.substring(0,t.length)===t&&delete d[e]},n.getMeta=function(t){if("function"==typeof t)return t.meta;if("string"==typeof t){var e=d[t];return e||(d[t]=e={}),e}},n.ensureNamespace=function(t,e){var n,i=e.split("."),r=t;for(n=0;n<i.length;n++){var o=i[n];r[o]||(r[o]={}),r=r[o]}return r},n.propReg=/^__([gs]et)ter__(.*)$/,n.define=function(e){var i=e.superclass,r=e.includes,o=e.fullName,s=e.shortName,a=e.namespace,u=e.methods,h=e.decls,p=n.ensureNamespace(t.classes,a);function d(t,e){if(!t.prototype.hasOwnProperty("getClassInfo"))throw new Error("NO");if(!t.meta)throw console.log("metanotfound",t),new Error("meta not found");return function t(e,n){if((n=n||{}).isShim)return e;if(n.path=n.path||[],n.path.push(e),e.isShim)throw console.log("chkmeta::ctx",n),new Error("Shim found "+e.extenderFullName);if(e.superclass&&t(e.superclass,n),!e.includes)throw console.log("chkmeta::ctx",n),new Error("includes not found");return e.includes.forEach(function(e){t(e,n)}),n.path.pop(),e}(t.meta,e),t}function g(t,e){var i=!e.init,p=e.includesRec;if(p[o])return t;p[o]=!0,r.forEach(function(n){t=n.extendFrom(t,f(e,{init:!1}))});var g,y="function"==typeof u?u(t):u,v=y.initialize;delete y.initialize,(g=v?function(){this instanceof g||m(o),v.apply(this,arguments)}:t?function(){this instanceof g||m(o),t.apply(this,arguments)}:function(){this instanceof g||m(o)}).prototype=c(t,{constructor:g}),g.meta=i?{isShim:!0,extenderFullName:o}:l(o,{fullName:o,shortName:s,namespace:a,decls:h,superclass:e.nonShimParent?e.nonShimParent.meta:null,includesRec:p,includes:r.map(function(t){return t.meta})}),g.meta.func=g,g.methods=y;var b,w=g.prototype,S={},A=n.propReg;for(b in y)if(!b.match(/^fiber\$/)){w[b]=y[b];var T="fiber$"+b;if(y[T]&&(w[T]=y[T],w[T].methodInfo=w[T].methodInfo||{name:b,klass:g,fiber:!0},w[b].fiber=w[T]),"__dummy"!==b&&!w[b])throw console.log("WHY!",w[b],w,b),new Error("WHY!"+b);w[b].methodInfo=w[b].methodInfo||{name:b,klass:g};var x=A.exec(b);x&&(S[x[2]]=S[x[2]]||{},S[x[2]][x[1]]=w[b])}for(b in w.isTonyuObject=!0,S)Object.defineProperty(w,b,S[b]);return w.getClassInfo=function(){return g.meta},d(g,{isShim:i})}var y=g(i,{init:!0,initFullName:o,includesRec:i?f({},i.meta.includesRec):{},nonShimParent:i});return y.extendFrom=g,p[s]=y,y,d(y,{isShim:!1})},n.isSourceChanged=function(t){return!(!(t=t.meta||t).src||!t.src.tonyu)&&(!t.nodeTimestamp||t.src.tonyu.lastUpdate()>t.nodeTimestamp)},n.shouldCompile=function(t){if((t=t.meta||t).hasSemanticError)return!0;if(n.isSourceChanged(t))return!0;for(var e=n.getDependingClasses(t),i=0;i<e.length;i++)if(n.shouldCompile(e[i]))return!0},n.getDependingClasses=function(t){var e=[];return(t=t.meta||t).superclass&&(e=[t.superclass]),t.includes&&(e=e.concat(t.includes)),e};var h={},p={},d={};function g(t){var e,n=t.split("."),i=p;if(n.forEach(function(t){i&&(i=i[t])}),!i&&1==n.length)for(var r in p){var o=p[r][t];if(o){if(i)throw new Error(a("ambiguousClassName",r,t,e));i=o,e=r+"."+t}}return i}function m(t){throw new Error(a("newIsRequiredOnInstanciate",t))}var y=r.performance.now();function v(t){y=r.performance.now()+(t||0)}if(t={thread:function(){var t=new e;return t.handleEx=u,t},klass:n,bless:c,extend:f,globals:h,classes:p,classMetas:d,setGlobal:function(t,e){h[t]=e},getGlobal:function(t){return h[t]},getClass:g,timeout:function(t){return new Promise(function(e){setTimeout(e,t)})},bindFunc:function(e,n){if("function"!=typeof n)return n;var i=function(){return n.apply(e,arguments)};return i.methodInfo=t.extend({thiz:e},n.methodInfo||{}),n.fiber&&((i.fiber=function(){return n.fiber.apply(e,arguments)}).methodInfo=t.extend({thiz:e},n.fiber.methodInfo||{})),i},not_a_tonyu_object:function(t){throw console.log("Not a tonyu object: ",t),new Error(t+" is not a tonyu object")},is:function(t,e){return!!t&&(t instanceof e||!("function"!=typeof t.getClassInfo||!e.meta)&&t.getClassInfo().includesRec[e.meta.fullName])},hasKey:function(t,e){return t in e},invokeMethod:function(t,e,n,i){if(!t)throw new Error(a("cannotInvokeMethod",i,t,e));var r=t[e];if("function"!=typeof r)throw new Error(a("notAMethod","this"==i?"":i+".",e,r));return r.apply(t,n)},callFunc:function(t,e,n){if("function"!=typeof t)throw new Error(a("notAFunction",n));return t.apply({},e)},checkNonNull:function(t,e){if(t!=t||null==t)throw new Error(a("uninitialized",e,t));return t},iterator:s,run:function(e){var n=g(e);if(!n)throw new Error(a("bootClassIsNotFound",e));t.runMode=!0;var i=new n,r=t.globals.$currentProject||t.currentProject;r&&(r.runningObj=i)},checkLoop:function(){var t=r.performance.now();if(t-y>1e3)throw v(1e4),new Error(a("infiniteLoopDetected"));t},resetLoopCheck:v,VERSION:1560828115159,A:function(t){for(var e=[],n=1;n<t.length;n++)e[n-1]=t[n];return e},ID:Math.random()},e=o(t),r.Tonyu)throw console.error("Tonyu called twice!"),new Error("Tonyu called twice!");return r.Tonyu=t,t}()},{"../lib/R":1,"../lib/assert":2,"../lib/root":3,"./TonyuThread":5,"./tonyuIterator":6}],5:[function(t,e,n){const i=t("../lib/R");e.exports=function(t){var e=1;class n{constructor(){this.frame=null,this._isDead=!1,this.cnt=0,this._isWaiting=!1,this.fSuspended=!1,this.tryStack=[],this.preemptionTime=60,this.onEndHandlers=[],this.onTerminateHandlers=[],this.id=e++,this.age=0}isAlive(){return!this.isDead()}isDead(){return this._isDead=this._isDead||null==this.frame||this._threadGroup&&(this._threadGroup.objectPoolAge!=this.tGrpObjectPoolAge||this._threadGroup.isDeadThreadGroup()),this._isDead}setThreadGroup(t){this._threadGroup=t,this.tGrpObjectPoolAge=t.objectPoolAge}isWaiting(){return this._isWaiting}suspend(){this.fSuspended=!0,this.cnt=0}enter(t){this.frame={prev:this.frame,func:t}}apply(t,e,n){var r;if(n||(n=[]),"string"==typeof e&&!(r=t["fiber$"+e]))throw new Error(i("undefinedMethod",e));if("function"==typeof e&&!(r=e.fiber)){var o=e.methodInfo?e.methodInfo.name:e.name;throw new Error(i("notAWaitableMethod",o))}n=[this].concat(n);var s=0;return this.enter(function(e){switch(s){case 0:r.apply(t,n),s=1;break;case 1:e.termStatus="success",e.notifyEnd(e.retVal),n[0].exit(),s=2}})}notifyEnd(t){this.onEndHandlers.forEach(function(e){e(t)}),this.notifyTermination({status:"success",value:t})}notifyTermination(t){this.onTerminateHandlers.forEach(function(e){e(t)})}on(t,e){"end"!==t&&"success"!==t||this.onEndHandlers.push(e),"terminate"===t&&(this.onTerminateHandlers.push(e),this.handleEx&&delete this.handleEx)}promise(){var t=this;return new Promise(function(e,n){t.on("terminate",function(t){"success"===t.status?e(t.value):"exception"===t.status?n(t.exception):n(new Error(t.status))})})}then(t,e){return e?this.promise().then(t,e):this.promise().then(t)}fail(t){return this.promise().then(t=>t,t)}gotoCatch(t){var e=this;if(0==e.tryStack.length)return e.termStatus="exception",e.kill(),void(e.handleEx?e.handleEx(t):e.notifyTermination({status:"exception",exception:t}));e.lastEx=t;for(var n=e.tryStack.pop();e.frame;){if(n.frame===e.frame){e.catchPC=n.catchPC;break}e.frame=e.frame.prev}}startCatch(){var t=this.lastEx;return this.lastEx=null,t}exit(t){this.frame=this.frame?this.frame.prev:null,this.retVal=t}enterTry(t){this.tryStack.push({frame:this.frame,catchPC:t})}exitTry(){this.tryStack.pop()}waitEvent(t,e){var n,i=this;(i.suspend(),t.on)&&(e=e.concat(function(){i.lastEvent=arguments,i.retVal=arguments[0],n.remove(),i.steps()}),n=t.on.apply(t,e))}runAsync(t){var e=this,n=function(){e.retVal=arguments,e.steps()},i=function(){for(var t="",n=0;n<arguments.length;n++)t+=arguments[n]+",";0==t.length&&(t="Async fail");var i=new Error(t);i.args=arguments,e.gotoCatch(i),e.steps()};e.suspend(),setTimeout(function(){t(n,i)},0)}waitFor(t){var e=this;return e._isWaiting=!0,e.suspend(),t instanceof n&&(t=t.promise()),Promise.resolve(t).then(function(t){e.retVal=t,e.stepsLoop()}).then(t=>t,function(t){e.gotoCatch(e.wrapError(t)),e.stepsLoop()})}wrapError(t){if(t instanceof Error)return t;var e=new Error(t);return e.original=t,e}resume(t){this.retVal=t,this.steps()}steps(){var e=this;if(!e.isDead()){var n=t.currentThread;for(t.currentThread=e,e.cnt=e.preemptionTime,e.preempted=!1,e.fSuspended=!1;e.cnt>0&&e.frame;)try{for(;e.cnt-- >0&&e.frame;)e.frame.func(e);e.preempted=!e.fSuspended&&e.isAlive()}catch(t){e.gotoCatch(t)}t.currentThread=n}}stepsLoop(){var t=this;t.steps(),t.preempted&&setTimeout(function(){t.stepsLoop()},0)}kill(){var t=this;t._isDead=!0,t.frame=null,t.termStatus||(t.termStatus="killed",t.notifyTermination({status:"killed"}))}clearFrame(){this.frame=null,this.tryStack=[]}}return n}},{"../lib/R":1}],6:[function(t,e,n){const i="undefined"!=typeof Symbol&&Symbol.iterator;class r{constructor(t){this.set=t,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.set[this.i],this.i++,!0)}}class o{constructor(t){this.set=t,this.i=0}next(){return!(this.i>=this.set.length)&&(this[0]=this.i,this[1]=this.set[this.i],this.i++,!0)}}class s{constructor(t){for(var e in this.elems=[],t)this.elems.push(e);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i],this.i++,!0)}}class a{constructor(t){for(var e in this.elems=[],t)this.elems.push([e,t[e]]);this.i=0}next(){return!(this.i>=this.elems.length)&&(this[0]=this.elems[this.i][0],this[1]=this.elems[this.i][1],this.i++,!0)}}class u{constructor(t){this.it=t}next(){const{value:t,done:e}=this.it.next();return!e&&(this[0]=t,!0)}}e.exports=function(t,e){if(t.tonyuIterator)return t.tonyuIterator(e);if(t instanceof Array)return 1==e?new r(t):new o(t);if("function"==typeof t[i])return new u(t[i]());if(t instanceof Object)return 1==e?new s(t):new a(t);throw console.log(t),new Error(t+" is not iterable")}},{}]},{},[4]),n("Tonyu",function(t){return function(){return t.Tonyu}}(this)),n("PatternParser",["Tonyu"],function(t){var e=function(t,e){this.options=e||{},this.img=t,this.height=t.height,this.width=t.width;var n=this.newImage(t.width,t.height).getContext("2d");n.drawImage(t,0,0),this.ctx=n,this.pixels=this.ctx.getImageData(0,0,t.width,t.height).data,this.base=this.getPixel(0,0)};return t.extend(e.prototype,{newImage:function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},getPixel:function(t,e){var n=this.pixels,i=4*(t+e*this.width),r=n[0+i],o=n[1+i],s=n[2+i];return 256*(256*(256*n[3+i]+s)+o)+r},setPixel:function(t,e,n){var i=4*(t+e*this.width);this.pixels[0+i]=255&n,n=(n-(255&n))/256,this.pixels[1+i]=255&n,n=(n-(255&n))/256,this.pixels[2+i]=255&n,n=(n-(255&n))/256,this.pixels[3+i]=255&n},parse:function(){try{for(var t=[],e=0;e<this.height;e++)for(var n=0;n<this.width;n++){this.getPixel(n,e)!=this.base&&t.push(this.parse1Pattern(n,e))}return t}catch(t){if(t.isParseError)return console.log("parse error! "+t),[{image:this.img,x:0,y:0,width:this.width,height:this.height}];throw t}},parse1Pattern:function(t,e){function n(t){return t}for(var i=this.getPixel(t,e),r=t,o=e,s=this.base,a=this.width,u=this.height;r<a;){if(this.getPixel(r,o)!=i)break;r++}if(r>=a||this.getPixel(r,o)!=s)throw T(r,o,n(this.getPixel(r,o))+"!="+n(s));for(r--;o<u&&this.getPixel(r,o)==i;)o++;if(o>=u||this.getPixel(r,o)!=s)throw T(r,o,n(this.getPixel(r,o))+"!="+n(s));var l=t+1,c=e+1,f=r-l,h=--o-c;if(f*h==0)throw T(r,o,"w*h==0");for(var p=this.newImage(f,h),d=p.getContext("2d"),g=d.getImageData(0,0,f,h),m=g.data,y=0,v=c;v<o;v++)for(var b=l;b<r;b++){var w=this.getPixel(b,v);w==i?(m[y++]=0,m[y++]=0,m[y++]=0,m[y++]=0):(m[y++]=255&w,w=(w-(255&w))/256,m[y++]=255&w,w=(w-(255&w))/256,m[y++]=255&w,w=(w-(255&w))/256,m[y++]=255&w)}d.putImageData(g,0,0);for(var S=c-1;S<=o;S++)for(var A=l-1;A<=r;A++)this.setPixel(A,S,s);return this.options.boundsInSrc?{x:l,y:c,width:f,height:h}:{image:p,x:0,y:0,width:f,height:h};function T(t,e,n){return{toString:function(){return"at ("+t+","+e+") :"+n},isParseError:!0}}}}),e}),Util=function(){function t(){return"undefined"!=typeof Buffer}function e(e){return t()&&e instanceof Buffer}return{getQueryString:function(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n,i=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(window.location.href);return null==i?e:(n=i[1],decodeURIComponent(n.replace(/\+/g,"%20")))},endsWith:function(t,e){return t.substring(t.length-e.length)===e},startsWith:function(t,e){return t.substring(0,e.length)===e},Base64_To_ArrayBuffer:function(t){t=t.replace(/[\n=]/g,"");var e=new Object;e[65]=0,e[66]=1,e[67]=2,e[68]=3,e[69]=4,e[70]=5,e[71]=6,e[72]=7,e[73]=8,e[74]=9,e[75]=10,e[76]=11,e[77]=12,e[78]=13,e[79]=14,e[80]=15,e[81]=16,e[82]=17,e[83]=18,e[84]=19,e[85]=20,e[86]=21,e[87]=22,e[88]=23,e[89]=24,e[90]=25,e[97]=26,e[98]=27,e[99]=28,e[100]=29,e[101]=30,e[102]=31,e[103]=32,e[104]=33,e[105]=34,e[106]=35,e[107]=36,e[108]=37,e[109]=38,e[110]=39,e[111]=40,e[112]=41,e[113]=42,e[114]=43,e[115]=44,e[116]=45,e[117]=46,e[118]=47,e[119]=48,e[120]=49,e[121]=50,e[122]=51,e[48]=52,e[49]=53,e[50]=54,e[51]=55,e[52]=56,e[53]=57,e[54]=58,e[55]=59,e[56]=60,e[57]=61,e[43]=62,e[47]=63;var n,i=t.length,r=0,o=0;if(!i)return new ArrayBuffer(0);n=Math.floor(i/4*3),"="==t.charAt(i-1)&&(n-=1),"="==t.charAt(i-2)&&(n-=1);for(var s=new ArrayBuffer(n),a=new Uint8Array(s),u=0,l=0;l<n&&(void 0===(o=e[t.charCodeAt(u)])&&c("Invalid letter: "+t.charCodeAt(u)),r=o<<2,u++,void 0===(o=e[t.charCodeAt(u)])&&c("Invalid letter: "+t.charCodeAt(u)),a[l]=r|o>>4&3,r=(15&o)<<4,u++,!(++l>=n))&&(void 0===(o=e[t.charCodeAt(u)])&&c("Invalid letter: "+t.charCodeAt(u)),a[l]=r|o>>2&15,r=(3&o)<<6,u++,!(++l>=n));)void 0===(o=e[t.charCodeAt(u)])&&c("Invalid letter: "+t.charCodeAt(u)),a[l]=r|o,u++,l++;function c(e){throw console.log(e),console.log(t,u),new Error(e)}return s},Base64_From_ArrayBuffer:function(t){for(var e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],n="",i=new Uint8Array(t),r=i.length,o=0,s=0,a=0;a<r&&(n+=e[(s=i[a])>>2],o=(3&s)<<4,!(++a>=r))&&(n+=e[o|(s=i[a])>>4],o=(15&s)<<2,!(++a>=r));)n+=e[o|(s=i[a])>>6],n+=e[63&s],a++;var u=r%3;return u&&(n+=e[o]),1==u?n+="==":2==u&&(n+="="),n},utf8bytes2str:function(t){for(var e=[],n=0;n<t.length;n++)e.push("%"+("0"+t[n].toString(16)).slice(-2));try{return decodeURIComponent(e.join(""))}catch(t){throw console.log(e.join("")),t}},str2utf8bytes:function(t,e){for(var n=encodeURIComponent(t),i=/^%(..)/,r=[],o=0;o<n.length;o++){var s=i.exec(n.substring(o));s?(r.push(parseInt("0x"+s[1])),o+=s[0].length-1):r.push(n.charCodeAt(o))}return"undefined"!=typeof Buffer&&e===Buffer?new Buffer(r):new Uint8Array(r).buffer},privatize:function(t){if(t.__privatized)return t;var e={__privatized:!0};for(var n in t)!function(n){var i=t[n];n.match(/^_/)||"function"==typeof i&&(e[n]=function(){return i.apply(t,arguments)})}(n);return e},hasNodeBuffer:t,isNodeBuffer:e,isBuffer:function(t){return t instanceof ArrayBuffer||e(t)}}}(),n("Util",function(t){return function(){return t.Util}}(this)),n("Assets",["WebSite","Util","Tonyu","FS"],function(t,e,n,i){var r={resolve:function(n,r,o){o=o||{};var s=i.isFile(r)?r:r.getDir();if(null==n&&(n=""),n=n.replace(/\$\{([a-zA-Z0-9_]+)\}/g,function(e,n){return t[n]}),t.urlAliases[n]&&(n=t.urlAliases[n]),e.startsWith(n,"ls:")){var a=n.substring("ls:".length);if(!s)throw new Error("Basedir not specified");var u=s.rel(a);if(!u.exists())throw new Error("Resource file not found: "+u);if(t.mp3Disabled&&a.match(/\.(mp3)$/)||t.mp4Disabled&&a.match(/\.(mp4|m4a)$/)){var l=s.rel(a.replace(/\.(mp3|mp4|m4a)$/,".ogg"));l.exists()&&(u=l)}if(n=u.getURL(),o.asFile)return u}return n}};return n.Assets=r,r}),n("assert",["FS"],function(t){return t.assert}),n("ImageList",["PatternParser","Util","Assets","assert"],function(t,e,n,i){var r,o={};return(r=function(e,r,s){s||(s={});var a=[],u=(e=function(t){var e=[];return t.forEach(function(t,n){t&&""!=t.url&&e.push(t)}),e}(e)).length;0==u&&setTimeout(function(){var t=[];t.names={},r(t)},0),e.forEach(function(e,l){console.log("loading",e,l);var c=e.url,f=c;if(o[f])p.apply(o[f],[]);else{c=n.resolve(c,s.prj||s.baseDir);var h=$("<img>");h.load(function(){o[f]=this,p.apply(this,[])}),h.attr("src",c)}function p(){var n,o;if("single"==e.type)a[l]=[{image:this,x:0,y:0,width:this.width,height:this.height}];else if((n=e.pwidth)&&(o=e.pheight)){for(var s=0,c=0,f=this.width,h=this.height,p=[];;){var d=n,g=o;if(s+n>f&&(d=f-s),c+o>h&&(g=h-c),p.push({image:this,x:s,y:c,width:d,height:g}),(s+=n)+n>f&&(s=0,(c+=o)+o>h))break}a[l]=p}else{var m=new t(this);a[l]=m.parse()}if(a[l].name=e.name,i.is(a[l],Array),0==--u){var y=[],v={};a.forEach(function(t){v[t.name]=y.length,y=y.concat(t)}),y.names=v,r(y)}}})}).load=r,r.parse1=function(e,n,r){var o,s,a;if((o=e.pwidth)&&(s=e.pheight)){for(var u=0,l=0,c=n.width,f=n.height,h=[];h.push({image:this,x:u,y:l,width:o,height:s}),!((u+=o)+o>c&&(u=0,(l+=s)+s>f)););a=h}else{a=new t(n,r).parse()}return a.name=e.name,i.is(a,Array)},window.ImageList=r,r}),n("ImageRect",[],function(){return function t(e,n){if("string"==typeof e){var i=new Image,r=null,o=null,s=function(t){t&&(o=t),o&&r&&o(r)};return i.onload=function(){r=t(i,n),s()},i.src=e,s}var a=n.width,u=n.height,l=n.getContext("2d"),c=e.width,f=e.height,h=u/f*c,p=a/c*f;p>u&&(p=u),h>a&&(h=a),l.clearRect(0,0,a,u);var d=Math.floor((a-h)/2),g=Math.floor((u-p)/2);return l.drawImage(e,0,0,c,f,d,g,h,p),{left:d,top:g,width:h,height:p,src:e}}}),n("thumbnail",["ImageRect","root","WebSite"],function(t,e,n){var i={},r="$icon_thumbnail",o=200,s=200;return i.set=function(a,u){n.surpressCreateThumbnail||setTimeout(function(){!function(n){try{var a=e.Tonyu.globals.$Screen.buf[0],u=$("<canvas>").attr({width:o,height:s});t(a,u[0]);var l=u[0].toDataURL(),c=n.getResource(),f=n.getDir(),h=i.file(n);h.text(l);for(var p={name:r,pwidth:o,pheight:s,url:"ls:"+h.relPath(f)},d=c.images,g=!1,m=0;m<d.length;m++)d[m].name==r&&(d[m]=p,g=!0);g||d.push(p),n.setResource(c),console.log("setRSRC",c)}catch(t){console.log("Create thumbnail failed",t),console.log(t.stack)}}(a)},u)},i.get=function(t){var e=i.file(t);return e.exists()?e.text():null},i.file=function(t){return t.getDir().rel("images/").rel("icon_thumbnail.png")},i}),n("DeferredUtil",["FS"],function(t){return t.DeferredUtil}),n("R",["require","exports","module","root"],function(t,e,n){const i=t("root"),r={file:"ファイル",closeFile:"閉じる",removeFile:"削除",renameProject:"プロジェクト名を変更",removeProject:"このプロジェクト自身を削除",mapEditor:"マップエディタ",searchFiles:"検索",imageList:"画像リスト",soundList:"音声リスト",projectOptions:"プロジェクト オプション",editorConfig:"エディタの設定",openFolder:"フォルダを開く",resetRunDialog:"実行ダイアログをリセット",exportAsHTML:"HTML生成",openHelpInThisWindow:"ヘルプ(この画面)",import:"インポート",tools:"ツール",window:"ウィンドウ",publish:"公開",help:"ヘルプ",openHelpWithNewTab:"ヘルプ(別ウィンドウ)",projects:"プロジェクト一覧",publisedProjects:"公開されているプロジェクト",WebSite:"Webサイト",showEditButton:"「Edit」ボタンを設置する(ブラウザ版で編集可能になります)",editorFontSize:"エディタの文字の大きさ",inputFileName:"ファイル名を入力してください",newFile:"新規作成",renameFile:"名前変更",refactorClassName:"プログラム中のクラス名も変更する",someFilesHaveErrorOnRefactor:"プログラム内にエラーがあります．エラーを修正するか，「プログラム中のクラス名も変更する」のチェックを外してもう一度やり直してください．",namingNotice:"名前は，半角英数字とアンダースコア(_)のみが使えます．先頭は英大文字にしてください．",autoReload:"自動再実行",stop:"停止(F2)",selectMain:"実行するファイルを選択...",createAtLeastOneFile:"ファイルを作成してください",inputNewProjectName:"新しいプロジェクトの名前を入れてください",unknown:"不明",jumpToErrorPosition:"エラー箇所に移動",error:"エラー",showTrace:"トレース表示",generateSingleHTML:"HTML生成",thisIsExecutableInSingleHTML:"このHTMLをcodepenなどのJS共有サイトに張り付けて実行できます．",runnableInIE11:"Internet Explorer 11でも動作させる（一部機能が使えない可能性があります）",globalVariables:"グローバル変数",theseGlobalVariablesAreInitializedOnStart:"実行時に，これらのグローバル変数が指定した値に初期化されます．",variablesShouldBeStringOrJSON:"「値」欄には文字列またはJSON形式で記入してください．",save:"保存",varableName:"グローバル変数名",value:"値",varableNameShouldBeAlphabetOrNumber:"変数名には半角英数字を使ってください",cannotBeParsedAsValue:"解釈できない値です．この値をそのまま文字列として登録したい場合，前後をダブルクォーテーションで囲ってください．\n",ifYouWantContainDoubleQuoteAsTheValue:'ダブルクォーテーション自身を文字列に含める場合は \\" と書いてください．\n',ifYouWantContainBackslash:"\\自身を文字列に含める場合は \\\\ と書いてください．\n",imageDetails:"画像詳細",singlePicture:"１枚絵",rowsAndColumns:"分割数指定：",chipWidthAndHeight:"1パターンの大きさ指定：",compatibleWithTonyu1:"Tonyu1互換",parse:"解析",chipNo:"パターン番号:",dragImageFilesHere:"ここに画像ファイル(png/gif/jpg)をドラッグ＆ドロップして追加",name:"名前",sizePerChip:"1個の大きさ",add:"追加",ok:"完了",importFromHTML:"HTMLからインポート",overwriteFolder:"フォルダを上書きする",selectOtherFolder:"他のフォルダを選択する",pasteHTMLHere:"ここにHTMLを貼り付けます",inputFolderPathForImport:"インポート先のフォルダを入力してください",startImport:"インポート開始",overwriteTheseFiles:"これらのファイルを上書きする",openTheProjectWithoutOverwrite:"上書きせずプロジェクトを開く",followingFilesWillBeOverwritten:"次のファイルは上書きされます",ovr:"上書",new:"新規",importComplete:"インポート完了",selectMainClass:"実行するクラスを選択",run:"実行",newProject:"新規プロジェクト",newProjectName:"プロジェクト名",parentFolder:"親フォルダ",willCreateAt:"作成先フォルダ：",inputProjectName:"名前を入力してください",folderExists:"このフォルダはすでに存在します",rename:"名前変更",downloadAsZip:"ZIPダウンロード",delete:"削除",deleteProject:"プロジェクトの削除",downloadAsZipBeforeDeletion:"削除前にZIPでダウンロードする",yes:"はい",no:"いいえ",compiler:"コンパイラ",diagMode:"診断モード(速度が落ちますが，プログラムの不具合を見つけやすくします)",disableInfiniteLoopCheck:"無限ループチェックをしない（チェックすると速度が速くなることがあります）",requireFieldDeclaration:"フィールド宣言を明示的に行う(var n; のような宣言が必要になります)",defaultSuperClass:"デフォルトの親クラス",runtimes:"実行",mainClass:"Main クラス",bootClass:"Boot クラス",edit:"編集...",done:"完了",thisFileCannotBeAdded:"このファイルは追加できません：\n",resourceFileExists:"同じ名前のファイルが既に登録されています：\n",image:"画像",sound:"音声",find:"検索",wordToFind:"検索語",showAllProjects:"すべて見る...",thisFolderShouldBeUploadedToWebServer:"このフォルダは、Webサーバにアップロードしないと正常に動作しない可能性があります。\n",seeRuntime:"詳しくは\nhttps://www.tonyu.jp/tonyu2/runtime.html\nを御覧ください。\n",createExecutable:"ランタイム作成",howToOutput:"出力方法",saveExecutableAsZip:"ZIP圧縮したものを保存する",uploadToProjectBoard:"プロジェクトボードにアップロードする",saveExecutableAtFolder:"次のフォルダに出力：",executableOptions:"オプション",RunInIE11:"Internet Explorer 11でも動作させる（一部機能が使えない可能性があります）",attachSourceFiles:"ソースを添付する",ifSourceFilesAreAttached:"ソースを添付すると，アップロードしたファイルを",ItCanBeEditableInProjectBoard:"プロジェクトボード上で直接編集できます．",youCanPublishThisExecutableAsWebApplicationBy:"次のいずれかの方法でWebアプリとして公開することができます。",uploadTheFolderIntoYourWebSite:"フォルダをお手持ちのWebサーバにアップロードする",uploadZippedFileInto:"上のフォルダをZIPで圧縮したものを",projectBoard:"プロジェクトボード",afterProjectBoard:"にアップロードする",executableCreated:"ランタイムを作成しました。",uploadTheExtractedFolderIntoYourWebSite:"解凍したフォルダをお手持ちのWebサーバにアップロードする",uploadTheZipFileInto:"保存したZIPファイルを",uploadHasNotBeenDoneYet:"まだアップロードは完了していません",youHaveToDescribeAboutThisVersion:"新規バージョンページ",toCompleteTheUpload:"に必要事項を記入して，アップロードを完了させてください",infiniteLoopDetected:"無限ループをストップしました。\n",youCanConfigureAboutInfinteLoopDetection:"   プロジェクト オプションで無限ループチェックの有無を設定できます。\n",seeProjectOption:"   [参考]https://edit.tonyu.jp/doc/options.html\n",importingFromZip:"Zipからインポート中です...",importFromZip:"Zipからインポート",confirm:"確認",cancel:"キャンセル",input:"入力",fileExists:"ファイル{1}は存在します",fileExistsInOtherFolder:"ファイル{1}が他のフォルダに存在します",deleteFileConfirm:"{1}を削除しますか？",duplicatedFiles:"{1} ⇒ {2}({3}) と重複\n",cannotUseFolderManagedByProject:"{1}はプロジェクトで管理されているフォルダなので，クラスを作成することはできません．",cannotUseKernelFiles:"{1}はシステムで利用されているフォルダなので使用できません",upCased:"先頭を大文字({1}) にして作成します．",resouceList:"{1}リスト",dragFileHere:"ここに{1}ファイル({2})をドラッグ＆ドロップして追加",storageUsage:"{1}KB中{2}KB使用中．",unzipping:"{1}を展開中...",doesNotContainTonyu2Project:"{1}にはTonyu2の編集可能なプロジェクトが含まれていません.",checking:"{1}をチェック中...",downloadFromProjectBoard:"プロジェクトボードから{1}をダウンロード....",copying:"{1}から{2}にコピー",runtimeCreatedAt:"ランタイムを作成しました：",uploadFailed:"アップロード失敗: {1}",duplicateGlobalVariable:"変数名'{1}'が重複しています．",invalidGlobalVariableName:"変数名'{1}'はグローバル変数名として使えません．",runClass:"{1}を実行",ThisFolderWillBeCreated:"このフォルダは新規作成されます．",pluginAddedAndRestart:"必要なプラグイン{1}を追加しました。もう一度実行してください",otherCommandInProgress:"他のコマンド({1})が実行されているのでお待ちください．\nしばらくたってもこのメッセージが出る場合，一旦Homeに戻ってください．",deleteProjectConfirm:"{1}内のファイルをすべて削除しますか？削除する場合はDELETE と入力してください．",renamedProjectExists:"{1}はすでに存在します．",at:" 場所：",deleteProjectFromItem:"プロジェクト{1}を削除しますか？",destinationFolder:"フォルダ(省略可)",Open_URL:"別ウィンドウで開きます",UseRightClick:"※リンクが開かない場合、右クリックか長押しで新しいタブを開くか、URLをコピーしてください。"},o={file:"File",closeFile:"Close File",removeFile:"Remove File",renameProject:"Rename Project",removeProject:"Remove Project",mapEditor:"Map Editor",searchFiles:"Search Files",imageList:"Image List",soundList:"Sound List",projectOptions:"Project Options",editorConfig:"Editor Config",openFolder:"Open Folder",resetRunDialog:"Reset Run Dialog",exportAsHTML:"Export as HTML",openHelpInThisWindow:"Open Help in This Window",import:"Import",tools:"Tools",window:"Window",publish:"Publish",help:"Help",openHelpWithNewTab:"Open Help with New Tab",projects:"Projects",publisedProjects:"Publised Projects",WebSite:" Web Site",showEditButton:"Show Edit Button",editorFontSize:"Editor Font Size",inputFileName:"Input File Name",newFile:"New File",renameFile:"Rename File",refactorClassName:"Refactor Class Name",someFilesHaveErrorOnRefactor:"Error occured during Refactoring. Correct Error or uncheck 'Refactor Class Name'.",namingNotice:"Alphabets, Numbers or Underscores can be used as a name.",autoReload:"Auto Reload",stop:"Stop",selectMain:"Select Main",createAtLeastOneFile:"Create at Least One File",inputNewProjectName:"Input New Project Name",unknown:"Unknown",jumpToErrorPosition:"Jump To Error Position",error:"Error",showTrace:"Show Trace",generateSingleHTML:"Generate Single HTML",thisIsExecutableInSingleHTML:"This is Executable in Single HTML, can be pasted to codepen.io",runnableInIE11:"Runnable in IE11",globalVariables:"Global Variables",theseGlobalVariablesAreInitializedOnStart:"The following Global Variables are Initialized on Startup",variablesShouldBeStringOrJSON:"Variables Should be String or JSON",save:"Save",varableName:"Varable Name",value:"Value",varableNameShouldBeAlphabetOrNumber:"Variable Name Should be Alphabet or Number",cannotBeParsedAsValue:"Cannot be Parsed as a Value. If you meant this is a plain string, surround it with double quotes.",ifYouWantContainDoubleQuoteAsTheValue:'If You Want Contain Double Quote as The Value, write as \\" ',ifYouWantContainBackslash:"If You Want Contain Backslash, write as \\\\",imageDetails:"Image Details",singlePicture:"Single Picture",rowsAndColumns:"Rows And Columns",chipWidthAndHeight:"Chip Width And Height",compatibleWithTonyu1:"Compatible With Tonyu1",parse:"Parse",chipNo:"Chip No.",dragImageFilesHere:"Drag Image Files Here",name:"Name",sizePerChip:"Size Per Chip",add:"Add",ok:"Ok",importFromHTML:"Import From HTML",overwriteFolder:"Overwrite Folder",selectOtherFolder:"Select Other Folder",pasteHTMLHere:"Paste HTML Here",inputFolderPathForImport:"Input Folder Path For Import",startImport:"Start Import",overwriteTheseFiles:"Overwrite These Files",openTheProjectWithoutOverwrite:"Open The Project Without Overwrite",followingFilesWillBeOverwritten:"Following Files Will be Overwritten",ovr:"Ovr",new:"New",importComplete:"Import Complete",selectMainClass:"Select Main Class",run:"Run",newProject:"New Project",newProjectName:"New Project Name",parentFolder:"Parent Folder",willCreateAt:"The project will be created At: ",inputProjectName:"Input Project Name",folderExists:"Folder Exists",rename:"Rename",downloadAsZip:"Download as Zip",delete:"Delete",deleteProject:"Delete Project",downloadAsZipBeforeDeletion:"Download as Zip Before Deletion",yes:"Yes",no:"No",compiler:"Compiler",diagMode:"Diagnostic Mode",disableInfiniteLoopCheck:"Disable Infinite Loop Check(Sometimes faster)",requireFieldDeclaration:"Require Explicit Field Declaration(such as var n; )",defaultSuperClass:"Default Super Class",runtimes:"Runtimes",mainClass:"Main Class",bootClass:"Boot Class",edit:"Edit",done:"Done",thisFileCannotBeAdded:"This File cannot be Added",resourceFileExists:"Resource File with the name already Exists",image:"Image",sound:"Sound",find:"Find",wordToFind:"Word To Find",showAllProjects:"Show All Projects",thisFolderShouldBeUploadedToWebServer:"This Folder Should be Uploaded To Web Server",seeRuntime:"See https://www.tonyu.jp/tonyu2/runtime.html",createExecutable:"Create Executable",howToOutput:"How To Output",saveExecutableAsZip:"Save Executable as Zip",uploadToProjectBoard:"Upload To Project Board",saveExecutableAtFolder:"Save Executable at the following Folder:",executableOptions:"Executable Options",RunInIE11:" Run in IE11 (Some features cannot be used)",attachSourceFiles:"Attach Source Files",ifSourceFilesAreAttached:"If Source Files are Attached, ",ItCanBeEditableInProjectBoard:" It can be Editable in Project Board",youCanPublishThisExecutableAsWebApplicationBy:"You can Publish This Executable as a Web Application by either ways:",uploadTheFolderIntoYourWebSite:"Upload The Folder Into Your Web Site",uploadZippedFileInto:"Upload Zipped File Into ",projectBoard:"Project Board",afterProjectBoard:".",executableCreated:"Executable Created",uploadTheExtractedFolderIntoYourWebSite:"Upload The Extracted Folder Into Your Web Site",uploadTheZipFileInto:"Upload The Zip File Into",uploadHasNotBeenDoneYet:"Upload Has Not Been Done Yet",youHaveToDescribeAboutThisVersion:"You Have To Describe About This Version",toCompleteTheUpload:"To Complete The Upload",infiniteLoopDetected:"Infinite Loop Detected. Aborted.",youCanConfigureAboutInfinteLoopDetection:"You can Configure About Infinte Loop Detection",seeProjectOption:"See Project Option: https://edit.tonyu.jp/doc/options.html",importingFromZip:"Importing From Zip",importFromZip:"Import From Zip",confirm:"Confirm",cancel:"Cancel",input:"Input",fileExists:"File {1} already Exists",deleteFileConfirm:"Delete File {1}?",duplicatedFiles:"Duplicated:{1}=>{2}({3})",cannotUseFolderManagedByProject:"Cannot create class files in folder {1}, managed by the project.",cannotUseKernelFiles:"Cannot Use name {1}, conflicting with Kernel Files",upCased:"The class name is automatically capitalized: {1}",ThisFolderWillBeCreated:"This folder will be created.",resouceList:"{1} List",dragFileHere:"Drag {1} File({2}) Here",storageUsage:"Storage Usage: {2}/{1}KB",unzipping:"Unzipping {1}",doesNotContainTonyu2Project:"{1} Does Not Contain Tonyu2 Project",checking:"Checking {1}",downloadFromProjectBoard:"Download {1} From Project Board",copying:"Copying from {1} to {2}",runtimeCreatedAt:"Executable Created at: ",uploadFailed:"Upload Failed: {1}",duplicateGlobalVariable:"Duplicate Global Variable: {1}",invalidGlobalVariableName:"Invalid Global Variable Name: {1}",runClass:"Run {1}",pluginAddedAndRestart:"Plugin {1} Added And Restart",otherCommandInProgress:"Other {1} Command in Progress",deleteProjectConfirm:"Are you sure to Delete Project {1}? If so, type DELETE",renamedProjectExists:"Renamed Project {1} Exists",at:"at:",destinationFolder:"Folder(Optional)",deleteProjectFromItem:"Delete Project {1}?",Open_URL:"Opening New Window",UseRightClick:"If the link cannot works, use submenus by Right-Click or Long-Tap."};let s=localStorage.locale||navigator.language,a="en"==(s=s.substring(0,2))?o:r;function u(t,...e){let n=a[t];return n?function(){var t=Array.prototype.slice.call(arguments),e=t.shift();1===t.length&&t[0]instanceof Array&&(t=t[0]);var n="vroijvowe0r324";return e=(e=e.replace(/\{([0-9])\}/g,n+"$1"+n)).replace(new RegExp(n+"([0-9])"+n,"g"),function(e,n){return t[parseInt(n)-1]+""})}(n,...e):function(t){return t=(t=t.replace(/([A-Z])/g," $1"))[0].toUpperCase()+t.substring(1)}(t)+(e.length?": "+e.join(","):"")}u.renderMenu=(()=>{$("[data-r]").each(function(){const t=$(this);t.text(u(t.attr("data-r")))})}),"function"==typeof $&&$(u.renderMenu),u.getLocale=(()=>a===o?"en":"ja"),u.setLocale=(t=>{localStorage.locale=t,a="en"==localStorage.locale?o:r,u.renderMenu()}),i.R=u,n.exports=u}),n("sysMod",["Tonyu","FS","ImageList","thumbnail","WebSite","plugins","DeferredUtil","R"],function(t,e,n,i,r,o,s,a){return{rawRun:function(t){if(r.removeJSOutput){var e=this.getOutputFile();e.exists()&&e.rm()}return this.loadClasses().then(()=>{this.detectPlugins(),this.fixBootRunClasses(),this.runScriptMode||i.set(this,2e3),this.rawBoot(t)})},getResourceFile:function(){return this.getDir().rel("res.json")},getResource:function(){var t=this.getResourceFile();if(t.exists()){var e=t.obj(),n=!1;for(var i in e)for(var o=e[i],s=o.length-1;s>=0;s--)o[s].url||(o.splice(s,1),n=!0);return n&&this.setResource(e),e}return r.defaultResource},removeThumbnail:function(){try{const t=this,e=t.getDir&&t.getDir(),n=t.getResource();if(n.images){const i=n.images.length;n.images=n.images.filter(t=>{if("$icon_thumbnail"!==t.name)return!0;if(t.url&&t.url.match(/^ls:/)){const n=e.rel(t.url.substring(3));n.exists()&&n.rm()}return!1}),n.images.length<i&&t.setResource(n)}}catch(t){console.log(t)}},hasSoundResource:function(){var t=this.getResource();return t&&t.sounds&&t.sounds.length>0},setResource:function(t){this.getResourceFile().obj(t)},getThumbnail:function(){return i.get(this)},convertBlobInfos:function(t){var e=this.getResource(),n=this.getName();!function e(i){if("object"==typeof i)for(var r in i)if(i.hasOwnProperty(r)){var o=i[r];if("url"==r){var s=Blob.isBlobURL(o);s&&(i[r]=[Blob.BLOB_PATH_EXPR,t,n,s.fileName].join("/"))}e(o)}}(e),this.setResource(e)},getBlobInfos:function(){var t=[];return function e(n){if("object"==typeof n)for(var i in n)if(n.hasOwnProperty(i)){var r=n[i];if("url"==i){var o=Blob.isBlobURL(r);o&&t.push(o)}e(r)}}(this.getResource()),t},loadResource:function(e){var i=this.getResource();n(i.images,function(n){var i=t.getGlobal("$Sprites");for(var r in i&&i.setImageList(n),n.names)t.setGlobal(r,n.names[r]);e&&e()})},detectPlugins:function(){var t=this.getOptions(),e=t.plugins=t.plugins||{};if(!e.Mezonet||!e.PicoAudio){var n=this.getResource(),i=!1,r=!1;n.sounds&&n.sounds.forEach(function(t){t.url.match(/\.mzo/)&&(i=!0),t.url.match(/\.midi?/)&&(r=!0)}),i?this.addPlugin("Mezonet"):this.removePlugin("Mezonet"),r?this.addPlugin("PicoAudio"):this.removePlugin("PicoAudio")}},addPlugin:function(t){var e=this.getOptions();e.plugins=e.plugins||{},e.plugins[t]||(e.plugins[t]=1,this.setOptions(e))},removePlugin:function(t){var e=this.getOptions();e.plugins[t]&&(delete e.plugins[t],this.setOptions(e))},requestPlugin:function(t){if(this.addPlugin(t),!o.loaded(t)){var e=new Error(a("pluginAddedAndRestart",t));throw e.pluginName=t,e}},loadPlugins:function(t){var e=this.getOptions();return o.loadAll(e.plugins,t)},fixBootRunClasses:function(){var t=this.getOptions();if(t.run){var e=this.fixClassName(t.run.mainClass),n=this.fixClassName(t.run.bootClass);e==t.run.mainClass&&n==t.run.bootClass||(t.run.mainClass=e,t.run.bootClass=n,this.setOptions(t))}},fixClassName:function(e){if(t.classMetas[e])return e;const n=this.getNamespace();console.log("NS",n);let i=t.classes[n][e];if(i)return`${n}.${e}`;for(var r in t.classes)if(i=t.classes[r][e])return`${r}.${e}`;throw new Error(`Cannot fix className ${e}`)},rawBoot:function(e){this.showProgress("Running "+e),this.initCanvas(),t.run(e)},initCanvas:function(){t.globals.$mainCanvas=$("canvas")},showProgress:function(t){return console.log("PROGRESS",t),"undefined"!=typeof SplashScreen&&SplashScreen.progress(t),s.promise(function(t){setTimeout(t,0)})},nonSourceDirs:()=>({images:1,sounds:1,js:1,files:1,static:1,maps:1}),sourceFiles(){const t={},e=this.getEXT(),n=this.nonSourceDirs();for(let t of this.dir.listFiles())t.isDir()?n[t.name().replace(/[\/\\]$/,"")]||t.recursive(i):i(t);function i(n){if(n.endsWith(e)){var i=n.truncExt(e);t[i]=n}}return t}}}),n("miniJSLoader",["require","exports","module"],function(t,e,n){e.load=(t=>new Promise(e=>{const n=document.createElement("script");n.setAttribute("src",t),n.addEventListener("load",e),document.body.appendChild(n)}))}),n("compiledTonyuProject",["root","plugins","sysMod","miniJSLoader","WebSite"],function(t,e,n,i,r){return function(t){const e={getDir:()=>t,resolve(t){return this.getDir().rel(t)},getOptions(t){return this.getOptionsFile().obj()},getOptionsFile(){return this.getDir().rel("options.json")},setOptions(t){return this.getOptionsFile().obj(t)},getOutputFile(t){return this.getDir().rel("js/concat.js")},getEXT:()=>".tonyu",sourceFiles:()=>[],getDependingProjects:()=>[],async loadClasses(){await i.load(r.compiledKernel),await i.load("js/concat.js")},getNamespace(){var t=this.getOptions();return t.compiler&&t.compiler.namespace?t.compiler.namespace:"user"},requestPlugin:t=>t};return Object.assign(e,n),e}}),n("Shell",["FS","assert"],function(t,n){var i={},r=n(t.PathUtil);function o(e,n){var o=function(e){if("string"!=typeof e)return e;var n=i.cwd;return r.isAbsolutePath(e)?t.resolve(e,n):n.rel(e)}(e);if(t.SFile.is(o)||console.log(o," is not file"),n&&!o.exists())throw new Error(o+": no such file or directory");return o}return i.newCommand=function(t,e){this[t]=e},i.cd=function(t){return i.cwd=o(t,!0),i.pwd()},i.vars=Object.create(t.getEnv()),i.mount=function(e,n){if(e&&e.t)t.mount(n,e.t,e);else{var i=[];for(var r in t.getRootFS().availFSTypes())i.push(r);sh.err("-t=("+i.join("|")+") should be specified.")}},i.unmount=function(e){t.unmount(e)},i.fstab=function(){var e=this;t.getRootFS().fstab().forEach(function(t){e.echo(t.fstype()+"\t"+(t.mountPoint||"<Default>"))})},i.resolve=o,i.pwd=function(){return i.cwd+""},i.ls=function(t){return(t=t?o(t,!0):i.cwd).ls()},i.cp=function(t,e,n){n||(n={}),n.v&&(i.echo("cp",t,e),n.echo=i.echo.bind(i));var r=o(t,!0),s=o(e);return r.copyTo(s,n)},i.ln=function(t,e,n){var i=o(e),r=o(t,!0);if(i.isDir()&&i.exists()&&(i=i.rel(r.name())),i.exists())throw new Error(i+" exists");return i.link(r,n)},i.rm=function(t,e){if(e||(e={}),e.notrash)return(t=o(t,!1)).removeWithoutTrash(),1;if((t=o(t,!0)).isDir()&&e.r){var n=t,r=0;return n.each(function(t){t.exists()&&(r+=i.rm(t,e))}),n.rm(),r+1}return t.rm(),1},i.mkdir=function(t,e){if((t=o(t,!1)).exists())throw new Error(t+" : exists");return t.mkdir()},i.cat=function(t,e){return t=o(t,!0),i.echo(t.getContent(function(e){return t.isText()?e.toPlainText():e.toURL()}))},i.resolve=function(t){return t||(t="."),t=o(t)},i.grep=function(t,e,n){return e=o(e,!0),n||(n={}),n.res||(n.res=[]),e.isDir()?e.each(function(e){i.grep(t,e,n)}):"string"==typeof t&&e.lines().forEach(function(r,o){r.indexOf(t)>=0&&function(t,e,r){n.res&&n.res.push({file:t,lineNo:e,line:r});i.echo(t+"("+e+"): "+r)}(e,o+1,r)}),n.res},i.touch=function(t){return(t=o(t)).text(t.exists()?t.text():""),1},i.setout=function(t){i.outUI=t},i.echo=function(){return $.when.apply($,arguments).then(function(){console.log.apply(console,arguments),i.outUI&&i.outUI.log&&i.outUI.log.apply(i.outUI,arguments)})},i.err=function(t){console.log.apply(console,arguments),t&&t.stack&&console.log(t.stack),i.outUI&&i.outUI.err&&i.outUI.err.apply(i.outUI,arguments)},i.clone=function(){var t=Object.create(this);return t.vars=Object.create(this.vars),t},i.getvar=function(t){return this.vars[t]||process&&process.env[t]},i.get=i.getvar,i.set=function(t,e){return this.vars[t]=e},i.strcat=function(){if(1==arguments.length)return arguments[0];for(var t="",e=0;e<arguments.length;e++)t+=arguments[e];return t},i.exists=function(t){return(t=this.resolve(t)).exists()},i.dl=function(t){return(t=this.resolve(t||".")).download()},i.zip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.zip.apply(t.zip,n)},i.unzip=function(){var e=this,n=Array.prototype.slice.call(arguments).map(function(t){return"string"==typeof t?e.resolve(t):t});return t.zip.unzip.apply(t.zip,n)},i.prompt=function(){},i.ASYNC={r:"SH_ASYNC"},i.help=function(){for(var t in i){var e=i[t];"function"==typeof e&&i.echo(t+(e.description?" - "+e.description:""))}},window.sh||(window.sh=i),"object"==typeof process?(sh.devtool=function(){e("nw.gui").Window.get().showDevTools()},sh.cd(process.cwd().replace(/\\/g,"/"))):sh.cd("/"),i});var i=function(){var t=function(t){this.context=null,this.picoAudio=null,this.soundDataAry=[],this.bgmPlayerMax=16,this.bgmPlayerAry=[],this.masterVolume=1,this.seMasterVolume=1,this.bgmMasterVolume=1,this.playingAudio=null,this.audioVolume=1,this.audioTempo=1,this.audioDataAry={data:[]},this.seSources=[],this.init(t)};return t.prototype.init=function(t){if(!this.inited&&(this.inited=!0,!this.disabled&&(t?this.context=t:window.AudioContext?this.context=new AudioContext:window.webkitAudioContext?this.context=new webkitAudioContext:(this.context=null,console.log("Your browser does not support yet Web Audio API")),this.context)))for(var e=0;e<this.bgmPlayerMax;e++)this.bgmPlayerAry[e]=new r(this,e)},t.prototype.allClearSoundData=function(){var t=this.soundDataAry;for(var e in t)delete t[e]},t.prototype.clearSoundData=function(t){delete this.soundDataAry[t]},t.prototype.allRemoveDecodedSoundData=function(){var t=this.soundDataAry;for(var e in t){var n=t[e];null!=n&&((n.isDecodeComplete()||n.isDecoding())&&n.removeDecodedData())}},t.prototype.removeDecodedSoundData=function(t){var e=this.soundDataAry[t];null!=e&&(e.isDecodeComplete()||e.isDecoding())&&e.removeDecodedData()},t.prototype.getMasterVolume=function(){return this.masterVolume},t.prototype.setMasterVolume=function(t){this.masterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof r&&n.onChangeBGMMasterVolume()}},t.prototype.createSoundFromArray=function(t,e,n){if(!this.context||this.disabled)return null;this.soundDataAry[t]=new o(t);var i,r=this.context,s=null!=e&&null!=n?2:1,a=r.createBuffer(s,e.length,r.sampleRate),u=a.getChannelData(0),l=null!=n?a.getChannelData(1):null;for(i=0;i<e.length;i++)u[i]=e[i];if(l)for(i=0;i<n.length;i++)l[i]=n[i];this.soundDataAry[t].onDecodeComplete(a)},t.prototype.loadSound=function(t,e,n,i){if(!this.context||this.disabled)return null;this.soundDataAry[t]=new o(t),(e.match(/\.(midi?)$/)||e.match(/^data:audio\/mid/))&&null==this.picoAudio&&(this.picoAudio=new PicoAudio({audioContext:this.context,isSkipBeginning:!0,initReverb:0})),"object"==typeof WebSite&&WebSite.mp3Disabled&&(e=e.replace(/\.(mp3)$/,".ogg")),"object"==typeof WebSite&&WebSite.mp4Disabled&&(e=e.replace(/\.(mp4|m4a)$/,".ogg"));var r=this,s=new XMLHttpRequest;if(s.onload=function(){if(200===s.status||0===s.status){var e=s.response;e instanceof ArrayBuffer?(r.soundDataAry[t].onLoadComplete(e),i?r.decodeSound(t,n):n&&n.succ&&n.succ(t)):(r.soundDataAry[t].onError("XHR_RESPONSE_ERROR"),n&&n.err&&n.err(t,r.soundDataAry[t].errorID))}else r.soundDataAry[t].onError("XHR_STATUS_ERROR"),n&&n.err&&n.err(t,r.soundDataAry[t].errorID)},s.onerror=function(e){console.log(e+""),r.soundDataAry[t].onError("XHR_ERROR"),n&&n.err&&n.err(t,r.soundDataAry[t].errorID)},this.soundDataAry[t].onLoad(e),e.match(/^data:/)&&"undefined"!=typeof Util&&Util.Base64_To_ArrayBuffer)(s={onload:s.onload}).response=Util.Base64_To_ArrayBuffer(e.replace(/^data:audio\/[a-zA-Z0-9\-]+;base64,/i,"")),s.status=200,s.onload();else{s.open("GET",e,!0),s.responseType="arraybuffer";try{s.send(null)}catch(e){this.soundDataAry[t].onError("FILE_NOT_FOUND"),n&&n.err&&n.err(t,r.soundDataAry[t].errorID)}}},t.prototype.decodeSound=function(t,e){var n=this.soundDataAry[t];if(null!=n&&null!=n.fileData&&n.isLoadComplete()&&!n.isDecodeComplete()){if(null==n.decodedCallbacksAry&&(n.decodedCallbacksAry=[]),e)if(null!=e.bgmPlayerId)n.decodedCallbacksAry.some(function(t,i){return e.bgmPlayerId==t.bgmPlayerId&&(n.decodedCallbacksAry[i]=e,!0)})||n.decodedCallbacksAry.push(e);else n.decodedCallbacksAry.push(e);if(!n.isDecoding()){n.onDecode();var i=n.fileData.slice(0),r=this;if(n.url.match(/\.(midi?)$/)||n.url.match(/^data:audio\/mid/)){null==this.picoAudio&&(this.picoAudio=new PicoAudio({audioContext:this.context,isSkipBeginning:!0,initReverb:0}));var o=new Uint8Array(i),s=this.picoAudio.parseSMF(o);"string"==typeof s?(console.log("T2MediaLib: Error parseSMF()",s),this.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,this.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null):(this.soundDataAry[t].onDecodeComplete(s),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)}else if(n.url.match(/\.mzo$/)||n.url.match(/^data:audio\/mzo/))Mezonet.init().then(function(){var e=Array.prototype.slice.call(new Uint8Array(i));r.soundDataAry[t].onDecodeComplete(new Mezonet.Source(e)),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null},function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeMZO()",n.url),r.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,r.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null});else{if(n.url.match(/\.(ogg?)$/)||n.url.match(/^data:audio\/ogg/)){var a=this.searchOggLoop(i);n.tagLoopStart=a[0],n.tagLoopEnd=a[1]}this.context.decodeAudioData(i,function(e){r.soundDataAry[t].isDecoding()&&(r.soundDataAry[t].onDecodeComplete(e),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.succ&&e.succ(t)}),n.decodedCallbacksAry=null)},function(e){e instanceof Error?console.log("T2MediaLib: "+e.message,n.url):console.log("T2MediaLib: Error decodeAudioData()",n.url),r.soundDataAry[t].onError("DECODE_ERROR"),n.decodedCallbacksAry.forEach(function(e){"function"==typeof e.err&&e.err(t,r.soundDataAry[t].errorID)}),n.decodedCallbacksAry=null})}}}},t.prototype.activate=function(){if(this.init(),this.context){if(!this.isContextResumed&&this.context.resume){var t=this;this.context.resume().then(function(){t.isContextResumed=!0})}if(!this.isActivated){this.isActivated=!0;for(var e=this.context.createBuffer(1,Math.floor(this.context.sampleRate/32),this.context.sampleRate),n=e.getChannelData(0),i=0;i<n.length;i++)n[i]=0;var r=this.context.createBufferSource();r.buffer=e,r.connect(this.context.destination),r.start=r.start||r.noteOn,r.start(0)}}},t.prototype.getSoundFileData=function(t){var e=this.soundDataAry[t];return e?e.fileData:null},t.prototype.getSoundDecodedData=function(t){var e=this.soundDataAry[t];return e?e.decodedData:null},t.prototype.getCurrentTime=function(){return this.context?this.context.currentTime:null},t.prototype.playSE=function(t,e,n,i,r,o,s,a,u,l){if(!this.context)return null;var c,f=this.soundDataAry[t];if(null==f)return null;if(!f.isDecodeComplete()){var h=this,p={succ:function(t){h.playSE(t,e,n,i,r,o,s,a,u,l)},err:function(){}};return this.decodeSound(t,p),null}if(c=f.decodedData,"undefined"!=typeof Mezonet&&c instanceof Mezonet.Source){var d=f.decodedData.playback(this.context);return d.Start(),d}var g=f.decodedData;if(!(g instanceof AudioBuffer))return null;null==e&&(e=1),null==n&&(n=0),i||(i=1),r?r>g.duration?r=g.duration:r<0&&(r=0):r=0;var m=l;l||(m=86400),o||(o=!1),s?s<0?s=0:s>g.duration&&(s=g.duration):s=f.loopStart||0,a?a<0?a=0:a>g.duration&&(a=g.duration):a=g.duration,u=u||0;var y=this.context.createBufferSource();this.context.createGain=this.context.createGain||this.context.createGainNode;var v=this.context.createGain(),b=this.context.createPanner();y.buffer=g,y.loop=o,y.loopStart=s,y.loopEnd=a,y.playbackRate.value=i,y.connect(v),v.connect(b),b.connect(this.context.destination),b.panningModel="equalpower",n<-1?n=-1:n>1&&(n=1);var w,S=90*n,A=Math.sin(S*(Math.PI/180)),T=-Math.cos(S*(Math.PI/180));-1!==n&&1!==n||(T=0),b.positionX?(b.positionX.value=A,b.positionY.value=0,b.positionZ.value=T):b.setPosition(A,0,T),v.gain.value=e*this.seMasterVolume*this.masterVolume,w=o&&a-s>0&&r>a?a:r,y.gainNode=v,y.volumeValue=e,y.panNode=b,y.panValue=n,y.playStartTime=this.context.currentTime+u,y.playOffset=w,y.plusTime=w,y.start=y.start||y.noteOn,y.stop=y.stop||y.noteOff,y.start(u,r,m),o&&null!=l&&y.stop(u+l);var x=this;return x.seSources.push(y),y.onended=function(t){y.onended=null;var e=x.seSources.indexOf(y);e>=0&&x.seSources.splice(e,1)},y},t.prototype.stopSE=function(t){if(!(t instanceof AudioBufferSourceNode))return null;try{t.stop(0)}catch(e){t.gainNode&&(t.gainNode.gain.cancelScheduledValues(this.context.currentTime),t.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime))}return t},t.prototype.stopAllSE=function(t){var e=this;this.seSources.forEach(function(t){e.stopSE(t)})},t.prototype.getSEMasterVolume=function(){return this.seMasterVolume},t.prototype.setSEMasterVolume=function(t){this.seMasterVolume=t},t.prototype.getSEVolume=function(t){return t instanceof AudioBufferSourceNode?t.volumeValue:null},t.prototype.setSEVolume=function(t,e){return t instanceof AudioBufferSourceNode?(t.gainNode.gain.value=e*this.seMasterVolume*this.masterVolume,t.volumeValue=e,t):null},t.prototype.getSERate=function(t){return t instanceof AudioBufferSourceNode?t.playbackRate.value:null},t.prototype.setSERate=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.playbackRate.value=e},t.prototype.getSEPan=function(t){return t instanceof AudioBufferSourceNode?t.panValue:null},t.prototype.setSEPan=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;var n=t.panNode;e<-1?e=-1:e>1&&(e=1);var i=90*e,r=Math.sin(i*(Math.PI/180)),o=Math.cos(i*(Math.PI/180));-1!==e&&1!==e||(o=0),n.positionX?(n.positionX.value=r,n.positionY.value=0,n.positionZ.value=o):n.setPosition(r,0,o),t.panValue=e},t.prototype.isSELoop=function(t){return t instanceof AudioBufferSourceNode?t.loop:null},t.prototype.setSELoop=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.loop=e},t.prototype.getSELoopStartTime=function(t){return t instanceof AudioBufferSourceNode?t.loopStart:null},t.prototype.setSELoopStartTime=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.loopStart=e},t.prototype.getSELoopEndTime=function(t){return t instanceof AudioBufferSourceNode?t.loopEnd:null},t.prototype.setSELoopEndTime=function(t,e){if(!(t instanceof AudioBufferSourceNode))return null;t.loopEnd=e},t.prototype.playBGM=function(t,e,n,i,r,o){if(!this.context)return null;var s=this._getBgmPlayer(t);return s?s.playBGM(e,n,i,r,o):null},t.prototype.stopBGM=function(t){var e=this._getBgmPlayer(t);return e?e.stopBGM():null},t.prototype.pauseBGM=function(t){var e=this._getBgmPlayer(t);return e?e.pauseBGM():null},t.prototype.resumeBGM=function(t){var e=this._getBgmPlayer(t);return e?e.resumeBGM():null},t.prototype.getBGMMasterVolume=function(){return this.bgmMasterVolume},t.prototype.setBGMMasterVolume=function(t){this.bgmMasterVolume=t;for(var e=0;e<this.bgmPlayerMax;e++){var n=this.bgmPlayerAry[e];n instanceof r&&n.onChangeBGMMasterVolume()}},t.prototype.getBGMVolume=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMVolume():null},t.prototype.setBGMVolume=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMVolume(e):null},t.prototype.getBGMTempo=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMTempo():null},t.prototype.setBGMTempo=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMTempo(e):null},t.prototype.getBGMPan=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPan():null},t.prototype.setBGMPan=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMPan(e):null},t.prototype.isBGMLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isBGMLoop():null},t.prototype.setBGMLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoop(e):null},t.prototype.getBGMLoopStartTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopStartTime():null},t.prototype.setBGMLoopStartTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopStartTime(e):null},t.prototype.getBGMLoopEndTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLoopEndTime():null},t.prototype.setBGMLoopEndTime=function(t,e){var n=this._getBgmPlayer(t);return n?n.setBGMLoopEndTime(e):null},t.prototype.getBGMCurrentTime=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMCurrentTime():null},t.prototype.getBGMLength=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMLength():null},t.prototype.getPlayingBGMName=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMName():null},t.prototype.setOnBGMEndListener=function(t,e){var n=this._getBgmPlayer(t);return n?n.setOnBGMEndListener(e):null},t.prototype.getPlayingBGMState=function(t){var e=this._getBgmPlayer(t);return e?e.getPlayingBGMState():null},t.prototype.getBGMPicoAudio=function(t){var e=this._getBgmPlayer(t);return e?e.getBGMPicoAudio():null},t.prototype.isTagLoop=function(t){var e=this._getBgmPlayer(t);return e?e.isTagLoop():null},t.prototype.setTagLoop=function(t,e){var n=this._getBgmPlayer(t);return n?n.setTagLoop(e):null},t.prototype.getBGMPlayerMax=function(){return this.bgmPlayerMax},t.prototype.allStopBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t)},t.prototype.allResetBGM=function(){for(var t=0;t<this.bgmPlayerMax;t++)this.stopBGM(t),this.setBGMVolume(t,1),this.setBGMTempo(t,1),this.setBGMPan(t,0);this.setMasterVolume(1),this.setSEMasterVolume(1),this.setBGMMasterVolume(1)},t.prototype._getBgmPlayer=function(t){if(t<0||this.bgmPlayerMax<=t)return null;var e=this.bgmPlayerAry[t];return e instanceof r?e:null},t.prototype.loadAudio=function(t,e){var n=new Audio(e);n.play(),this.audioDataAry.data[t]=null;var i=this;n.addEventListener("loadstart",function(){if(!i.context)return null;i.context.createMediaElementSource(n).connect(i.context.destination)},!1),n.addEventListener("canplay",function(){this.audioDataAry.data[t]=n},!1),n.load()},t.prototype.playAudio=function(t,e,n){var i=this.audioDataAry.data[t];return i?(n||(n=0),this.playingAudio instanceof Audio&&(this.playingAudio.pause(),this.playingAudio.currentTime=0),this.playingAudio=i,i.loop=e,i.volume=this.audioVolume,i.currentTime=n,i.play(),i):null},t.prototype.stopAudio=function(){var t=this.playingAudio;return t instanceof Audio?(t.pause(),t.currentTime=0,this.playingAudio=null,t):null},t.prototype.pauseAudio=function(){var t=this.playingAudio;return t?(t.pause(),t):null},t.prototype.resumeAudio=function(){var t=this.playingAudio;return t?(t.play(),t):null},t.prototype.setAudioVolume=function(t){this.audioVolume=t,this.playingAudio instanceof Audio&&(this.playingAudio.volume=t)},t.prototype.setAudioTempo=function(t){this.audioTempo=t,this.playingAudio instanceof Audio&&(this.playingAudio.playbackRate=t)},t.prototype.setAudioPosition=function(t){this.playingAudio instanceof Audio&&(this.playingAudio.currentTime=t)},t.prototype.getAudioData=function(t){return this.audioDataAry.data[t]},t.prototype.getAudioCurrentTime=function(){return this.playingAudio instanceof Audio?this.playingAudio.currentTime:null},t.prototype.getAudioLength=function(){return this.playingAudio instanceof Audio?this.playingAudio.duration:null},t.prototype.searchOggLoop=function(t){var e=new Uint8Array(t.slice(0,3e3)),n=String.fromCharCode.apply(null,e);if(-1==n.lastIndexOf("vorbis",34))return[0,0];var i,r,o,s=n.indexOf("LOOPSTART="),a=n.indexOf("LOOPLENGTH="),u=0,l=0,c=e[40]+(e[41]<<8)+(e[42]<<16)+(e[43]<<24);if(-1!=s)for(i=e[s]+(e[s+1]<<8)+(e[s+2]<<16)+(e[s+3]<<24),r=s+10;r<s+i&&!((o=n[r])<"0"||o>"9");r++)u=10*u+(o-"0");if(-1!=a)for(i=e[a]+(e[a+1]<<8)+(e[a+2]<<16)+(e[a+3]<<24),r=a+11;r<a+i&&!((o=n[r])<"0"||o>"9");r++)l=10*l+(o-"0");var f=(u+l)/c;return[u/=c,f]},t}(),r=function(){function t(t){return"undefined"!=typeof PicoAudio&&t instanceof PicoAudio}function e(t){return"undefined"!=typeof Mezonet&&t instanceof Mezonet.Playback}var n=function(t,e){this.t2MediaLib=t,this.id=e,this.playingBGMState="stop",this.playingBGMStatePending=null,this.playingBGM=null,this.playingBGMName=null,this.bgmPause=0,this.bgmPauseTime=0,this.bgmPauseCurrentTime=0,this.bgmPauseTempo=0,this.bgmPauseLoop=!1,this.bgmPauseLoopStart=0,this.bgmPauseLoopEnd=0,this.bgmVolume=1,this.bgmTempo=1,this.bgmPan=0,this.picoAudio=null,this.picoAudioSetDataBGMName=null,this.PICO_AUDIO_VOLUME_COEF=1,this.isTagLoop=!0};return n.prototype.playBGM=function(t,e,n,i,r){this.stopBGM();var o=this.t2MediaLib.soundDataAry[t];if(null==o)return null;if(!o.isDecodeComplete()){var s=this,a={};return a.bgmPlayerId=this.id,a.succ=function(){var a=function(){var o=s.playingBGMStatePending;s._setPlayingBGMState("stop",!0),"stop"!=o&&s.playingBGMName==t&&s.playBGM(t,e,n,i,r),"pause"==o&&s.pauseBGM()};o.decodedData instanceof Object?setTimeout(function(){a()},0):a()},a.err=function(){s._setPlayingBGMState("stop",!0)},this.playingBGMName=t,this._setPlayingBGMState("decoding",!0),this._setPlayingBGMState("play"),this.t2MediaLib.decodeSound(t,a),this}var u=o.decodedData;if("undefined"!=typeof Mezonet&&u instanceof Mezonet.Source){var l=u.playback(this.t2MediaLib.context);this.playingBGM=l,l.Start()}else if(u instanceof AudioBuffer)this.isTagLoop&&(i=i||o.tagLoopStart,r=r||o.tagLoopEnd),this.playingBGM=this.t2MediaLib.playSE(t,this.bgmVolume,this.bgmPan,this.bgmTempo,n,e,i,r);else if(u instanceof Object){if(this._initPicoAudio(),t!=this.picoAudioSetDataBGMName?(this.picoAudio.setData(u),this.picoAudioSetDataBGMName=t):this.picoAudio.initStatus(),this.picoAudio.setLoop(e),this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*this.bgmVolume*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),n){var c=this.picoAudio.getTime(Number.MAX_SAFE_INTEGER);n>c?n=c:n<0&&(n=0)}else n=0;this.picoAudio.setStartTime(n),this.picoAudio.play(),this.playingBGM=this.picoAudio}return this.playingBGMName=t,this.bgmPause=0,this._setPlayingBGMState("play"),this},n.prototype.stopBGM=function(){var n=this.playingBGM;if(e(n))n.Stop();else if(t(n))this.picoAudio.stop();else if(n instanceof AudioBufferSourceNode)try{n.stop(0)}catch(t){n.gainNode&&(n.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),n.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}return this.playingBGM=null,this.playingBGMName=null,this._setPlayingBGMState("stop"),this},n.prototype.pauseBGM=function(){var n=this.playingBGM;if(e(n))n.pause();else if(t(n))0===this.bgmPause&&(this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseCurrentTime=n.context.currentTime,n.stop(),this.bgmPause=1);else if(n instanceof AudioBufferSourceNode&&0===this.bgmPause){this.bgmPauseTime=this.getBGMCurrentTime(),this.bgmPauseLoopStart=this.t2MediaLib.getSELoopStartTime(n),this.bgmPauseLoopEnd=this.t2MediaLib.getSELoopEndTime(n),this.bgmPauseLoop=this.t2MediaLib.isSELoop(n),this.bgmPauseCurrentTime=n.context.currentTime,this.bgmPauseTempo=this.bgmTempo;try{n.stop(0)}catch(t){n.gainNode&&(n.gainNode.gain.cancelScheduledValues(this.t2MediaLib.context.currentTime),n.gainNode.gain.linearRampToValueAtTime(0,this.t2MediaLib.context.currentTime))}this.bgmPause=1}return"stop"!=this.playingBGMState&&this._setPlayingBGMState("pause"),this},n.prototype.resumeBGM=function(){var n=this.playingBGM;return e(n)?n.resume():t(n)?1===this.bgmPause&&(n.play(),this.bgmPause=0):n instanceof AudioBufferSourceNode&&1===this.bgmPause&&(n=this.playBGM(this.playingBGMName,this.bgmPauseLoop,this.bgmPauseTime,this.bgmPauseLoopStart,this.bgmPauseLoopEnd)),this},n.prototype.onChangeBGMMasterVolume=function(){this.setBGMVolume(this.getBGMVolume())},n.prototype.getBGMVolume=function(){return this.bgmVolume},n.prototype.setBGMVolume=function(n){var i=this.playingBGM;return this.bgmVolume=n,e(i)?i.setVolume(n):t(i)?this.picoAudio.setMasterVolume(this.PICO_AUDIO_VOLUME_COEF*n*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume):i instanceof AudioBufferSourceNode&&(i.gainNode.gain.value=n*this.t2MediaLib.bgmMasterVolume*this.t2MediaLib.masterVolume),this},n.prototype.getBGMTempo=function(){return this.bgmTempo},n.prototype.setBGMTempo=function(t){var n=this.playingBGM;return(t<=0||isNaN(t))&&(t=1),e(n)?(n.setRate(t),this):(n instanceof AudioBufferSourceNode&&0===this.bgmPause&&(n.plusTime-=(this.t2MediaLib.context.currentTime-n.playStartTime)*(t-this.bgmTempo)),this.bgmTempo=t,this.t2MediaLib.setSERate(n,t),this)},n.prototype.getBGMPan=function(){return this.bgmPan},n.prototype.setBGMPan=function(t){var e=this.playingBGM;return this.bgmPan=t,e instanceof AudioBufferSourceNode&&this.t2MediaLib.setSEPan(e,t),this},n.prototype.isBGMLoop=function(){var e=this.playingBGM;return t(e)?this.picoAudio.isLoop():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoop:this.t2MediaLib.isSELoop(e):null},n.prototype.setBGMLoop=function(e){var n=this.playingBGM;return t(n)?this.picoAudio.setLoop(e):n instanceof AudioBufferSourceNode&&(1===this.bgmPause?this.bgmPauseLoop=e:this.t2MediaLib.setSELoop(n,e)),this},n.prototype.getBGMLoopStartTime=function(){var e=this.playingBGM;return t(e)?0:e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopStart:this.t2MediaLib.getSELoopStartTime(e):null},n.prototype.setBGMLoopStartTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopStartTime(e,t);this.bgmPauseLoopStart=t}return this},n.prototype.getBGMLoopEndTime=function(){var e=this.playingBGM;return t(e)?this.getBGMLength():e instanceof AudioBufferSourceNode?1===this.bgmPause?this.bgmPauseLoopEnd:this.t2MediaLib.getSELoopEndTime(e):null},n.prototype.setBGMLoopEndTime=function(t){var e=this.playingBGM;if(e instanceof AudioBufferSourceNode){if(1!==this.bgmPause)return this.t2MediaLib.setSELoopEndTime(e,t);this.bgmPauseLoopEnd=t}return this},n.prototype.getBGMCurrentTime=function(){var n,i,r,o,s,a,u,l=this.playingBGM;return e(l)?l.getTrackTime():t(l)?n=0===this.bgmPause?this.picoAudio.context.currentTime-this.picoAudio.states.startTime:this.bgmPauseTime:l instanceof AudioBufferSourceNode?(0===this.bgmPause?(r=this.t2MediaLib.context.currentTime,o=this.bgmTempo):(r=this.bgmPauseCurrentTime,o=this.bgmPauseTempo),i=(r-l.playStartTime)*o+l.plusTime,l.loop&&(l.loopEnd-l.loopStart>0?i<l.loopStart?(s=0,a=0,u=l.buffer.duration):(s=l.loopStart,a=l.loopStart,u=l.loopEnd-l.loopStart):(u=l.buffer.duration,s=0,a=0)),l.loop?n=(i-a)%u+s:(n=i)>l.buffer.duration&&(n=l.buffer.duration),n):null},n.prototype.getBGMLength=function(){var e=this.playingBGM;return t(e)?this.picoAudio.getTime(Number.MAX_SAFE_INTEGER):e instanceof AudioBufferSourceNode?e.buffer.duration:null},n.prototype.getPlayingBGMName=function(){return this.playingBGMName},n.prototype.setOnBGMEndListener=function(t){null!=this.picoAudio&&this.picoAudio.setOnSongEndListener(t)},n.prototype.getPlayingBGMState=function(){return this.playingBGMState},n.prototype.getBGMPicoAudio=function(){return this._initPicoAudio(),this.picoAudio},n.prototype.isTagLoop=function(){return this.isTagLoop},n.prototype.setTagLoop=function(t){this.isTagLoop=t},n.prototype._setPlayingBGMState=function(t,e){e||"decoding"!=this.playingBGMState?(this.playingBGMState=t,this.playingBGMStatePending=null):this.playingBGMStatePending=t},n.prototype._initPicoAudio=function(){null==this.picoAudio&&(0==this.id&&(this.picoAudio=this.t2MediaLib.picoAudio),null==this.picoAudio&&(this.picoAudio=new PicoAudio({audioContext:this.context,picoAudio:this.t2MediaLib.picoAudio,isSkipBeginning:!0,initReverb:0})))},n}(),o=function(){var t=function(t,e){this.idx=t,this.state="none",this.errorID=null,this.url=null,this.fileData=null,this.decodedData=null,this.decodedCallbacksAry=null,this.tagLoopStart=0,this.tagLoopEnd=0};return t.prototype.onLoad=function(t){this.state="loading",this.url=t},t.prototype.onLoadComplete=function(t){this.state="loaded",this.fileData=t},t.prototype.onDecode=function(){this.state="decoding"},t.prototype.onDecodeComplete=function(t){this.state="decoded",this.decodedData=t},t.prototype.onError=function(t){this.state="error",this.errorID=t},t.prototype.isNone=function(){return"none"==this.state},t.prototype.isLoadComplete=function(){switch(this.state){case"loaded":case"decoding":case"decoded":return!0}return!1},t.prototype.isDecoding=function(){return"decoding"==this.state},t.prototype.isDecodeComplete=function(){return"decoded"==this.state},t.prototype.removeDecodedData=function(){this.state="loaded",this.decodedData=null},t}();window.T2MediaLib=i,window.T2MediaLib_BGMPlayer=r,window.T2MediaLib_SoundData=o,n("T2MediaLib",function(t){return function(){return t.T2MediaLib}}(this)),n("exceptionCatcher",[],function(){var t={f:function(e){if("function"==typeof e){if(e.isTrcf)return e;var n=function(){if(!t.handleException||t.enter)return e.apply(this,arguments);try{return t.enter=!0,e.apply(this,arguments)}catch(e){t.handleException(e)}finally{t.enter=!1}};return n.isTrcf=!0,n}if("object"==typeof e){for(var i in e)e[i]=t.f(e[i]);return e}}};return t}),n("UI",["Util","exceptionCatcher"],function(t,e){var n={},i=e.f;return(n=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var o=[],s={},a=[],u=l(e);return u.$edits=a,u.$vars=s,$.data(u,"edits",a),$.data(u,"vars",s),a.load=function(t){a.model=t,a.forEach(function(t){a.writeToJq(t.params.$edit,t.jq)}),a.validator.on.validate.call(a.validator,a.model)},a.writeToJq=function(t,e){var n=a.model;if(n){for(var i=t.name.split("."),r=0;r<i.length;r++)n=n[i[r]];n=t.type.toVal(n),"checkbox"==e.attr("type")?e.prop("checked",!!n):e.val(n)}},a.validator={errors:{},show:function(){if(s.validationMessage)for(var t in s.validationMessage.empty(),this.errors)s.validationMessage.append(n("div",this.errors[t].mesg));if(s.OKButton){var e=!0;for(var t in this.errors)e=!1;s.OKButton.attr("disabled",!e)}},on:{validate:function(){}},addError:function(t,e,n){this.errors[t]={mesg:e,jq:n},this.show()},removeError:function(t){delete this.errors[t],this.show()},allOK:function(){for(var t in this.errors)delete this.errors[t];this.show()},isValid:function(){var t=!0;for(var e in this.errors)t=!1;return t}},a.writeToModel=function(t,e,n){var i=a.model;if(i){var r=t.name;try{e=t.type.fromVal(e)}catch(t){return void a.validator.addError(r,t,n)}a.validator.removeError(r);for(var o=r.split("."),s=0;s<o.length;s++)s==o.length-1?a.on.writeToModel(r,e)||(i[o[s]]=e):i=i[o[s]];a.validator.on.validate.call(a.validator,a.model)}},a.on={},a.on.writeToModel=function(t,e){},o.length>0&&setTimeout(i(function t(){o.forEach(function(t){t()});setTimeout(i(t),50)}),50),u;function l(e){return e instanceof Array?function(e){var r=e[0],u=1,c=$("<"+r+">");"object"!=typeof e[u]||e[u]instanceof Array||e[u]instanceof $||(!function(e,r,u){r.$var&&(s[r.$var]=e);r.$edit&&("string"==typeof r.$edit&&(r.$edit={name:r.$edit,type:n.types.String}),r.on||(r.on={}),r.on.realtimechange=i(function(t){a.writeToModel(r.$edit,t,e)}),s[r.$edit.name]||(s[r.$edit.name]=e),a.push({jq:e,params:r}));for(var l in r)if("on"==l)for(var c in r.on)f(c,r.on[c]);else"css"==l&&null!=r[l]?e.css(r[l]):t.startsWith(l,"$")||null==r[l]||e.attr(l,r[l]);function f(t,n){if(n)if("enterkey"==t)e.on("keypress",i(function(t){13==t.which&&n.apply(e,arguments)}));else if("realtimechange"==t){var s,a=!0;o.push(function(){var t;t="checkbox"==r.type?!!e.prop("checked"):e.val(),(a||s!=t)&&(n.apply(e,[t,s]),s=t),a=!1})}else e.on(t,i(n))}}(c,e[u]),u++);for(;u<e.length;)c.append(l(e[u])),u++;return c}(e):"string"==typeof e?(r=e,$(document.createTextNode(r))):e;var r}}).types={String:{toVal:function(t){return t},fromVal:function(t){return t}},Number:{toVal:function(t){return t+""},fromVal:function(t){return parseFloat(t)}}},n}),n("UIDiag",["UI","R","root"],function(t,e,n){var i={};function r(){let t;try{t=n.Tonyu.globals.$currentProject}catch(t){}t&&"function"==typeof t.requestPlugin&&t.requestPlugin("jquery_ui")}function o(t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t}function s(t,e){return null==t&&(t=""),o(t)?{title:e,body:a(t)}:"undefined"!=typeof $&&t instanceof $?{title:t.title||e,body:t}:(o(t.body)&&(t.body=a(t.body)),t)}function a(e){var n=(e+"").split("\n");return 1==n.length?n[0]:t.apply(this,["div"].concat(n.map(function(t){return["div",t]})))}return i.confirm=function(n){if(i.useNative){const t=window.confirm(...arguments);return i.afterModal(),t}r(),n=s(n,e("confirm"));var o=t("div",{title:n.title},["div",n.body],["button",{on:{click:u(!0)}},"OK"],["button",{on:{click:u(!1)}},e("cancel")]).dialog({width:"auto",close:u(!1)}),a=$.Deferred();function u(t){return function(){a.resolve(t),o.dialog("close"),o.remove()}}return a.promise()},i.alert=function(o){if(i.useNative){const t=window.alert(...arguments);return n.Tonyu&&n.Tonyu.resetLoopCheck(),t}r(),o=s(o,e("confirm"));var a=t("div",{title:o.title},["div",o.body],["button",{on:{click:l(!0)}},"OK"]).dialog({width:"auto",close:l(!1)}),u=$.Deferred();function l(t){return function(){u.resolve(t),a.dialog("close"),a.remove()}}return u.promise()},i.open=function(t,e,n,r,o,s,a){return i.prompt({title:t,body:e},n,{left:r,top:o,width:s,height:a})},i.getStatus=function(){return i.status},i.getText=function(){return i.val?i.val.val():""},i.afterModal=function(){try{n.Tonyu.resetLoopCheck()}catch(t){}try{n.Tonyu.globals.$Scheduler.resetLastSteps()}catch(t){}},i.prompt=function(n,o,a){if(i.useNative){const t=window.prompt(...arguments);return i.afterModal(),t}let u;r(),n=s(n,e("input")),u="number"==typeof(a=a||{}).left&&"number"==typeof a.top?{my:"left top",at:"left+"+a.left+" top+"+a.top,of:"body"}:{of:"body",at:"center",my:"center"};var l=t("div",{title:n.title},["div",n.body],["input",{on:{enterkey:f},$var:"val",value:o}],["br"],["button",{on:{click:f}},"OK"],["button",{on:{click:function(){i.status=2,l.dialog("close"),l.remove(),c.resolve()}}},e("cancel")]).dialog({width:a.width||"auto",height:a.height||"auto",position:u,close:function(){l.dialog("close"),c.resolve()}});setTimeout(function(){l.$vars.val.focus()},10),i.status=0,i.val=l.$vars.val;var c=$.Deferred();function f(){i.status=1;var t=l.$vars.val.val();i.resultValue=t,c.resolve(t),l.dialog("close"),l.remove()}return c.promise()},"undefined"!=typeof window&&(window.UIDiag=i),i}),n("runtime",["ImageList","T2MediaLib","UIDiag"],function(t,e,n){return console.log("runtimes loaded",arguments),window.T2MediaLib||(window.T2MediaLib=e),{ImageList:t,T2MediaLib:e,UIDiag:n}}),n("LSFS",["FS"],function(t){return t.LSFS}),n("runScript_common",["root","WebSite"],function(t,e){return t.SplashScreen={hide:function(){$("#splash").hide()},show:function(){},progress:function(t){$("#splash .progress").text(t)}},{initCanvas:function(t){var n=$(window).width(),i=$(window).height();$("body").css({overflow:"hidden",margin:"0px"});var r=$("<canvas>").attr({width:n-0,height:i-0,class:"tonyu-canvas"}).appendTo("body"),o=navigator.userAgent.toLowerCase();return null==t&&(t=-1==o.indexOf("iphone")&&-1==o.indexOf("ipad")&&-1==o.indexOf("ipod")&&(!window.parent||window===window.parent),null!=e.doResize&&(t=e.doResize)),t&&$(window).resize(function(){var t=0;n=$(window).width(),i=$(window).height(),r.attr({width:n-t,height:i-t})}),r}}}),t(["FS","compiledTonyuProject","Shell","runtime","WebSite","LSFS","Tonyu","root","runScript_common"],function(t,e,n,i,r,o,s,a,u){$(function(){const i=u.initCanvas();let l,c,f;if(r.isNW){var h=process.cwd().replace(/\\/g,"/");f=location.href.replace(/^chrome-extension:\/\/\w*/,""),(c=t.get(h+f)).isDir()||(c=c.up()),l=c}else{var p=location.href.replace(/[\?#].*/,"").split(/\//);f=p.pop()||"runscript";var d=p.pop()||"nobody";c=t.get(r.tonyuHome);var g=t.get("/ram/");t.mount(g.path(),o.ramDisk()),l=g;var m=c.rel(d+"/"+f+"/");g.rel("files/").link(m)}r.compiledKernel="js/kernel.js","BA"===r.serverType&&window.runtimePath&&(r.compiledKernel=window.runtimePath+"lib/tonyu/kernel.js"),a.loadFiles(l);const y=e(l);n.cd(l),s.globals.$mainCanvas=i,s.runMode=!0,s.animationFrame=(()=>new Promise(requestAnimationFrame)),function(){s.currentProject=s.globals.$currentProject=y;var t=y.getOptions();y.runScriptMode=!0,y.rawRun(t.run.bootClass)}()})}),n("runScript2",function(){})}();
//# sourceMappingURL=runScript2_concat.min.js.map