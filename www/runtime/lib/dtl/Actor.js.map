{"version":3,"sources":["/home/devel/devel/Turtle/Actor.dtl"],"names":[],"mappings":"4BACC,cAAG;CACH,SAAE,WAFD,sBAEU;;SAAM,cAAO,MAAkB,UAAZ,eAF7B,AAEoC;;CACrC,kBAAO;CACP,aAAM,QAAI,YAAK;CACf,aAAM,QALN;CAMA,aAAM,QANL,sBAMW;;QANV;;QAAD,AAMe;GAAG,UAAO,SANxB;;QAAD,AAMuB;IAAS,YAN/B;;QAAF;;;CAQA,aAAM,kBARL,sBAQqB;;QAClB,SAGE,YAHE,gBAEJ,kDAXH,AAUiC;;CAIlC,aAAM,gBAdL,sBAcmB,IAAI;;;;;;CAdvB,AAeG,IAAI,SAAO,YAfd,AAeU;CAfV,AAgBG,IAAI,SAAO,YAhBd,AAgBU;CAhBV,AAiBG,EAjBH;QAAA,AAkBG,GAAM,cAUJ,SA5BJ;;CAAD,AAmBO,EAnBN;CAAD,AAoBO,EApBP,AAoBS,CAAgB,mBApBzB,AAoBc,CAAE,aAA0B,QApB3C;CAAC,AAqBO,GArBP,AAqBU,CAAE,SAAM,aAAU,UAAuB,UArBnD,AAqBqC,CAAE;CArBvC,AAsBO,CAGE,SAzBP,sBAsBW;;CAtBX,AAuBS,GAvBT,AAuBY,EAAG;QAvBjB,AAwBW,CAA+B,kBAxBxC,AAwBc,KAxBhB,AAwBqB,CAAO,kBAxB1B,AAwBsB;;CAxBxB,AA0BO,GAAU,YA1BjB,AA0Bc;QA1Bd,AA2BO,CAAY,iBA3BnB,AA2BY,IA3BZ,AA2BgB;;;CAGjB,aAAM,SA9BL;;CA+BG,aAAe,SA/BlB;KAgCI;CACD,kBAAU;QAjCb;;CAoCD,aAAM,SApCL;;;CAqCG,aAAe,YArClB;CAsCG,kBAAU;QAtCb;;CAyCD,aAAsB,6BAAsB;CAC5C,aAAM,UAAM,aAAO;CACnB,aAAM,SAAM,YAAQ,aAAM;CAC1B,aAAM,SAAM,WA5CX,sBA4CoB;;;CA5CpB,AA6CG,EAAE,eAAc,aA7CnB,AA6CgB;CA7Cf;;SAAD,AA8CI,GA9CL;GA8Ca,UAEP,YAhDJ;;QA+CM,eAAkB,YA/CzB,AA+CkB,IA/ClB;;QAAC;;QAAD,AAiDI,CAAE;GAAW,UAA0B,YAjD1C;;QAAD,AAiDuB,CAAE,WAAU;;;CAEpC,aAAM,SAAM,QAnDX,sBAmDiB;;;CAnDhB;;QAAD,AAoDI,CAAE;GAAiB,UAAQ,SApD9B;;WAoD8D,YApD9D;;QAoDqC,cAAkB,iBApDxD,AAoDqD;;CApDrD,AAqDG,EAAE,eAAc,aArDnB,AAqDgB;QArDf;;SAAD,AAsDI,EAtDL;GAsDY,UAGN,YAzDJ;;CAuDM,eAAc,UAvDrB,AAuDkB;QACX,eAAsB,YAxD7B,AAwDkB,CAAE;;;CAIrB,aAAM,YA5DL;;;;;;;;;CA6DG,YAAI,SAAU;CACd,eAAsB,eAAL;CA9DpB,AA+DG,KAAK,SAAa,YAAR;CA/Db,AAgEG,MAAO,cAAe,eAAI,QAhE9B;CAAC,AAiEG,QAAQ,cAA0B,gBAjErC,AAiEmB,KAAM,mBAjEhB;CAAT,AAkEG,QAAQ,cAA2B,gBAlEtC,AAkEmB,KAAM,oBAlEhB;CAAT,AAmEG,OAnEH,AAmES,IAAO,aAnEP;CAAT,AAoEG,OApEH,AAoES,IAAO,cApEP;CAAR;;SAAD,AAqEI,MArEL;GAqEgB,UAAsB,YArEpC;;QAAD,AAqEqB,OArErB,AAqE0B,KApEzB,MADO;;CAAP;;SAAD,AAsEI,OAtEL;GAsEiB,UAAwB,YAtEvC;;QAAD,AAsEsB,QAtEtB,AAsE4B,MArE3B,MADO;;CAAP;;SAuEG,WAAI,aAvET;GAuEsB,UAQhB,YA/EJ;;QAyEM,gBAAY,wBACM,2BACF,kBA3EvB,AA2EgB,OACQ,mBA5ExB,AA4EiB,OACY,8BACf;;CAEX,cAAQ,WAAU;CAhFpB;;SAiFG,aAAM,aAjFX;GAiFwB,UAIlB,YArFJ;;QAkFM,kBAAa,sBACoD,yCAnFxE,AAmFkC,KAnFjC,cAAD,AAmF+C,KAnF9C,yBAoFY,cAAL;;CApFR,AAsFG,EAtFH;CAAA,AAuFG,CAAE,eAvFJ,sBAuFiB,MAAM;;CAvFtB;;SAAD,AAwFO,OAxFT;GAwFqB,UAAwB,YAxF1C;;QAAD,AAwFyB,QAxFzB,AAwF+B,MAvF/B,MADO;;SAAR,AAyFQ,CAAE,QAAuB,kBAzFhC,AAyFyB,OAA6B,mBAzFtD,AAyF+C;;CAE5C,cAUkB,iBArGrB;;;;;;CAAA,AA4FM,QAAQ,cAA0B,gBA5FzC,AA4FuB,KAAM,mBA5FpB;CAAR,AA6FM,QAAQ,cAA2B,gBA7F1C,AA6FuB,KAAM,oBA7FpB;CA8FF,kBAAW,cAA4B,iBA9F9C,AA8F2B,CAAE,QAAY;CAClC,kBAAW,cAA6B,iBA/F/C,AA+F2B,CAAE,QAAa;QA/FxC;;QAiGS,UAAuC,WAjGjD,AAiGc,QAAO,sBAjGrB,AAiGgC,QAAO;GAC/B,UAED,YApGN;;QAAF,AAmGW,CAAE,cAAyB,aAnGrC,AAmGwB,QAnGxB,AAmG+B;;GAEpB,UArGZ,QAIQ;CAJR,AAsGG,IAKE,WA3GJ;;CAAD,AAuGO,OAvGP,AAuGa,IAAO,aAvGX;CAAT,AAwGO,OAxGP,AAwGa,IAAO,cAxGX;CAAP;;SAAF,AAyGQ,MAzGT;GAyGoB,UAAsB,YAzGvC;;QAAF,AAyGyB,OAzGzB,AAyG8B,KAxG7B,MADO;;SAAR,AA0GQ,CAAE,UAAyE,yCA1GnF,AA0G6C,KA1G5C,cAAD,AA0G0D,KA1GzD;;QA4GE,aAAM,YAAQ;;CAElB,aAAO;CAGP,aAAM,YAjHL,sBAiHe;;CAjHf,AAkHG,OAAS,SAlHZ,AAkHQ;CACL,iBAAS;CACT,kBApHH,AAoHa;CACV,YAAI,WAAyC,UAAjC,YAAK,MAAW,YAAL,aAAiB,SArH3C,AAqHuC;KACnC;QAtHJ;;CAyHD,aAAM,aAzHL,sBAyHgB;;CAzHhB,AA0HG,OAAS,SA1HZ,AA0HQ;YACG,cA3HX,AA2HO;;CAER,aAAM,aA7HL,sBA6HgB;;CA7HhB,AA8HG,OAAS,SA9HZ,AA8HQ;CACL,aAAI,YA/HP,AA+HW;KACP;QAhIJ;;CAmID,aAAM,cAnIL,sBAmIiB;;CAnIjB,AAoIG,OAAS,SApIZ,AAoIQ;YACG,eArIX,AAqIO;;CAER,aAAM,aAAS,aAAM;CACrB,aAAM,cAAU,aAAM;CAEtB,aAAM,kBA1IL;;QA2IG,eAAU,YACa,iBAArB,cA5IJ,SA4Ie,eA5If,MA6IwB,gBAArB,cA7IH,SA6Ic,eA7Id,MA8IuB,gBAApB,cA9IH,QA8Ia,eA9Ib,MA+IwB,iBAApB,cA/IJ,QA+Ic,eA/Id,MAgJc,eAAX,cAAM;;CAKX,aAAM,YArJL,sBAqJe;;CArJd;;QAAD,AAsJI,CAAE;GAAiB,UAAQ,SAtJ9B;;WAsJ8D,YAtJ9D;;QAsJqC,cAAkB,iBAtJxD,AAsJqD;;aAEhD,oBAAqC,gBAxJ1C,AAwJuB,CAAI;;CAG5B,aAAM,WA3JL;CA4JD,aAAM,aA5JL,sBA4JgB;;CA5JhB,AA6JG,sBAAkB,WAAI,cAAQ,WAAI;CA7JrC,AA8JG,OA9JH,AA8JO,eAAc;CA9JrB,AA+JG,SA/JH,AA+JO,cAAa,qBAAW;CAC5B,eAA4B,sBAhK/B,AAgK0B,KACoB,4BAA5B,WAAI,aAAQ,WAAI,aAAO;CAjKxC;;QAkKG;GAAY,UAAoB,YAlKnC;;YAkKuB;;QAlKxB;;CAqKD,aAAM,UArKL,sBAqKa;;CAAG,gBAAO,eArKvB,AAqK8B;YAAG;;CAClC,aAAM,WAtKL,sBAsKc,GAAG;;CAtKjB,AAuKG,OAAS,SAvKZ,AAuKQ;CAvKR,AAuKgB,OAAS,SAvKzB,AAuKqB;CAClB,YAAI,YAAe,YAxKtB,AAwKc,KAxKd,AAwKkB;YACb;;CAEN,aAAM,iBA3KL;;YA4KQ,WA5KT,IAAA;;CA8KA,aAAkC;CAElC,aAAM,WAhLL,sBAgLc,GAAG;;CAhLjB,AAiLG,OAAS,SAjLZ,AAiLQ;CAjLR,AAiLgB,OAAS,SAjLzB,AAiLqB;YACM,aAArB,WAAI,MAlLV,AAkLY,OAAK,WAAI,MAlLrB,AAkLuB;;CAExB,aAAM,WApLL,sBAoLc;;CACX,gBAAS,SArLZ,AAqLS;YACL;;CAEL,aAA6B;CAC7B,aAAM,WAzLL;;QAyLa;;CACd,aAA8B;CAE7B,kBA5LA;;;CA6LA,iBAAU,mBAAe;CAE1B,aAAM,eA/LL;;;QAAC;;QAgMG,aAAM;GAAoB,UAAQ,SAhMrC;;WAuMI,YAvMJ;;CAiMM,aAAM,qBAjMb;KAkMQ,cAGC,SArMP,sBAkMiB;;KACF,eAnMf,AAmMY;QAnMZ,AAoMS,CAAW,eApMpB;;QAsMK,aAAM,qBAtMd;;;CAyMA,aAAM,aAzML;;;;CAAA,AA0MG,IAAI,aAAQ;EACX,aAAM,YAML,SAjNJ,sBA2MsB;;QA3MrB;;SAAA,OAAD,AA4Ma;GAAK,UAIV,YAhNP;;QAAC;;YA6Me,aA7MjB,AA6Mc;GAAc,UAEhB,YA/MV;;QAAH,AA8Me,GAAQ,UA9MtB,AA8MmB;;;;QA9MpB,AAkNG;;CAEJ,aAAM,WApNL,sBAoNe;;;;;;CApNf,AAqNG,GAAG;CArNN,AAqNe,GAAG;CArNlB,AAsNG,IAtNH,AAsNO,EAAW,SAAL,aAAS;CACnB,YAvNH,AAuNO;CAvNP,AAwNG,GAxNF,MAwNQ,aAxNT,AAwNiB,UAAa;KACrB,eAzNT,AAyNM;KACO,aA1Nb,AA0NO;CA1NN;;aA2NM,eAAU;GAAU,UAQtB,YAnOJ;;CA4NM,YA5NP,AA4NW;CAAI,YA5Nf,AA4NmB;KACC,eAtNP,MAPb,AA6NgB;KACC,aA9NjB,AA8NW;QA9NT;;aA+NS,eAAU;GAAU,UAGtB,YAlOP;;CAgOS,YAhOX,AAgOe;CAAI,YAhOnB,AAgOuB;YACN,aA1NJ;;;QAPb;;CAsOD,aAAM,UAtOL;;QAsOY,WAAI;;QACjB,aAAM,UAvOL;;QAuOY,WAAI","sourcesContent":["//NOGENERATOR\n$=!create.\n$:create=[|tag| (window:$) ! (root) (tag) call. ].\nActor=!create.\nActor:pos=Vec2:O.\nActor:dir=0.\nActor:num=[|x| [x]!then[x]else[0]execute ].\n//Actor:actorList=Array! create.\nActor:createSVGElem=[|tag|\n    $! (document !\n    \"http://www.w3.org/2000/svg\" (tag)\n    createElementNS\n    ) create.\n].\nActor:copySVGElem=[|dst src;t n a s|\n    src=$!(src)create.\n    dst=$!(dst)create.\n    t=this.\n    src ! children [\n        s=this.\n        n=t ! (s:tagName) createSVGElem  0 get.\n        a=(t:Array:prototype:slice)! (s:attributes) call.\n        a ! [|an|\n            an=an:name.\n            n ! (an) (s!(an) getAttribute) setAttribute.\n        ] each.\n        dst ! (n) append.\n        t ! (n) (s) copySVGElem.\n    ] each.\n].\nActor:show=[\n    group ! (this) add.\n    !setTrans.\n    isShowing=true.\n    this.\n].\nActor:hide=[|;i|\n    group ! (this) remove.\n    isShowing=false.\n    this.\n].\nActor!\"show\" \"appear\" addAlias \"hide\" \"die\" addAlias.\nActor:group=Actor !create.\nActor:group:members=Array!create.\nActor:group:remove=[|m;i|\n    i=members ! (m) indexOf.\n    [i>=0] ! then [\n        members ! (i) (1) splice.\n    ] execute.\n    [m:element] ! then [m:element ! remove] execute.\n].\nActor:group:add=[|m;i|\n    [m:getCrashShape] ! then [] else [ system ! (\"NO\"+m) throw ]execute.\n    i=members ! (m) indexOf.\n    [i<0] ! then [\n        members ! (m) push.\n        element ! (m:element) append.\n    ] execute.\n].\n\nActor:initSVG=[|;t wndj wndw wndh htmlj htmlw htmlh |\n    svg=$ ! \"svg\" create.\n    console ! \"SVG\" (svg) log.\n    wndj=$ ! (window) create.\n    htmlj=:window!(\"html\")$ 0 get.\n    htmlw=(:window!(htmlj:scrollWidth)parseFloat)-10.\n    htmlh=(:window!(htmlj:scrollHeight)parseFloat)-10.\n    wndw=(wndj ! width)-10.\n    wndh=(wndj ! height)-10.\n    [wndh<=0] ! then [wndh=wndw/16*9] execute.\n    [htmlh<=0] ! then [htmlh=htmlw/16*9] execute.\n    [svg:length==0] ! then [\n        //window ! (svgw+\",\"+svgh) alert.\n        svg= !\"svg\" createSVGElem\n        \"id\" \"turtle_svg\" attr\n        \"width\" (htmlw) attr\n        \"height\" (htmlh) attr\n        \"position\" \"absolute\" css\n        \"body\" appendTo.\n    ] execute.\n    svg_g = svg ! \"g\" find.\n    [svg_g:length==0] ! then [\n        svg_g= ! \"g\" createSVGElem\n        \"transform\" (\"translate(\"+(wndw/2)+\",\"+(wndh/2)+\") scale(1,-1)\") attr\n        (svg) appendTo.\n    ] execute.\n    t=self.\n    t:htmlResize=[|htmlw htmlh|\n        [htmlh<=0] ! then [htmlh=htmlw/16*9] execute.\n        (t:svg) ! \"width\" (htmlw) attr \"height\" (htmlh) attr.\n    ].\n    :window ! ([|;htmlw htmlh wndw wndh|\n        htmlw=(:window!(htmlj:scrollWidth)parseFloat)-10.\n        htmlh=(:window!(htmlj:scrollHeight)parseFloat)-10.\n        htmlw_old=:window!((t:svg)!\"width\"attr)parseFloat.\n        htmlh_old=:window!((t:svg)!\"height\"attr)parseFloat.\n        [\n            or!(htmlw!=htmlw_old)(htmlh!=htmlh_old)true\n        ]!then[\n            t:htmlResize!(htmlw)(htmlh)execute.\n        ]execute.\n    ] !(this)bind) 100 setInterval.\n    wndj ! [\n        wndw=(wndj ! width)-10.\n        wndh=(wndj ! height)-10.\n        [wndh<=0] ! then [wndh=wndw/16*9] execute.\n        (t:svg_g) !\"transform\" (\"translate(\"+(wndw/2)+\",\"+(wndh/2)+\") scale(1,-1)\") attr.\n    ] resize.\n    group:element=svg_g.\n].\nActor! initSVG.\n\n// element pos dir\nActor:forward=[|by|\n    by=!(by) num.\n    _lastPos=pos.\n    _lastStep=by.\n    pos=pos ! ((Vec2:X) ! (dir) rotate (by) mul) add.\n    !setTrans.\n    this.\n].\nActor:backward=[|by|\n    by=!(by) num.\n    ! (-by) forward.\n].\nActor:turnLeft=[|by|\n    by=!(by) num.\n    dir=dir+by.\n    !setTrans.\n    this.\n].\nActor:turnRight=[|by|\n    by=!(by) num.\n    ! (-by) turnLeft.\n].\nActor:leftTurn=Actor:turnLeft.\nActor:rightTurn=Actor:turnRight.\n\nActor:getCrashShape=[\n    Polygon ! create\n    (-width/2) (-height/2) addVertex\n    (width/2) (-height/2) addVertex\n    (width/2) (height/2) addVertex\n    (-width/2) (height/2) addVertex\n    (dir) (pos) transform.\n].\n//Actor:getCrashPolygon=[\n    //    ! getWorldPolygon toPolyKArray.\n//].\nActor:crashTo=[|o|\n    [o:getCrashShape] ! then [] else [ system ! (\"NO\"+o) throw ]execute.\n    \n    (!getCrashShape) ! (o ! getCrashShape) intersects.\n    //    (window:PolyK) ! (! getCrashPolygon) (o ! getCrashPolygon) Intersects.\n].\nActor:_scale=1.\nActor:setTrans=[|str|\n    str=\"translate(\"+(pos:x)+\" \"+(pos:y)+\") \".\n    str=str+\"rotate(\"+dir+\") \".\n    str=str+\"scale(\"+_scale+\" \"+_scale+\") \".\n    element ! \"transform\" (str) attr\n    \"data-trans\" ((pos:x)+\",\"+(pos:y)+\",\"+dir) attr.\n    [isShowing] !then [! checkCrash] execute.\n    this.\n].\nActor:scale=[|s| _scale=_scale*s.!setTrans].\nActor:moveTo=[|dx dy|\n    dx=!(dx) num.dy=!(dy) num.\n    pos=Vec2 !(dx)(dy) create.\n    ! setTrans\n].\nActor:moveToCenter=[\n    !0 0 moveTo.\n].\nActor!\"moveToCenter\" \"moveCenter\" addAlias.\n\nActor:moveBy=[|dx dy|\n    dx=!(dx) num.dy=!(dy) num.\n    ! (pos:x+dx) (pos:y+dy) moveTo\n].\nActor:setDir=[|d|\n    dir=!(d) num.\n    !setTrans\n].\nActor ! \"setDir\" \"direction\" addAlias.\nActor:getDir=[dir].\nActor ! \"getDir\" \"direction?\" addAlias.\n//Actor ! \"collision\" addEventType.// ★\n:collision=[].\n:collision:isEventHandler=true.\n\nActor:checkCrash=[|;t|\n    [Actor:_doingCheckCrash] ! then [] else [\n        Actor:_doingCheckCrash=1.//TODO:true\n        !allCrash [|a|\n            ! (a) collision.\n            a ! (this) collision.\n        ] each. //TODO: localize\n        Actor:_doingCheckCrash=0.\n    ] execute.\n].\nActor:allCrash=[|;t res|\n    res=Array ! create.\n    (group:members) ! [|a|\n        [this!=a] ! then [\n            [! (a) crashTo] ! then [\n                res!(a) push.\n            ] execute.\n        ] execute.\n    ] each.\n    res.\n].\nActor:bounce＝[| _hitTarget; lp ld stp a |\n    lp=_lastPos.ld=dir.\n    stp=lp ! (pos) sub len.\n    pos=lp.\n    a=2*( dir - ( _hitTarget ! getDir ) ).\n    ! (a) turnRight.\n    ! ( stp ) forward.\n    [(! allCrash):length] ! then [\n        pos=lp. dir=ld.\n        ! ( 180- a ) turnLeft.\n        ! ( stp ) forward.\n        [(! allCrash):length] ! then [\n            pos=lp. dir=ld.\n            ! 180 turnLeft.\n        ] execute.\n    ] execute.\n    self\n].\nActor:xpos?=[pos:x].\nActor:ypos?=[pos:y].\n"]}