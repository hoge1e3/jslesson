{"version":3,"sources":["/Tonyu/Projects/Turtle/Actor.dtl"],"names":[],"mappings":"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","sourcesContent":["$=!create.\n$:create=[|tag| (window:$) ! (root) (tag) call. ].\nActor=!create.\nActor:pos=Vec2:O.\nActor:dir=0.\n//Actor:actorList=Array! create.\nActor:createSVGElem=[|tag|\n    $! (document ! \n    \"http://www.w3.org/2000/svg\" (tag)\n    createElementNS\n    ) create.\n].\nActor:copySVGElem=[|dst src;t n a s|\n    src=$!(src)create.\n    dst=$!(dst)create.\n    t=this.\n    src ! children [\n        s=this.\n        n=t ! (s:tagName) createSVGElem　0 get.\n        a=(t:Array:prototype:slice)! (s:attributes) call.\n        a ! [|an|\n            an=an:name.\n            n ! (an) (s!(an) getAttribute) setAttribute.\n        ] each.\n        dst ! (n) append.\n        t ! (n) (s) copySVGElem.\n    ] each.\n].\nActor:appear=[\n    group ! (this) add.\n    //actorList ! (this) push.\n].\nActor:die=[|;i|\n    group ! (this) remove.\n    //i=actorList ! (this) indexOf.\n    //[i>=0] ! then [\n        //    actorList ! (i) (1) splice.    \n    //] execute.\n    //[element] ! then [element ! remove] execute.\n].\nActor:group=Actor !create.\nActor:group:members=Array!create.\nActor:group:remove=[|m;i|\n    i=members ! (m) indexOf.\n    [i>=0] ! then [\n        members ! (i) (1) splice.    \n    ] execute.    \n    [m:element] ! then [m:element ! remove] execute.\n].\nActor:group:add=[|m;i|\n    i=members ! (m) indexOf.\n    [i<0] ! then [\n        members ! (m) push.\n        element ! (m:element) append.\n    ] execute.\n].\n\nActor:initSVG=[\n    svg=$ ! \"svg\" create.\n    [svg:length==0] ! then [\n        svg= !\"svg\" createSVGElem \n        \"width\" \"400\" attr\n        \"height\" \"400\" attr\n        \"position\" \"absolute\" css\n        \"body\" appendTo.\n    ] execute.\n    svg_g = svg ! \"g\" find.\n    [svg_g:length==0] ! then [\n        svg_g= ! \"g\" createSVGElem \n        \"transform\" \"translate(200,200) scale(1,-1)\" attr \n        (svg) appendTo.\n    ] execute.\n    group:element=svg_g.\n].\nActor! initSVG.\n\n// element pos dir\nActor:forward=[|by|\n    _lastPos=pos.\n    _lastStep=by.\n    pos=pos ! ((Vec2:X) ! (dir) rotate (by) mul) add.\n    !setTrans.\n    this.\n].\nActor:backward=[|by|\n    ! (-by) forward.\n].\nActor:turnLeft=[|by| \n    dir=dir+by.\n    !setTrans.\n    this.\n].\nActor:turnRight=[|by| \n    ! (-by) turnLeft.\n].\nActor:leftTurn=Actor:turnLeft.\nActor:rightTurn=Actor:turnRight.\n\nActor:getCrashShape=[\n    Polygon ! create\n    (-width/2) (-height/2) addVertex\n    (width/2) (-height/2) addVertex\n    (width/2) (height/2) addVertex\n    (-width/2) (height/2) addVertex\n    (dir) (pos) transform.\n].\n/*Actor:getCrashPolygon=[\n    ! getWorldPolygon toPolyKArray.\n].*/\nActor:crashTo=[|o|\n    (!getCrashShape) ! (o ! getCrashShape) intersects.\n    //    (window:PolyK) ! (! getCrashPolygon) (o ! getCrashPolygon) Intersects.\n].\nActor:setTrans=[|;str|\n    str=\"translate(\"+(pos:x)+\" \"+(pos:y)+\") \".\n    str=str+\"rotate(\"+dir+\") \".\n    element ! \"transform\" (str) attr\n    \"data-trans\" ((pos:x)+\",\"+(pos:y)+\",\"+dir) attr.\n    ! checkCrash.\n    this.\n].\nActor:moveTo=[|dx dy| pos=Vec2 !(dx)(dy) create. ! setTrans].\nActor:moveBy=[|dx dy| ! (pos:x+dx) (pos:y+dy) moveTo].\nActor:setDir=[|d|\n    dir=d.\n    !setTrans\n].\nActor:getDir=[dir].\n//Actor ! \"collision\" addEventType.// ★\nActor:collision=[].\nActor:checkCrash=[|;t|\n    [Actor:_doingCheckCrash] ! then [] else [\n        Actor:_doingCheckCrash=1.//TODO:true\n        !allCrash [|a| \n            ! (a) collision.\n            a ! (this) collision.\n        ] each. //TODO: localize\n        Actor:_doingCheckCrash=0.\n    ] execute. \n].\nActor:allCrash=[|;t res|\n    res=Array ! create.\n    (group:members) ! [|a|\n        [this!=a] ! then [\n            [! (a) crashTo] ! then [\n                res!(a) push.\n            ] execute.\n        ] execute.\n    ] each.\n    res.\n].\nActor:bounce＝[| _hitTarget; lp ld stp a |\n    lp=_lastPos.ld=dir.\n    stp=lp ! (pos) sub len.\n    pos=lp.\n    a=2*( dir - ( _hitTarget ! getDir ) ).\n    ! (a) turnRight.\n    ! ( stp ) forward.\n    [(! allCrash):length] ! then [\n        pos=lp. dir=ld.\n        ! ( 180- a ) turnLeft.\n        ! ( stp ) forward.\n        [(! allCrash):length] ! then [\n            pos=lp. dir=ld.\n            ! 180 turnLeft.\n        ] execute.\n    ] execute.\n    self\n].\n\n"]}