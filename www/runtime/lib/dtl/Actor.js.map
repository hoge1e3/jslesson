{"version":3,"sources":["/home/devel/devel/Turtle/Actor.dtl"],"names":[],"mappings":"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","sourcesContent":["$=!create.\r\n$:create=[|tag| (window:$) ! (root) (tag) call. ].\r\nActor=!create.\r\nActor:pos=Vec2:O.\r\nActor:dir=0.\r\nActor:num=[|x| [x]!then[x]else[0]execute ].\r\n//Actor:actorList=Array! create.\r\nActor:createSVGElem=[|tag|\r\n    $! (document ! \r\n    \"http://www.w3.org/2000/svg\" (tag)\r\n    createElementNS\r\n    ) create.\r\n].\r\nActor:copySVGElem=[|dst src;t n a s|\r\n    src=$!(src)create.\r\n    dst=$!(dst)create.\r\n    t=this.\r\n    src ! children [\r\n        s=this.\r\n        n=t ! (s:tagName) createSVGElem  0 get.\r\n        a=(t:Array:prototype:slice)! (s:attributes) call.\r\n        a ! [|an|\r\n            an=an:name.\r\n            n ! (an) (s!(an) getAttribute) setAttribute.\r\n        ] each.\r\n        dst ! (n) append.\r\n        t ! (n) (s) copySVGElem.\r\n    ] each.\r\n].\r\nActor:show=[\r\n    group ! (this) add.\r\n    !setTrans.\r\n    isShowing=true.\r\n    this.\r\n].\r\nActor:hide=[|;i|\r\n    group ! (this) remove.\r\n    isShowing=false.\r\n    this.\r\n].\r\nActor!\"show\" \"appear\" addAlias \"hide\" \"die\" addAlias.\r\nActor:group=Actor !create.\r\nActor:group:members=Array!create.\r\nActor:group:remove=[|m;i|\r\n    i=members ! (m) indexOf.\r\n    [i>=0] ! then [\r\n        members ! (i) (1) splice.    \r\n    ] execute.    \r\n    [m:element] ! then [m:element ! remove] execute.\r\n].\r\nActor:group:add=[|m;i|\r\n    [m:getCrashShape] ! then [] else [ system ! (\"NO\"+m) throw ]execute. \r\n    i=members ! (m) indexOf.\r\n    [i<0] ! then [\r\n        members ! (m) push.\r\n        element ! (m:element) append.\r\n    ] execute.\r\n].\r\n\r\nActor:initSVG=[|;t wndj svgw svgh|\r\n    svg=$ ! \"svg\" create.\r\n    console ! \"SVG\" (svg) log.\r\n    wndj=$ ! (window) create.\r\n    svgw=(wndj ! width)-10.\r\n    svgh=(wndj ! height)-10.\r\n    [svgh<=0] ! then [svgh=svgw/16*9] execute.\r\n    [svg:length==0] ! then [\r\n        //window ! (svgw+\",\"+svgh) alert.\r\n        svg= !\"svg\" createSVGElem \r\n        \"width\" (svgw) attr\r\n        \"height\" (svgh) attr\r\n        \"position\" \"absolute\" css\r\n        \"body\" appendTo.\r\n    ] execute.\r\n    svg_g = svg ! \"g\" find.\r\n    [svg_g:length==0] ! then [\r\n        svg_g= ! \"g\" createSVGElem \r\n        \"transform\" (\"translate(\"+(svgw/2)+\",\"+(svgh/2)+\") scale(1,-1)\") attr \r\n        (svg) appendTo.\r\n    ] execute.\r\n    t=self.\r\n    wndj ! [\r\n        svgw=(wndj ! width)-10.\r\n        svgh=(wndj ! height)-10.\r\n        [svgh<=0] ! then [svgh=svgw/16*9] execute.\r\n        (t:svg) ! \"width\" (svgw) attr \"height\" (svgh) attr.\r\n        (t:svg_g) !\"transform\" (\"translate(\"+(svgw/2)+\",\"+(svgh/2)+\") scale(1,-1)\") attr. \r\n    ] resize.\r\n    group:element=svg_g.\r\n].\r\nActor! initSVG.\r\n\r\n// element pos dir\r\nActor:forward=[|by|\r\n    by=!(by) num.\r\n    _lastPos=pos.\r\n    _lastStep=by.\r\n    pos=pos ! ((Vec2:X) ! (dir) rotate (by) mul) add.\r\n    !setTrans.\r\n    this.\r\n].\r\nActor:backward=[|by|\r\n    by=!(by) num.\r\n    ! (-by) forward.\r\n].\r\nActor:turnLeft=[|by| \r\n    by=!(by) num.\r\n    dir=dir+by.\r\n    !setTrans.\r\n    this.\r\n].\r\nActor:turnRight=[|by| \r\n    by=!(by) num.\r\n    ! (-by) turnLeft.\r\n].\r\nActor:leftTurn=Actor:turnLeft.\r\nActor:rightTurn=Actor:turnRight.\r\n\r\nActor:getCrashShape=[\r\n    Polygon ! create\r\n    (-width/2) (-height/2) addVertex\r\n    (width/2) (-height/2) addVertex\r\n    (width/2) (height/2) addVertex\r\n    (-width/2) (height/2) addVertex\r\n    (dir) (pos) transform.\r\n].\r\n/*Actor:getCrashPolygon=[\r\n    ! getWorldPolygon toPolyKArray.\r\n].*/\r\nActor:crashTo=[|o|\r\n    [o:getCrashShape] ! then [] else [ system ! (\"NO\"+o) throw ]execute. \r\n    \r\n    (!getCrashShape) ! (o ! getCrashShape) intersects.\r\n    //    (window:PolyK) ! (! getCrashPolygon) (o ! getCrashPolygon) Intersects.\r\n].\r\nActor:_scale=1.\r\nActor:setTrans=[|str|\r\n    str=\"translate(\"+(pos:x)+\" \"+(pos:y)+\") \".\r\n    str=str+\"rotate(\"+dir+\") \".\r\n    str=str+\"scale(\"+_scale+\" \"+_scale+\") \".\r\n    element ! \"transform\" (str) attr\r\n    \"data-trans\" ((pos:x)+\",\"+(pos:y)+\",\"+dir) attr.\r\n    [isShowing] !then [! checkCrash] execute.\r\n    this.\r\n].\r\nActor:scale=[|s| _scale=_scale*s.!setTrans].\r\nActor:moveTo=[|dx dy| \r\n    dx=!(dx) num.dy=!(dy) num.\r\n    pos=Vec2 !(dx)(dy) create. \r\n    ! setTrans\r\n].\r\nActor:moveToCenter=[\r\n    !0 0 moveTo.\r\n].\r\nActor!\"moveToCenter\" \"moveCenter\" addAlias.\r\n\r\nActor:moveBy=[|dx dy|\r\n    dx=!(dx) num.dy=!(dy) num.\r\n    ! (pos:x+dx) (pos:y+dy) moveTo\r\n].\r\nActor:setDir=[|d|\r\n    dir=!(d) num.\r\n    !setTrans\r\n].\r\nActor ! \"setDir\" \"direction\" addAlias.\r\nActor:getDir=[dir].\r\nActor ! \"getDir\" \"direction?\" addAlias.\r\n//Actor ! \"collision\" addEventType.// ★\r\n:collision=[].\r\n:collision:isEventHandler=true.\r\n\r\nActor:checkCrash=[|;t|\r\n    [Actor:_doingCheckCrash] ! then [] else [\r\n        Actor:_doingCheckCrash=1.//TODO:true\r\n        !allCrash [|a| \r\n            ! (a) collision.\r\n            a ! (this) collision.\r\n        ] each. //TODO: localize\r\n        Actor:_doingCheckCrash=0.\r\n    ] execute. \r\n].\r\nActor:allCrash=[|;t res|\r\n    res=Array ! create.\r\n    (group:members) ! [|a|\r\n        [this!=a] ! then [\r\n            [! (a) crashTo] ! then [\r\n                res!(a) push.\r\n            ] execute.\r\n        ] execute.\r\n    ] each.\r\n    res.\r\n].\r\nActor:bounce＝[| _hitTarget; lp ld stp a |\r\n    lp=_lastPos.ld=dir.\r\n    stp=lp ! (pos) sub len.\r\n    pos=lp.\r\n    a=2*( dir - ( _hitTarget ! getDir ) ).\r\n    ! (a) turnRight.\r\n    ! ( stp ) forward.\r\n    [(! allCrash):length] ! then [\r\n        pos=lp. dir=ld.\r\n        ! ( 180- a ) turnLeft.\r\n        ! ( stp ) forward.\r\n        [(! allCrash):length] ! then [\r\n            pos=lp. dir=ld.\r\n            ! 180 turnLeft.\r\n        ] execute.\r\n    ] execute.\r\n    self\r\n].\r\nActor:xpos?=[pos:x].\r\nActor:ypos?=[pos:y].\r\n"]}