{"version":3,"sources":["/home/devel/devel/Turtle/Timer.dtl"],"names":[],"mappings":"4BAEC,qBAAU;CACV,gBAAS,SAAK,aAAM;CACpB,gBAAS,SAJR;;CAAA,IAKQ,QAAiB,SALxB,sBAKc;;QALd,AAKgB,CAAE;;QALnB;;CASD,kBAAO;CACP,aAAM,MALC;CAMP,aAAM,MANC;CAOP,aAAM,aAZL,sBAYgB;;CAZf;;SAAD,AAaI,GAbJ;GAauB,OAbtB;;QAAD,AAae,EAbf;;CAAA,IAcQ,OAdR,AAcU,EA2BM;QAzChB;;CAiBD,aAAM,UAjBL,sBAiBa;;CAjBb,IAiBoB,MAjBpB,AAiBsB;QAjBtB;;CAkBD,aAAM,aAlBL,sBAkBgB;;CAlBhB,IAkBuB,QAlBvB,AAkByB,EAuBT,QAzChB,IAkBqC;QAlBrC;;CAmBD,aAAM,MAAG,cAA2B,SAAlB,cAAO,KAAE,cAAa;CACxC,aAAM,SApBL;;;CAqBD,aAAM,UArBL;;;CAsBD,aAAuB;CACvB,aAAM,YAvBL,sBAuBe;;;;;;CAvBf,AAwBG,EAxBH;CAAA,AAyBG,EAzBH,AAyBK,CAAE;CAzBP,AA0BG,EA1BH,AA0BK,CAAE;CA1BP,AA2BG,EA3BH;CA4BI,gBAAS,QAAQ,SA5BrB,AA4BmB;CA5BnB,AA6BG,CAAE,MA7BL,AA6BO,CAAE,KAgBL,SA7CH;;;CAAD,AA8BO,CAAE,UA9BP;;QA8Be,cAAa,mBA9B9B,AA8ByB,CAAE;;CA9B3B,AA+BO,CAAE,SA/BP;;CA+Bc,cAAa,mBA/B7B,AA+BwB,CAAE;QA/BzB,AA+B0C,CAAE;;CA/B5C,AAgCM,EAAG,cAA2B,SAAlB,cAAO,KAAE;CAhC5B,AAiCO,CAAE,QAAK,eAUD,gBA3CX;;CAAC;;QAAH,AAkCY,CAAK,aAlCjB,AAkCe;GAAY,SAIf,UAtCT,sBAkC6B;;CAlChC,AAmCe,CAAE;QACF,cAAyB,yBApCrC,AAoCkC;;CApCrC,AAuCW,GAvCX,AAuCa,EAvCb;QAAG;;SAAH,AAwCY,EAxCZ,AAwCc;GAAG,UAEL,YA1CT;;QAAH,AAyCe,CAAE;;KAzCjB,AA2CU;QA3CT,AA4CM;;QA5CP;;CAgDD,aAAM,iBAAa,aAAM;CACzB,aAAM,kBAjDL,sBAiDqB;;CAjDrB,IAkDQ,KAAa,SAlDpB;;QAAD,AAkDW,CAAE;;QAlDb;;CAqDD,aAAM,SArDL;;QAsDG,kBAIE,QA1DJ,sBAsDiB;;YAGT,kBAzDP;;QAAD,AAwDU,IAAa,aAxDtB;;;;CA4DH,aAAuC;YACrB","sourcesContent":["//NOGENERATOR\r\n// Dolittle\r\nalltimer=!create.\r\nalltimer:list=Array!create.\r\nalltimer:stop=[\r\n    self:list![|i|i!stop.]each.\r\n    self.\r\n].\r\n\r\nTimer=!create.\r\nTimer:i=100.\r\nTimer:t=100.\r\nTimer:interval=[|i|\r\n    [i>=0.001]![i=0.001]or.\r\n    self:i=i*1000.\r\n    self\r\n].\r\nTimer:times=[|t|self:t=t.self].\r\nTimer:duration=[|t|self:t=t*1000/self:i.self].\r\nTimer:d=:system!(:window:$:Deferred)new resolve.\r\nTimer:skip=[].\r\nTimer:abort=[].\r\nTimer ! \"abort\" \"stop\" addAlias.\r\nTimer:execute=[|f;s t i c|\r\n    s=self.\r\n    t=s:t.\r\n    i=s:i.\r\n    c=1.\r\n    :alltimer:list!(s)add.\r\n    s:d=s:d![|;d|\r\n        s:abort=[:window!(s:id)clearInterval].\r\n        s:skip=[:window!(s:id)clearInterval.d!resolve].\r\n        d=:system!(:window:$:Deferred)new.\r\n        s:id=(:window)![\r\n            [f!(c)execute.]!try[|e|\r\n                s!abort.\r\n                window ! \"\" \"\" \"\" \"\" (e) onerror.\r\n                //:system!(e)throw.\r\n            ]catch.\r\n            c=c+1.\r\n            [c>t]!then[\r\n                s!skip.\r\n            ]execute.\r\n        ] (i) setInterval.\r\n        d.\r\n    ]then.\r\n    self.\r\n].\r\nTimer:next_execute=Timer:execute.\r\nTimer:after_execute=[|f|\r\n    self:d![f!execute]then.\r\n    self.\r\n].\r\nTimer:wait=[\r\n    DtlPromise ! [|succ|\r\n        ! [\r\n            succ! (self) execute\r\n        ] after_execute \r\n    ] new.\r\n].\r\nTimer ! \"after_execute\" \"execute_once\" addAlias. \r\n! \"Timer\" \"timer\" addAlias."]}