インストールのテスト（手動）

www dir: /var/www/html/bitarrow
data dir: /var/www/data/bitarrow
homepage: http://example.com/bitarrow

(setting for SELinux )
% cd /var/www/data/bitarrow
% sudo semanage fcontext -a -t httpd_sys_rw_content_t /var/www/data/bitarrow
% sudo restorecon -vv .
% ls -Zlat
合計 0
drwxr-xr-x. 2 unconfined_u:object_r:httpd_sys_rw_content_t:s0 apache hoge   6  6月  7 12:30 .
drwxr-xr-x. 4 unconfined_u:object_r:httpd_sys_content_t:s0 root   root 37  6月  7 12:30 ..
(end setting for SELinux)

Go https://github.com/hoge1e3/jslesson
download zip, copy to ~
% cd ~
% unzip jslesson-babel.zip
% cd /var/www/html/bitarrow
% cp -R ~/jslesson-babel/www/* .
% chmod 755 node/pythonjs.sh
% vi node/pythonjs.sh
(環境により nodejs を nodeに変える)
% vi config/config.php
<?php

//   You must set BA_DATA to data directory, it is recommended that BA_DATA cannot access via http
define("BA_DATA", "/var/www/data/bitarrow");
define("BA_WWW", "/var/www/html/bitarrow");
define("BA_TOP_URL", "http://example.com/bitarrow";
define("BA_PUB_URL", BA_TOP_URL."/fs/pub");

define("BA_LOG", BA_DATA."/log");
define("BA_FS",  BA_DATA."/fs");
define("PYTHON_HOME", BA_WWW."/node");
define("PYTHON_WORK", BA_DATA."/pythonwork");
define("PYTHON_PATH", PYTHON_HOME."/pythonjs.sh");

define("BA_HOME",BA_FS."/home");
define("BA_PUB", BA_FS."/pub");

// You should define PDO_* in BA_DATA/config.php to protect passowrd
require_once(BA_DATA."/config.php");


 ?>

setup db  (user=bauser/ dbname=bitarrow / pass=XXXX )
% mysql -u root -p
# CREATE DATABASE bitarrow DEFAULT CHARACTER SET utf8;
# CREATE USER bauser IDENTIFIED BY 'XXXX';
# grant all on bitarrow.* to bauser;

% mysql -u bauser -p bitarrow < ~/jslesson-babel/data/schema.db

% cd /var/www/data/bitarrow/
% vi config.php

<?php
define("PDO_DSN","mysql:host=localhost;dbname=bitarrow;charset=utf8mb4");
define("PDO_USER","bauser");
define("PDO_PASS","XXXX");
?>

% mkdir fs log pythonwork
% cp -R ~/jslesson-babel/data/fs/scripts/ fs
% sudo chown apache fs log pythonwork

% mysql -u bauser -p bitarrow
mysql> insert into teacher values ("teacher@example.com","XXXX",NULL);
mysql> insert into role values("teacher@example.com",NULL,"sysad",NULL);

(↓Gitから解凍したら入っていなかった)
% vi .htaccess
DirectoryIndex a.php

http://path.to/bitarrow/?Teacher/home


TODO:
runDtl.php やめる
a.php のあるなしをオプションで指定
